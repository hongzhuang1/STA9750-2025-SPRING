<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hong Zhuang">

<title>Course Project: How does proximity to NYC impact the real estate pricing in Connecticut? – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-and-motivation" id="toc-introduction-and-motivation" class="nav-link active" data-scroll-target="#introduction-and-motivation">Introduction and Motivation</a></li>
  <li><a href="#data-acquisition" id="toc-data-acquisition" class="nav-link" data-scroll-target="#data-acquisition">Data Acquisition</a>
  <ul class="collapse">
  <li><a href="#connecticut-real-estate-sales-dataset" id="toc-connecticut-real-estate-sales-dataset" class="nav-link" data-scroll-target="#connecticut-real-estate-sales-dataset">Connecticut Real Estate Sales Dataset</a></li>
  <li><a href="#download-connecticut-county-and-town-shapefiles" id="toc-download-connecticut-county-and-town-shapefiles" class="nav-link" data-scroll-target="#download-connecticut-county-and-town-shapefiles">Download Connecticut County and Town Shapefiles</a></li>
  <li><a href="#metro-north-railroad" id="toc-metro-north-railroad" class="nav-link" data-scroll-target="#metro-north-railroad">Metro-North Railroad</a></li>
  <li><a href="#download-ct-transit-data" id="toc-download-ct-transit-data" class="nav-link" data-scroll-target="#download-ct-transit-data">Download CT transit Data</a></li>
  </ul></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">Data Cleaning</a></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing">Data Preprocessing</a>
  <ul class="collapse">
  <li><a href="#proximity-to-nyc-a-grand-central-based-metric-for-measuring-access-to-the-city" id="toc-proximity-to-nyc-a-grand-central-based-metric-for-measuring-access-to-the-city" class="nav-link" data-scroll-target="#proximity-to-nyc-a-grand-central-based-metric-for-measuring-access-to-the-city">Proximity to NYC: A Grand Central-Based Metric for Measuring Access to the City</a></li>
  <li><a href="#verify-mappings-between-property-addresses-and-their-geographic-coordinates" id="toc-verify-mappings-between-property-addresses-and-their-geographic-coordinates" class="nav-link" data-scroll-target="#verify-mappings-between-property-addresses-and-their-geographic-coordinates">Verify Mappings Between Property Addresses and Their Geographic Coordinates</a>
  <ul class="collapse">
  <li><a href="#define-a-function-to-compute-the-distance-range-for-each-town-from-grand-central-terminal" id="toc-define-a-function-to-compute-the-distance-range-for-each-town-from-grand-central-terminal" class="nav-link" data-scroll-target="#define-a-function-to-compute-the-distance-range-for-each-town-from-grand-central-terminal">Define a function to compute the distance range for each town from Grand Central Terminal</a></li>
  </ul></li>
  <li><a href="#handling-missing-geographic-data" id="toc-handling-missing-geographic-data" class="nav-link" data-scroll-target="#handling-missing-geographic-data">Handling Missing Geographic Data</a></li>
  <li><a href="#handling-categorical-missing-data-property-type" id="toc-handling-categorical-missing-data-property-type" class="nav-link" data-scroll-target="#handling-categorical-missing-data-property-type">Handling Categorical Missing Data: Property Type</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#what-is-the-total-number-of-real-estate-transactions-and-the-corresponding-aggregate-sale-volume-by-county" id="toc-what-is-the-total-number-of-real-estate-transactions-and-the-corresponding-aggregate-sale-volume-by-county" class="nav-link" data-scroll-target="#what-is-the-total-number-of-real-estate-transactions-and-the-corresponding-aggregate-sale-volume-by-county">1. What is the total number of real estate transactions and the corresponding aggregate sale volume by county?</a></li>
  <li><a href="#how-many-repeated-sales-are-there-in-each-county" id="toc-how-many-repeated-sales-are-there-in-each-county" class="nav-link" data-scroll-target="#how-many-repeated-sales-are-there-in-each-county">2. How many repeated sales are there in each county?</a></li>
  <li><a href="#how-much-have-average-single-family-home-values-changed-in-each-county" id="toc-how-much-have-average-single-family-home-values-changed-in-each-county" class="nav-link" data-scroll-target="#how-much-have-average-single-family-home-values-changed-in-each-county">3. How much have average single-family home values changed in each county?</a></li>
  <li><a href="#which-months-or-quarters-see-the-most-activity" id="toc-which-months-or-quarters-see-the-most-activity" class="nav-link" data-scroll-target="#which-months-or-quarters-see-the-most-activity">4. Which months or quarters see the most activity?</a></li>
  <li><a href="#what-are-the-hotspots-for-high-value-transactions" id="toc-what-are-the-hotspots-for-high-value-transactions" class="nav-link" data-scroll-target="#what-are-the-hotspots-for-high-value-transactions">5. What are the hotspots for high-value transactions?</a></li>
  </ul></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">Feature Engineering</a>
  <ul class="collapse">
  <li><a href="#calculate-distance-km-from-grand-central-terminal-for-each-property" id="toc-calculate-distance-km-from-grand-central-terminal-for-each-property" class="nav-link" data-scroll-target="#calculate-distance-km-from-grand-central-terminal-for-each-property">Calculate Distance (km) from Grand Central Terminal for Each Property</a></li>
  <li><a href="#compute-distance-from-each-property-to-the-nearest-train-station" id="toc-compute-distance-from-each-property-to-the-nearest-train-station" class="nav-link" data-scroll-target="#compute-distance-from-each-property-to-the-nearest-train-station">Compute Distance from Each Property to the Nearest Train Station</a></li>
  <li><a href="#what-percentage-of-properties-in-fairfield-and-new-haven-counties-are-located-within-3-km-of-the-nearest-metro-north-station" id="toc-what-percentage-of-properties-in-fairfield-and-new-haven-counties-are-located-within-3-km-of-the-nearest-metro-north-station" class="nav-link" data-scroll-target="#what-percentage-of-properties-in-fairfield-and-new-haven-counties-are-located-within-3-km-of-the-nearest-metro-north-station">6. What percentage of properties in Fairfield and New Haven Counties are located within 3 km of the nearest Metro-North station?</a></li>
  <li><a href="#how-does-proximity-to-the-nearest-train-station-correlate-with-home-values-in-fairfield-county" id="toc-how-does-proximity-to-the-nearest-train-station-correlate-with-home-values-in-fairfield-county" class="nav-link" data-scroll-target="#how-does-proximity-to-the-nearest-train-station-correlate-with-home-values-in-fairfield-county">7. How does proximity to the nearest train station correlate with home values in Fairfield County?</a></li>
  <li><a href="#how-does-proximity-to-new-york-city-correlate-with-home-values-across-connecticut" id="toc-how-does-proximity-to-new-york-city-correlate-with-home-values-across-connecticut" class="nav-link" data-scroll-target="#how-does-proximity-to-new-york-city-correlate-with-home-values-across-connecticut">8. How does proximity to New York City correlate with home values across Connecticut?</a></li>
  <li><a href="#how-do-average-property-values-differ-by-property-type-between-new-haven-and-hartford-towns" id="toc-how-do-average-property-values-differ-by-property-type-between-new-haven-and-hartford-towns" class="nav-link" data-scroll-target="#how-do-average-property-values-differ-by-property-type-between-new-haven-and-hartford-towns">9. How do average property values differ by property type between New Haven and Hartford towns?</a></li>
  <li><a href="#which-ten-towns-in-connecticut-have-the-highest-number-of-bus-stops" id="toc-which-ten-towns-in-connecticut-have-the-highest-number-of-bus-stops" class="nav-link" data-scroll-target="#which-ten-towns-in-connecticut-have-the-highest-number-of-bus-stops">10. Which ten towns in Connecticut have the highest number of bus stops?”</a></li>
  <li><a href="#what-are-the-top-five-towns-with-the-most-connectivity-to-other-towns" id="toc-what-are-the-top-five-towns-with-the-most-connectivity-to-other-towns" class="nav-link" data-scroll-target="#what-are-the-top-five-towns-with-the-most-connectivity-to-other-towns">11. What are the top five towns with the most connectivity to other towns?</a></li>
  </ul></li>
  <li><a href="#model-performance" id="toc-model-performance" class="nav-link" data-scroll-target="#model-performance">Model Performance</a></li>
  <li><a href="#future-work" id="toc-future-work" class="nav-link" data-scroll-target="#future-work">Future Work</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="final_project.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Course Project: How does proximity to NYC impact the real estate pricing in Connecticut?</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hong Zhuang </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction-and-motivation" class="level1">
<h1>Introduction and Motivation</h1>
<p>The spatial distribution of real estate activity across Connecticut reveals a notable geographic trend: counties located closer to major urban economic centers, particularly New York City, exhibit stronger market performance. Fairfield County, situated in the southwestern corner of the state, stands out as the most active real estate market. According to the dataset, it recorded 211,845 property transactions between 2001 and 2022—the highest among all counties—spanning residential, commercial, vacant land, and public utility properties(see Table 1). This market strength is accompanied by the highest total dollar volume of transactions, signaling both high demand and high property values.</p>
<p>A key differentiation for Fairfield is its geographical proximity to NYC and accessibility via the Metro-North Railroad, which positions it as a prime location for commuters seeking suburban living with urban job opportunities. This suggests that connectivity to economic hubs may play a significant role in driving property values and transaction volumes.</p>
<p>Motivated by this observation, this analysis aims to examine how distance from New York City correlates with real estate market activity across Connecticut counties. By quantifying this relationship, we can better understand the extent to which geographic accessibility influences housing demand and pricing—offering valuable insights for urban planners, real estate developers/analysts, and policy makers.</p>
</section>
<section id="data-acquisition" class="level1">
<h1>Data Acquisition</h1>
<section id="connecticut-real-estate-sales-dataset" class="level2">
<h2 class="anchored" data-anchor-id="connecticut-real-estate-sales-dataset">Connecticut Real Estate Sales Dataset</h2>
<p>The primary data source used in our analysis is available at: <a href="https://data.ct.gov/Housing-and-Development/Real-Estate-Sales-2001-2022-GL/5mzw-sjtu/about_data">CT Real Estate Sales</a></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load relevant packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales) </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)   </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmaptools)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris) </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Direct download link for the sales data</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://data.ct.gov/api/views/5mzw-sjtu/rows.csv?accessType=DOWNLOAD"</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="st">"data/course_project"</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"ct_sales.csv"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(data_dir)){</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(data_dir, <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Download file only if it doesn't already exist</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"data/course_project/ct_sales.csv"</span>)){</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(url, <span class="at">destfile =</span> file_name, <span class="at">mode =</span> <span class="st">"wb"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Read sales data into R</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_name)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Format `ct_sales` column names </span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ct_sales) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"_"</span>, <span class="fu">colnames</span>(ct_sales)))</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ct_sales) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, <span class="fu">colnames</span>(ct_sales)))</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a unique ID for each transaction to facilitate easier referencing </span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co"># and joining with other data sources</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_id =</span> <span class="fu">row_number</span>()</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    ref_id,</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">everything</span>()</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the town name for records with "unknown" value</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">town =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>      town <span class="sc">==</span>   <span class="st">"***Unknown***"</span> <span class="sc">~</span> <span class="st">"East Hampton"</span>,</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> town</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Map each town to its corresponding county </span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>ct_town_county_codes<span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/STA9750/STA9750-2025-SPRING/ct_town_county_codes.csv"</span>)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    ct_town_county_codes <span class="sc">|&gt;</span> <span class="fu">select</span>(town_name, county),</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"town"</span> <span class="ot">=</span> <span class="st">"town_name"</span>)</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(ct_sales, <span class="dv">10</span>), <span class="at">caption =</span> <span class="st">"First 10 Rows of CT Real Estate Sales"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 10 Rows of CT Real Estate Sales</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">ref_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">serial_number</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">list_year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">date_recorded</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">address</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">assessed_value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sale_amount</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sales_ratio</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">property_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">residential_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">non_use_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">assessor_remarks</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">opm_remarks</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">county</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2020177</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">04/14/2021</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: left;">323 BEAVER ST</td>
<td style="text-align: right;">133000</td>
<td style="text-align: right;">248400</td>
<td style="text-align: right;">0.5354000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">POINT (-73.06822 41.35014)</td>
<td style="text-align: left;">New Haven</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2020225</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">05/26/2021</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: left;">152 JACKSON ST</td>
<td style="text-align: right;">110500</td>
<td style="text-align: right;">239900</td>
<td style="text-align: right;">0.4606000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Three Family</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">New Haven</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">2020348</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">09/13/2021</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: left;">230 WAKELEE AVE</td>
<td style="text-align: right;">150500</td>
<td style="text-align: right;">325000</td>
<td style="text-align: right;">0.4630000</td>
<td style="text-align: left;">Commercial</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">New Haven</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2020090</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">12/14/2020</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: left;">57 PLATT ST</td>
<td style="text-align: right;">127400</td>
<td style="text-align: right;">202500</td>
<td style="text-align: right;">0.6291000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Two Family</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">New Haven</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">210288</td>
<td style="text-align: right;">2021</td>
<td style="text-align: left;">06/20/2022</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">12 BYRON DRIVE</td>
<td style="text-align: right;">179990</td>
<td style="text-align: right;">362500</td>
<td style="text-align: right;">0.4965000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Condo</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">POINT (-72.879115982 41.773452988)</td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">200500</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">09/07/2021</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">245 NEW ROAD</td>
<td style="text-align: right;">217640</td>
<td style="text-align: right;">400000</td>
<td style="text-align: right;">0.5441000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">200121</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">12/15/2020</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">63 NORTHGATE</td>
<td style="text-align: right;">528490</td>
<td style="text-align: right;">775000</td>
<td style="text-align: right;">0.6819000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">POINT (-72.89675 41.79445)</td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">20058</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">06/01/2021</td>
<td style="text-align: left;">Barkhamsted</td>
<td style="text-align: left;">46 RATLUM MTN RD</td>
<td style="text-align: right;">203530</td>
<td style="text-align: right;">415000</td>
<td style="text-align: right;">0.4904337</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">2003 COLONIAL, 2140 SFLA, 2.99 AC</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">Litchfield</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">200046</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">01/25/2021</td>
<td style="text-align: left;">Beacon Falls</td>
<td style="text-align: left;">34 LASKY ROAD</td>
<td style="text-align: right;">158030</td>
<td style="text-align: right;">243000</td>
<td style="text-align: right;">0.6503000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">New Haven</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">200016</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">11/13/2020</td>
<td style="text-align: left;">Beacon Falls</td>
<td style="text-align: left;">9 AVON COURT</td>
<td style="text-align: right;">65590</td>
<td style="text-align: right;">100000</td>
<td style="text-align: right;">0.6559000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Condo</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">New Haven</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="download-connecticut-county-and-town-shapefiles" class="level2">
<h2 class="anchored" data-anchor-id="download-connecticut-county-and-town-shapefiles">Download Connecticut County and Town Shapefiles</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read county shapefile into R</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>county_shp_url <span class="ot">&lt;-</span> <span class="st">"https://www2.census.gov/geo/tiger/TIGER2020/COUNTY/tl_2020_us_county.zip"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>zip_county_shp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"tl_2020_us_county.zip"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>unzip_county_shp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"tl_2020_us_county"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>county_shp_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_county_shp_path, <span class="st">"tl_2020_us_county.shp"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(county_shp_file)){</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(county_shp_url, <span class="at">destfile =</span> zip_county_shp_path, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unzip</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(<span class="at">zipfile =</span> zip_county_shp_path, <span class="at">exdir =</span> unzip_county_shp_path)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">&lt;-</span> <span class="fu">st_read</span>(county_shp_file, <span class="at">quiet =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">filter</span>(STATEFP <span class="sc">==</span> <span class="st">"09"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Read town shapefile into R</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>town_shp_url <span class="ot">&lt;-</span> <span class="st">"https://www2.census.gov/geo/tiger/TIGER2020/COUSUB/tl_2020_09_cousub.zip"</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>zip_town_shp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"tl_2020_09_cousub.zip"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>unzip_town_shp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"tl_2020_09_cousub"</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>town_shp_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_town_shp_path,<span class="st">"tl_2020_09_cousub.shp"</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(town_shp_file)){</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(town_shp_url, <span class="at">destfile =</span> zip_town_shp_path, <span class="at">mode =</span> <span class="st">"wb"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unzip shapefiles</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(<span class="at">zipfile =</span> zip_town_shp_path, <span class="at">exdir =</span> unzip_town_shp_path)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>ct_towns <span class="ot">&lt;-</span> <span class="fu">st_read</span>(town_shp_file, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="metro-north-railroad" class="level2">
<h2 class="anchored" data-anchor-id="metro-north-railroad">Metro-North Railroad</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download Metro-North stops </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>gtfs_url <span class="ot">&lt;-</span> <span class="st">"https://rrgtfsfeeds.s3.amazonaws.com/gtfsmnr.zip"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>zip_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"gtfsmnr.zip"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>unzip_file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"metro-north"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>stops_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_file_path, <span class="st">"stops.txt"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(data_dir)){</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(data_dir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(stops_file)){</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(gtfs_url, <span class="at">destfile =</span> zip_path, <span class="at">mode =</span> <span class="st">"wb"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unzip files</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(<span class="at">zipfile =</span> zip_path, <span class="at">exdir =</span> unzip_file_path)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Metro-North stops data into R</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>stops <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(stops_file, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Connecticut towns' geometry </span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>ct_towns_geom <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span> <span class="fu">select</span>(STATEFP, NAME)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># # ny_towns &lt;- county_subdivisions(state = "NY")</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># # ny_towns_geom &lt;- ny_towns |&gt; select(STATEFP, NAME)</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(ny_towns_geom, "ny_towns_geom.rds")</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>ny_towns_geom <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ny_towns_geom.rds"</span>)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>ct_ny_towns_geom <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ct_towns_geom, ny_towns_geom)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>stops <span class="ot">&lt;-</span> stops <span class="sc">|&gt;</span> <span class="fu">select</span>(stop_id, stop_name, stop_lon, stop_lat)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object of Metro-North stops</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the state and the town for each station</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>stops <span class="ot">&lt;-</span> <span class="fu">st_join</span>(stops_sf, ct_ny_towns_geom, <span class="at">join =</span> st_within) <span class="sc">|&gt;</span> </span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME) <span class="sc">|&gt;</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"09"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"36"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>STATEFP) <span class="sc">|&gt;</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(stops, <span class="at">by =</span> <span class="st">"stop_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">stop_name =</span> stop_name.x</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>stop_name.y)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>                     <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the first ten rows to display</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>to_display <span class="ot">&lt;-</span> stops <span class="sc">|&gt;</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(stop_id, stop_name, town, state, stop_lon, stop_lat) <span class="sc">|&gt;</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(to_display, <span class="at">caption =</span> <span class="st">"First 10 Rows of Metro-North Stations"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 10 Rows of Metro-North Stations</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">stop_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stop_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stop_lon</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stop_lat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Grand Central</td>
<td style="text-align: left;">Manhattan</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.97706</td>
<td style="text-align: right;">40.75300</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Harlem-125 St</td>
<td style="text-align: left;">Manhattan</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.93915</td>
<td style="text-align: right;">40.80516</td>
</tr>
<tr class="odd">
<td style="text-align: right;">622</td>
<td style="text-align: left;">Yankees-E 153 St</td>
<td style="text-align: left;">Bronx</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.92990</td>
<td style="text-align: right;">40.82530</td>
</tr>
<tr class="even">
<td style="text-align: right;">184</td>
<td style="text-align: left;">Highbridge Yard</td>
<td style="text-align: left;">Bronx</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.93150</td>
<td style="text-align: right;">40.83590</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: left;">Morris Heights</td>
<td style="text-align: left;">Bronx</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.91958</td>
<td style="text-align: right;">40.85425</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">University Heights</td>
<td style="text-align: left;">Bronx</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.91312</td>
<td style="text-align: right;">40.86225</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: left;">Marble Hill</td>
<td style="text-align: left;">Manhattan</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.91094</td>
<td style="text-align: right;">40.87433</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: left;">Spuyten Duyvil</td>
<td style="text-align: left;">Bronx</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.92145</td>
<td style="text-align: right;">40.87824</td>
</tr>
<tr class="odd">
<td style="text-align: right;">16</td>
<td style="text-align: left;">Riverdale</td>
<td style="text-align: left;">Bronx</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.91413</td>
<td style="text-align: right;">40.90398</td>
</tr>
<tr class="even">
<td style="text-align: right;">17</td>
<td style="text-align: left;">Ludlow</td>
<td style="text-align: left;">Yonkers</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.90461</td>
<td style="text-align: right;">40.92497</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="download-ct-transit-data" class="level2">
<h2 class="anchored" data-anchor-id="download-ct-transit-data">Download CT transit Data</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GTFS file URL for CT transit data </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ct_bus_url <span class="ot">&lt;-</span> <span class="st">"https://www.cttransit.com/sites/default/files/gtfs/googlect_transit.zip"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>zip_file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"googlect_transit.zip"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>unzip_file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"ct_bus"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check files </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>files_to_unzip <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"stops.txt"</span>, <span class="st">"trips.txt"</span>, <span class="st">"stop_times.txt"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>files_to_check <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_file_path, files_to_unzip)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">all</span>(<span class="fu">file.exists</span>(files_to_check))){</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(ct_bus_url, <span class="at">destfile =</span> zip_file_path, <span class="at">mode =</span> <span class="st">"wb"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unzip</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(<span class="at">zipfile =</span> zip_file_path, <span class="at">exdir =</span> unzip_file_path)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Read relevant files into R</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>stops_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_file_path, <span class="st">"stops.txt"</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(stops_file, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    stop_id, stop_code, stop_name, stop_lat, stop_lon,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>stop_times_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_file_path, <span class="st">"stop_times.txt"</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>stop_times <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(stop_times_file, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                         <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>trips_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_file_path, <span class="st">"trips.txt"</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>trips <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(trips_file, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Map bus stop to town </span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>bus_stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(bus_stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">st_join</span>(bus_stops_sf, ct_ny_towns_geom, <span class="at">join =</span> st_within) <span class="sc">|&gt;</span> </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME) <span class="sc">|&gt;</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"09"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"36"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>STATEFP)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine these data sets to obtain trip-level bus data in Connecticut</span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>bus_trip_stop_data <span class="ot">&lt;-</span> stop_times <span class="sc">|&gt;</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bus_stops, <span class="at">by =</span> <span class="st">"stop_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(trips, <span class="at">by =</span> <span class="st">"trip_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    trip_id,</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    route_id,</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    block_id,</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    shape_id,</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    stop_sequence,</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    stop_id,</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    arrival_time,</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>    departure_time,</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    shape_dist_traveled,</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    stop_name,</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>    town,</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>    lon,</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    lat,</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>    state,</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(bus_trip_stop_data, <span class="dv">10</span>), <span class="at">caption =</span> <span class="st">"First 10 Rows of CT Bus Trips"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 10 Rows of CT Bus Trips</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">trip_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">route_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">block_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">shape_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stop_sequence</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stop_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">arrival_time</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">departure_time</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">shape_dist_traveled</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stop_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lon</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lat</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8558</td>
<td style="text-align: left;">17:15:00</td>
<td style="text-align: left;">17:15:00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">Church St @ George St</td>
<td style="text-align: left;">New Haven</td>
<td style="text-align: right;">-72.92707</td>
<td style="text-align: right;">41.30416</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="even">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8557</td>
<td style="text-align: left;">17:18:00</td>
<td style="text-align: left;">17:18:00</td>
<td style="text-align: right;">0.5315</td>
<td style="text-align: left;">College St @ George St</td>
<td style="text-align: left;">New Haven</td>
<td style="text-align: right;">-72.93073</td>
<td style="text-align: right;">41.30468</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5769</td>
<td style="text-align: left;">17:18:19</td>
<td style="text-align: left;">17:18:19</td>
<td style="text-align: right;">0.6892</td>
<td style="text-align: left;">S Frontage @ College St</td>
<td style="text-align: left;">New Haven</td>
<td style="text-align: right;">-72.93133</td>
<td style="text-align: right;">41.30342</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="even">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4744</td>
<td style="text-align: left;">17:28:56</td>
<td style="text-align: left;">17:28:56</td>
<td style="text-align: right;">5.9520</td>
<td style="text-align: left;">Frontage Rd @ Kimberly Ave</td>
<td style="text-align: left;">East Haven</td>
<td style="text-align: right;">-72.87874</td>
<td style="text-align: right;">41.28577</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4743</td>
<td style="text-align: left;">17:29:55</td>
<td style="text-align: left;">17:29:55</td>
<td style="text-align: right;">6.4437</td>
<td style="text-align: left;">Saltonstall Pkwy @ Forbes Pl</td>
<td style="text-align: left;">East Haven</td>
<td style="text-align: right;">-72.87369</td>
<td style="text-align: right;">41.28361</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="even">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4742</td>
<td style="text-align: left;">17:30:49</td>
<td style="text-align: left;">17:30:49</td>
<td style="text-align: right;">6.8914</td>
<td style="text-align: left;">Saltonstall Pkwy @ Sanford St</td>
<td style="text-align: left;">East Haven</td>
<td style="text-align: right;">-72.86922</td>
<td style="text-align: right;">41.28140</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">4745</td>
<td style="text-align: left;">17:31:22</td>
<td style="text-align: left;">17:31:22</td>
<td style="text-align: right;">7.1657</td>
<td style="text-align: left;">Saltonstall Pkwy @ Hemingway Ave</td>
<td style="text-align: left;">East Haven</td>
<td style="text-align: right;">-72.86672</td>
<td style="text-align: right;">41.27981</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="even">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">10488</td>
<td style="text-align: left;">17:32:21</td>
<td style="text-align: left;">17:32:21</td>
<td style="text-align: right;">7.6591</td>
<td style="text-align: left;">Saltonstall Pkwy @ Main St</td>
<td style="text-align: left;">East Haven</td>
<td style="text-align: right;">-72.86182</td>
<td style="text-align: right;">41.27727</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">4612</td>
<td style="text-align: left;">17:32:35</td>
<td style="text-align: left;">17:32:35</td>
<td style="text-align: right;">7.7823</td>
<td style="text-align: left;">W Main St @ Dominican Rd</td>
<td style="text-align: left;">Branford</td>
<td style="text-align: right;">-72.86029</td>
<td style="text-align: right;">41.27732</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="even">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4613</td>
<td style="text-align: left;">17:33:07</td>
<td style="text-align: left;">17:33:07</td>
<td style="text-align: right;">8.0512</td>
<td style="text-align: left;">W Main St @ Rose Hill Rd</td>
<td style="text-align: left;">Branford</td>
<td style="text-align: right;">-72.85712</td>
<td style="text-align: right;">41.27746</td>
<td style="text-align: left;">CT</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="data-cleaning" class="level1">
<h1>Data Cleaning</h1>
<ul>
<li><p>Identify wrong/incorrect/duplicate entries. Use anti_join to remove these records from our <code>ct_sales</code> data.</p></li>
<li><p>Remove properties whose sale prices are not comparable to similar properties due to foreclosure, private sale, change in property or other reasons based on the information provided in <code>non_use_code</code> column.</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplicates, incorrect property values, etc </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>to_remove <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">concerning =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(opm_remarks, <span class="fu">regex</span>(<span class="st">"duplicate|incorrect|wrong|error|missing"</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(concerning <span class="sc">==</span> <span class="st">"Yes"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Use anti_join to remove these incorrect/duplicate from `ct_sales` </span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(to_remove, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"serial_number"</span>, <span class="st">"address"</span>))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove properties with non_use_code </span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(non_use_code))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove transactions with `sale_amount` 0 </span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">filter</span>(sale_amount <span class="sc">&gt;</span> <span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-preprocessing" class="level1">
<h1>Data Preprocessing</h1>
<section id="proximity-to-nyc-a-grand-central-based-metric-for-measuring-access-to-the-city" class="level2">
<h2 class="anchored" data-anchor-id="proximity-to-nyc-a-grand-central-based-metric-for-measuring-access-to-the-city">Proximity to NYC: A Grand Central-Based Metric for Measuring Access to the City</h2>
<p>In this section, we first define the metric of proximity to NYC using Grand Central Terminal Station as the anchor point. Then, we calculate the distance from each property in <code>ct_sales</code> to it.</p>
<p>To calculate the distance, we address the following issues:</p>
<ol type="1">
<li>Properties with missing geographic coordinates:</li>
</ol>
<ul>
<li>Use matching <code>street_name</code> and <code>town</code> to impute the missing values</li>
<li>For the remaining cases, impute coordinates using town-level geometry data</li>
</ul>
<ol start="2" type="1">
<li>Properties with incorrect geographic coordinates:</li>
</ol>
<ul>
<li>Identify them using functions from the <code>sf</code> library</li>
<li>Correct them with town-level geometry</li>
</ul>
</section>
<section id="verify-mappings-between-property-addresses-and-their-geographic-coordinates" class="level2">
<h2 class="anchored" data-anchor-id="verify-mappings-between-property-addresses-and-their-geographic-coordinates">Verify Mappings Between Property Addresses and Their Geographic Coordinates</h2>
<p>To perform the verification, we first decompose the town-level geometries into points and compute the distance range from Grand Central Terminal. This serves as a benchmark to assess whether the mapping of geographic coordinates and addresses is accurate.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mutate a variable called `street_name` for `location` imputation later</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(address, <span class="st">"^</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">s+"</span>),    </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(street_name, <span class="st">"#.*$"</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(street_name, <span class="st">"(?&lt;!ROUTE</span><span class="sc">\\</span><span class="st">s)[A-Z]</span><span class="sc">\\</span><span class="st">d+$"</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(street_name, <span class="st">" UNIT.*"</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+$"</span>)) <span class="sc">&amp;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                   (<span class="sc">!</span><span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">bROUTE</span><span class="sc">\\</span><span class="st">b"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))) <span class="sc">~</span> <span class="fu">str_replace</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        street_name, <span class="st">"(RD|ROAD|DRIVE|DR|AV|AVE|AVENUE|ST|STREET|LANE|LN|LA|CIR|CT|COURT|TE).*"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> street_name</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+$"</span>)) <span class="sc">~</span> <span class="fu">str_remove</span>(street_name, <span class="st">"</span><span class="sc">\\</span><span class="st">s*U(N)?</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+$"</span>),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> street_name</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"^[A-Za-z]"</span>)) <span class="sc">~</span> street_name,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(<span class="fu">str_extract</span>(street_name, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s)[A-Za-z].*"</span>)) <span class="sc">~</span> street_name,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">str_extract</span>(street_name, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s)[A-Za-z].*"</span>) </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the first ten rows of data with the new variable included</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>sample_data_to_display <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ref_id, address, town, county, street_name, sale_amount) <span class="sc">|&gt;</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sample_data_to_display) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sample_data_to_display) <span class="sc">|&gt;</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">ref_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">address</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">county</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">street_name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sale_amount</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">323 BEAVER ST</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: left;">New Haven</td>
<td style="text-align: left;">BEAVER ST</td>
<td style="text-align: right;">248400</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">152 JACKSON ST</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: left;">New Haven</td>
<td style="text-align: left;">JACKSON ST</td>
<td style="text-align: right;">239900</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">230 WAKELEE AVE</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: left;">New Haven</td>
<td style="text-align: left;">WAKELEE AVE</td>
<td style="text-align: right;">325000</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">57 PLATT ST</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: left;">New Haven</td>
<td style="text-align: left;">PLATT ST</td>
<td style="text-align: right;">202500</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">12 BYRON DRIVE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">Hartford</td>
<td style="text-align: left;">BYRON DRIVE</td>
<td style="text-align: right;">362500</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">245 NEW ROAD</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">Hartford</td>
<td style="text-align: left;">NEW ROAD</td>
<td style="text-align: right;">400000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">63 NORTHGATE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">Hartford</td>
<td style="text-align: left;">NORTHGATE</td>
<td style="text-align: right;">775000</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">46 RATLUM MTN RD</td>
<td style="text-align: left;">Barkhamsted</td>
<td style="text-align: left;">Litchfield</td>
<td style="text-align: left;">RATLUM MTN RD</td>
<td style="text-align: right;">415000</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: left;">34 LASKY ROAD</td>
<td style="text-align: left;">Beacon Falls</td>
<td style="text-align: left;">New Haven</td>
<td style="text-align: left;">LASKY ROAD</td>
<td style="text-align: right;">243000</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">9 AVON COURT</td>
<td style="text-align: left;">Beacon Falls</td>
<td style="text-align: left;">New Haven</td>
<td style="text-align: left;">AVON COURT</td>
<td style="text-align: right;">100000</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object to compute the distance from Grand Central Terminal </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ct_sales_sf <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(location)) <span class="sc">|&gt;</span>         </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">location =</span> <span class="fu">st_as_sfc</span>(location, <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))) <span class="sc">|&gt;</span>     </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()  </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Grand Central Terminal sf object</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>grand_central <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">73.977229</span>, <span class="fl">40.752726</span>)), </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_sales_sf)) <span class="sc">|&gt;</span> <span class="fu">st_sf</span>()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>grand_central <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(grand_central, <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_sales_sf)) </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># These are the mappings that need verification</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>to_verify <span class="ot">&lt;-</span> ct_sales_sf <span class="sc">|&gt;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_dist_to_nyc =</span> </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(location, grand_central)<span class="sc">/</span><span class="dv">1000</span>), <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(location)[, <span class="dv">1</span>],</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(location)[, <span class="dv">2</span>]</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ref_id, address, street_name, town, lon, lat, point_dist_to_nyc)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(to_verify) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="define-a-function-to-compute-the-distance-range-for-each-town-from-grand-central-terminal" class="level3">
<h3 class="anchored" data-anchor-id="define-a-function-to-compute-the-distance-range-for-each-town-from-grand-central-terminal">Define a function to compute the distance range for each town from Grand Central Terminal</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to compute the distances from each point in the town </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># geometry and determine the distance range</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>compute_town_dist_range <span class="ot">&lt;-</span> <span class="cf">function</span>(town_name){</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  vertices <span class="ot">&lt;-</span> towns_sf <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(NAME <span class="sc">==</span> town_name) <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute distances in kilometers</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  distances <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(vertices, grand_central))<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">town =</span> town_name,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_dist_km =</span> <span class="fu">round</span>(<span class="fu">min</span>(distances), <span class="dv">2</span>),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_dist_km =</span> <span class="fu">round</span>(<span class="fu">max</span>(distances), <span class="dv">2</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>towns_sf <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">!=</span> <span class="st">"County subdivisions not defined"</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>town_list <span class="ot">&lt;-</span> towns_sf <span class="sc">|&gt;</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the distance range for each town from the anchor point: Grand Central Terminal </span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>town_distance_range <span class="ot">&lt;-</span> town_list <span class="sc">|&gt;</span> <span class="fu">map</span>(compute_town_dist_range) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>town_distance_range <span class="ot">&lt;-</span> town_distance_range <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="st">"TOWN"</span> <span class="ot">=</span> town)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify </span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>mappings_verified <span class="ot">&lt;-</span> to_verify <span class="sc">|&gt;</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(town_distance_range, <span class="at">by =</span> <span class="st">"town"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">between</span>(point_dist_to_nyc, min_dist_km, max_dist_km)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of verified coordinates </span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>first10_mappings_verified <span class="ot">&lt;-</span> mappings_verified <span class="sc">|&gt;</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(address, town, point_dist_to_nyc, min_dist_km, max_dist_km, is_valid_location) <span class="sc">|&gt;</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(first10_mappings_verified) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(first10_mappings_verified, </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"First 10 Rows of Verified Mappings"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 10 Rows of Verified Mappings</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">address</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">point_dist_to_nyc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">min_dist_km</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">max_dist_km</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">is_valid_location</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">323 BEAVER ST</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: right;">101.11</td>
<td style="text-align: right;">98.59</td>
<td style="text-align: right;">103.19</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">12 BYRON DRIVE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">145.97</td>
<td style="text-align: right;">144.31</td>
<td style="text-align: right;">154.63</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">63 NORTHGATE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">146.87</td>
<td style="text-align: right;">144.31</td>
<td style="text-align: right;">154.63</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">55 CANNON ST</td>
<td style="text-align: left;">Bridgeport</td>
<td style="text-align: right;">81.27</td>
<td style="text-align: right;">76.02</td>
<td style="text-align: right;">86.77</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">540 JAMES ST</td>
<td style="text-align: left;">Bridgeport</td>
<td style="text-align: right;">80.67</td>
<td style="text-align: right;">76.02</td>
<td style="text-align: right;">86.77</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">126 KENNEDY DR</td>
<td style="text-align: left;">Bridgeport</td>
<td style="text-align: right;">81.60</td>
<td style="text-align: right;">76.02</td>
<td style="text-align: right;">86.77</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">206 COVEY RD</td>
<td style="text-align: left;">Burlington</td>
<td style="text-align: right;">142.71</td>
<td style="text-align: right;">134.49</td>
<td style="text-align: right;">146.75</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">477 PERKINS ST</td>
<td style="text-align: left;">Bristol</td>
<td style="text-align: right;">134.69</td>
<td style="text-align: right;">129.00</td>
<td style="text-align: right;">140.65</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10 EBERT DR., #52</td>
<td style="text-align: left;">Bristol</td>
<td style="text-align: right;">133.44</td>
<td style="text-align: right;">129.00</td>
<td style="text-align: right;">140.65</td>
<td style="text-align: left;">TRUE</td>
</tr>
<tr class="even">
<td style="text-align: left;">108 COBB CITY ROAD</td>
<td style="text-align: left;">Colebrook</td>
<td style="text-align: right;">159.96</td>
<td style="text-align: right;">150.87</td>
<td style="text-align: right;">164.24</td>
<td style="text-align: left;">TRUE</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="handling-missing-geographic-data" class="level2">
<h2 class="anchored" data-anchor-id="handling-missing-geographic-data">Handling Missing Geographic Data</h2>
<p>Impute missing values of <code>location</code> based on verified correct mappings from the matching street name and town.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a unique street identifier by combining street_name and town</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">street_name1 =</span> <span class="fu">paste</span>(street_name, town))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a reference for `location` imputation using the verified mappings </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># between `address` and `location`</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>loc_imp_ref <span class="ot">&lt;-</span> mappings_verified <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(is_valid_location <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name1 =</span> <span class="fu">paste</span>(street_name, town)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ref_id, street_name1, lon, lat) <span class="sc">|&gt;</span>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(street_name1, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Begin by imputing `location` values using verified coordinates matched by </span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># `street_name` and `town`</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>ct_sales_imputed <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(location)) <span class="sc">|&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(loc_imp_ref, <span class="at">by =</span> <span class="st">"street_name1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref_id =</span> ref_id.x</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ref_id.y)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Add additional notes regarding the `location` values </span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>ct_sales_imputed <span class="ot">&lt;-</span> ct_sales_imputed <span class="sc">|&gt;</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span> <span class="fu">is.na</span>(lon) <span class="sc">&amp;</span> <span class="sc">!</span> <span class="fu">is.na</span>(lat)  <span class="sc">~</span> <span class="st">"value imputed based on matching street name and town"</span>,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"to fill with town-level geometry"</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co"># This subset of the data contains records whose location values were </span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co"># verified in the previous step</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>ct_sales_verified <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> </span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(location)) <span class="sc">|&gt;</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(location, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">().*?(?=</span><span class="sc">\\</span><span class="st">s)"</span>)),</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(location, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s)-?</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">))"</span>))</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mappings_verified <span class="sc">|&gt;</span> </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(ref_id, is_valid_location),</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"ref_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">as.character</span>(is_valid_location)</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine `ct_sales_imputed` and `ct_sales_verified`</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ct_sales_verified, ct_sales_imputed) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(ref_id)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Last, for properties with incorrect mapping and no matching street name and town, impute the `location` values using the town centroid</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>town_centroid <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">!=</span> <span class="st">"County subdivisions not defined"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">center =</span> <span class="fu">st_centroid</span>(geometry), </span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">centroid_lon =</span> <span class="fu">st_coordinates</span>(center)[, <span class="dv">1</span>],</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">centroid_lat =</span> <span class="fu">st_coordinates</span>(center)[, <span class="dv">2</span>]</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, centroid_lon, centroid_lat) <span class="sc">|&gt;</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME)</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(town_centroid, <span class="at">by =</span> <span class="st">"town"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FALSE"</span>, <span class="st">"to fill with town-level geometry"</span>) </span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> centroid_lon,</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> lon</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FALSE"</span>, <span class="st">"to fill with town-level geometry"</span>) </span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> centroid_lat,</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> lat</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">==</span> <span class="st">"FALSE"</span> <span class="sc">~</span> <span class="st">"corrected using the town centroid geometry"</span>,</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">==</span> <span class="st">"to fill with town-level geometry"</span> </span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="st">"value imputed using the town centroid geometry"</span>,</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> is_valid_location</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>centroid_lon, <span class="sc">-</span>centroid_lat) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="handling-categorical-missing-data-property-type" class="level2">
<h2 class="anchored" data-anchor-id="handling-categorical-missing-data-property-type">Handling Categorical Missing Data: Property Type</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">address1 =</span> <span class="fu">paste</span>(address, town))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Properties with missing property type </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(property_type))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>property_w_type <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(property_type))</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Find common properties in both categories </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>common_properties <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(address1) <span class="sc">|&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(address1) <span class="sc">|&gt;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(property_w_type <span class="sc">|&gt;</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>               <span class="fu">select</span>(address1, property_type, residential_type), </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="st">"address1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(address1, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in `property_type` by performing left joining  with `common_properties`</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(common_properties, <span class="at">by =</span> <span class="st">"address1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type.x =</span> property_type.y,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type.x =</span> residential_type.y</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>property_type.y, <span class="sc">-</span> residential_type.y) <span class="sc">|&gt;</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type =</span> property_type.x,</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type =</span> residential_type.x</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine updated properties with the existing `property_w_type` data frame</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>property_w_type <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  property_missing_type <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(property_type)),    </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  property_w_type</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co"># New subset of properties without `property_type`</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(property_type))</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(property_w_type, property_missing_type) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(ref_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<section id="what-is-the-total-number-of-real-estate-transactions-and-the-corresponding-aggregate-sale-volume-by-county" class="level2">
<h2 class="anchored" data-anchor-id="what-is-the-total-number-of-real-estate-transactions-and-the-corresponding-aggregate-sale-volume-by-county">1. What is the total number of real estate transactions and the corresponding aggregate sale volume by county?</h2>
<p>Fairfield County leads Connecticut in real estate activity, recording over 211,845 transactions and a total sales volume of $153 billion—nearly triple that of any other county. Hartford and New Haven follow with significant volumes of $58 billion and $53 billion, respectively, while the remaining counties contribute more modestly to the state’s overall market.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the total number of recorded properties by county </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>n_by_county <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">total_billion =</span> <span class="fu">round</span>(<span class="fu">sum</span>(sale_amount)<span class="sc">/</span><span class="fl">1e9</span>, <span class="dv">0</span>)) </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>n_by_county <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">comma</span>(n),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_billion =</span> <span class="fu">dollar</span>(total_billion, <span class="at">suffix =</span> <span class="st">"B"</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"County"</span>, <span class="st">"Transactions"</span>, <span class="st">"Total Volume (Billion)"</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"&lt;b&gt;&lt;span style='color:black'&gt;Table 1: Real Estate Transactions and Volume by County (2001–2022)&lt;/span&gt;&lt;/b&gt;"</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption><strong><span style="color:black">Table 1: Real Estate Transactions and Volume by County (2001–2022)</span></strong></caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">County</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Transactions</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Total Volume (Billion)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Fairfield</td>
<td style="text-align: left;">211,845</td>
<td style="text-align: left;">$153B</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hartford</td>
<td style="text-align: left;">193,427</td>
<td style="text-align: left;">$58B</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Litchfield</td>
<td style="text-align: left;">46,487</td>
<td style="text-align: left;">$15B</td>
</tr>
<tr class="even">
<td style="text-align: left;">Middlesex</td>
<td style="text-align: left;">41,392</td>
<td style="text-align: left;">$13B</td>
</tr>
<tr class="odd">
<td style="text-align: left;">New Haven</td>
<td style="text-align: left;">175,862</td>
<td style="text-align: left;">$53B</td>
</tr>
<tr class="even">
<td style="text-align: left;">New London</td>
<td style="text-align: left;">59,965</td>
<td style="text-align: left;">$17B</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tolland</td>
<td style="text-align: left;">29,732</td>
<td style="text-align: left;">$8B</td>
</tr>
<tr class="even">
<td style="text-align: left;">Windham</td>
<td style="text-align: left;">24,390</td>
<td style="text-align: left;">$5B</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="how-many-repeated-sales-are-there-in-each-county" class="level2">
<h2 class="anchored" data-anchor-id="how-many-repeated-sales-are-there-in-each-county">2. How many repeated sales are there in each county?</h2>
<p>Hartford County recorded the highest number of repeated sales with 30,721 transactions, followed closely by Fairfield County with 27,548. New Haven County also demonstrated strong market activity, with 27,213 repeated transactions during the period.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find repeated sales</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># repeated_sales &lt;- ct_sales_cleaned |&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(address1, list_year) |&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(address1) |&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(n() &gt; 1) |&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     town = first(town),</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     county = first(county),</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     property_type = first(property_type),</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     earliest_sale = first(sale_amount),</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     latest_sale = last(sale_amount),</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     chg_in_value = latest_sale - earliest_sale,</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     .groups = "drop"</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(repeated_sales, "repeated_sales.csv", row.names = FALSE)</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the saved data into R</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>repeated_sales <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"repeated_sales.csv"</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of repeated sales for each county </span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>n_repeated_sales_by_county <span class="ot">&lt;-</span> repeated_sales <span class="sc">|&gt;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(n_repeated_sales_by_county, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(county, <span class="sc">-</span>total), <span class="at">y =</span> total)) <span class="sc">+</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">comma</span>(total)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Number of Repeated Sales by County"</span>,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"County"</span>,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Repeated Sales"</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),        <span class="co"># Bold title</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()   </span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="how-much-have-average-single-family-home-values-changed-in-each-county" class="level2">
<h2 class="anchored" data-anchor-id="how-much-have-average-single-family-home-values-changed-in-each-county">3. How much have average single-family home values changed in each county?</h2>
<p>Rapid home price appreciation typically indicates a strong and robust market. Fairfield County stands out with the highest average increase in single-family home values, rising by approximately $172,000 between 2001 and 2022. This growth is more than double the appreciation seen in Middlesex and Litchfield counties, and over three times greater than in Hartford County. The substantial increase underscores Fairfield’s market strength. It also reinforces the pattern of declining price growth and increasing distance from New York City.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the mean change in value for each county </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>avg_value_by_county <span class="ot">&lt;-</span> repeated_sales <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Single Family"</span>, <span class="st">"Residential"</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg =</span> <span class="fu">mean</span>(chg_in_value)) <span class="sc">|&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg)) </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(avg_value_by_county, <span class="fu">aes</span>(<span class="at">x =</span> avg, <span class="at">y =</span> <span class="fu">reorder</span>(county, avg))) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2a9d8f"</span>) <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">dollar</span>(avg)), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>(), </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))) <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Property Value Appreciation"</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Single-Family Homes with Repeated Sales (by County)"</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Average Appreciation ($)"</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"County"</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()   </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="which-months-or-quarters-see-the-most-activity" class="level2">
<h2 class="anchored" data-anchor-id="which-months-or-quarters-see-the-most-activity">4. Which months or quarters see the most activity?</h2>
<p>An analysis of monthly real estate transactions in Connecticut reveals clear seasonal trends in sales volume. Transaction activity is lowest during the winter months, with January (47,181) and February (40,234) recording the fewest sales. As the market enters the spring and summer months, sales volume increases significantly, peaking in June with 84,100 transactions. July (82,882) and August (82,399) follow closely behind, highlighting a strong summer market.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the number of transactions by month </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>monthly_sales <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(date_recorded, <span class="at">format =</span> <span class="st">"%m/%d/%Y"</span>), <span class="st">"%m"</span>))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert month to factor with labels </span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>monthly_sales <span class="ot">&lt;-</span> monthly_sales <span class="sc">|&gt;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">factor</span>(month, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">labels =</span> month.name)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_sales, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> total)) <span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">comma</span>(total)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Real Estate Transactions in Connecticut"</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Transactions"</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-are-the-hotspots-for-high-value-transactions" class="level2">
<h2 class="anchored" data-anchor-id="what-are-the-hotspots-for-high-value-transactions">5. What are the hotspots for high-value transactions?</h2>
<p>The vast majority of high-value residential property sales (over $5 million) in Connecticut are concentrated in Fairfield County, which accounts for approximately 96.9% of such transactions. All other counties combined represent just 3.1%, highlighting Fairfield’s dominant position as the primary market for luxury real estate in the state.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of single family home sales with over 5 million for each county</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>hotspots <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>), </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>         sale_amount <span class="sc">&gt;</span> <span class="dv">5000000</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(county, <span class="at">name =</span> <span class="st">"count"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">county =</span> <span class="fu">ifelse</span>(percentage <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="st">"Others"</span>, county)) <span class="sc">|&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentage =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(county, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">round</span>(percentage, <span class="dv">1</span>), <span class="st">"%"</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Pie </span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>pie_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hotspots, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> count, <span class="at">fill =</span> county)) <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"High-Value Residential Sales by County"</span>) <span class="sc">+</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Fairfield"</span> <span class="ot">=</span> <span class="st">"#2a9d8f"</span>, <span class="st">"Others"</span> <span class="ot">=</span> <span class="st">"#e9c46a"</span>))</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a table </span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>high_value_summary <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>), </span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>         sale_amount <span class="sc">&gt;</span> <span class="dv">5000000</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">|&gt;</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentage =</span> <span class="fu">round</span>(count<span class="sc">/</span><span class="fu">sum</span>(count) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(high_value_summary) <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(<span class="fu">colnames</span>(high_value_summary))</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>hotspots_tbl <span class="ot">&lt;-</span> <span class="fu">tableGrob</span>(</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>  high_value_summary,</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">rows =</span> <span class="cn">NULL</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>pie_plot <span class="sc">+</span> <span class="fu">wrap_elements</span>(hotspots_tbl) <span class="sc">+</span></span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="feature-engineering" class="level1">
<h1>Feature Engineering</h1>
<section id="calculate-distance-km-from-grand-central-terminal-for-each-property" class="level2">
<h2 class="anchored" data-anchor-id="calculate-distance-km-from-grand-central-terminal-for-each-property">Calculate Distance (km) from Grand Central Terminal for Each Property</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object to compute the distance to Grand Central </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ct_sales_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(ct_sales_cleaned, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the distance from each property to Grand Central Terminal</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>ct_sales_sf <span class="ot">&lt;-</span> ct_sales_sf <span class="sc">|&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_dist_to_nyc =</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, grand_central)<span class="sc">/</span><span class="dv">1000</span>), <span class="dv">2</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ct_sales_sf <span class="sc">|&gt;</span> <span class="fu">select</span>(ref_id, point_dist_to_nyc),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"ref_id"</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(town_distance_range, <span class="at">by =</span> <span class="st">"town"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>TOWN)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># After performing feature engineering, select the desired columns for display</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    address, town, sale_amount, property_type, point_dist_to_nyc</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sample, <span class="at">caption =</span> <span class="st">"First 10 Rows of Data with First Predictor"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 10 Rows of Data with First Predictor</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">address</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sale_amount</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">property_type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">point_dist_to_nyc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">323 BEAVER ST</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: right;">248400</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">101.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">152 JACKSON ST</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: right;">239900</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">99.44</td>
</tr>
<tr class="odd">
<td style="text-align: left;">230 WAKELEE AVE</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: right;">325000</td>
<td style="text-align: left;">Commercial</td>
<td style="text-align: right;">99.33</td>
</tr>
<tr class="even">
<td style="text-align: left;">57 PLATT ST</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: right;">202500</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">99.56</td>
</tr>
<tr class="odd">
<td style="text-align: left;">12 BYRON DRIVE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">362500</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">145.97</td>
</tr>
<tr class="even">
<td style="text-align: left;">245 NEW ROAD</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">400000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">144.57</td>
</tr>
<tr class="odd">
<td style="text-align: left;">63 NORTHGATE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">775000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">146.87</td>
</tr>
<tr class="even">
<td style="text-align: left;">46 RATLUM MTN RD</td>
<td style="text-align: left;">Barkhamsted</td>
<td style="text-align: right;">415000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">154.95</td>
</tr>
<tr class="odd">
<td style="text-align: left;">34 LASKY ROAD</td>
<td style="text-align: left;">Beacon Falls</td>
<td style="text-align: right;">243000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">110.96</td>
</tr>
<tr class="even">
<td style="text-align: left;">9 AVON COURT</td>
<td style="text-align: left;">Beacon Falls</td>
<td style="text-align: right;">100000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">111.82</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="compute-distance-from-each-property-to-the-nearest-train-station" class="level2">
<h2 class="anchored" data-anchor-id="compute-distance-from-each-property-to-the-nearest-train-station">Compute Distance from Each Property to the Nearest Train Station</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to compute the distances from each train station for each property</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># compute_distance &lt;- function(stop_id_value){</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   stop &lt;- stops_sf |&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(stop_id == stop_id_value)</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Compute distances in kilometers</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   distances &lt;- as.numeric(st_distance(property_list, stop))/1000</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   data.frame(</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     dist = distances</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># property_list &lt;- ct_sales_sf |&gt; select(ref_id, geometry)</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co"># stop_list &lt;- stops |&gt;</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(stop_id) |&gt;</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull()</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># dist_to_train_stations &lt;- stop_list |&gt; map(compute_distance) |&gt; bind_cols()</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the distance to the nearest Metro-North station for each property</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># min_distance &lt;- apply(distance_to_train_stations[, 2:ncol(distance_to_train_stations)], 1, min, na.rm = TRUE)</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ref_idx &lt;- property_list |&gt; st_drop_geometry() |&gt; select(ref_id)</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co"># min_dist_to_train_station &lt;- cbind(ref_idx, min_distance)</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(min_dist_to_train_station, "min_dist.csv", row.names = FALSE)</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>min_dist <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"min_dist.csv"</span>)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Round the distance to the 10th place for readability</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>min_dist <span class="ot">&lt;-</span> min_dist <span class="sc">|&gt;</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_distance =</span> <span class="fu">round</span>(min_distance, <span class="dv">2</span>)</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span> <span class="fu">left_join</span>(min_dist, <span class="at">by =</span> <span class="st">"ref_id"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">nearest_rail_station_dist =</span> min_distance)</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co"># After performing feature engineering, select the desired columns for display</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>    address, town, sale_amount, property_type, point_dist_to_nyc, </span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>    nearest_rail_station_dist</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sample_data, <span class="at">caption =</span> <span class="st">"First 10 Rows of Data with Second Predictor"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 10 Rows of Data with Second Predictor</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">address</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sale_amount</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">property_type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">point_dist_to_nyc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">nearest_rail_station_dist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">323 BEAVER ST</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: right;">248400</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">101.11</td>
<td style="text-align: right;">1.18</td>
</tr>
<tr class="even">
<td style="text-align: left;">152 JACKSON ST</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: right;">239900</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">99.44</td>
<td style="text-align: right;">0.85</td>
</tr>
<tr class="odd">
<td style="text-align: left;">230 WAKELEE AVE</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: right;">325000</td>
<td style="text-align: left;">Commercial</td>
<td style="text-align: right;">99.33</td>
<td style="text-align: right;">0.92</td>
</tr>
<tr class="even">
<td style="text-align: left;">57 PLATT ST</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: right;">202500</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">99.56</td>
<td style="text-align: right;">1.29</td>
</tr>
<tr class="odd">
<td style="text-align: left;">12 BYRON DRIVE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">362500</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">145.97</td>
<td style="text-align: right;">28.19</td>
</tr>
<tr class="even">
<td style="text-align: left;">245 NEW ROAD</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">400000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">144.57</td>
<td style="text-align: right;">27.47</td>
</tr>
<tr class="odd">
<td style="text-align: left;">63 NORTHGATE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">775000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">146.87</td>
<td style="text-align: right;">29.60</td>
</tr>
<tr class="even">
<td style="text-align: left;">46 RATLUM MTN RD</td>
<td style="text-align: left;">Barkhamsted</td>
<td style="text-align: right;">415000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">154.95</td>
<td style="text-align: right;">40.26</td>
</tr>
<tr class="odd">
<td style="text-align: left;">34 LASKY ROAD</td>
<td style="text-align: left;">Beacon Falls</td>
<td style="text-align: right;">243000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">110.96</td>
<td style="text-align: right;">2.98</td>
</tr>
<tr class="even">
<td style="text-align: left;">9 AVON COURT</td>
<td style="text-align: left;">Beacon Falls</td>
<td style="text-align: right;">100000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">111.82</td>
<td style="text-align: right;">3.47</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="what-percentage-of-properties-in-fairfield-and-new-haven-counties-are-located-within-3-km-of-the-nearest-metro-north-station" class="level2">
<h2 class="anchored" data-anchor-id="what-percentage-of-properties-in-fairfield-and-new-haven-counties-are-located-within-3-km-of-the-nearest-metro-north-station">6. What percentage of properties in Fairfield and New Haven Counties are located within 3 km of the nearest Metro-North station?</h2>
<p>In Fairfield County, approximately 59% of all recorded property transactions (125,669 out of 211,845) are situated within this 3 km radius. This suggests that access to reliable commuter rail service may be a key driver of real estate activity in the region, particularly given Fairfield’s direct rail connectivity to New York City.</p>
<p>In contrast, New Haven County shows a different spatial pattern, with only 30% of its transactions (52,958 out of 175,862) occurring within the same proximity threshold.</p>
<p>Litchfield County has limited, indirect access to Metro-North service through a small number of peripheral stations, but the impact is far more subtle. Other counties in the state lack direct Metro-North connectivity altogether, which may contribute to differences in real estate volume and spatial distribution.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fairfield_new_haven <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nearest_rail_station_dist <span class="sc">&lt;</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(county <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Fairfield"</span>, <span class="st">"New Haven"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentage =</span> <span class="fu">round</span>(n<span class="sc">/</span>total, <span class="dv">2</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot long </span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>fairfield_new_haven <span class="ot">&lt;-</span> fairfield_new_haven <span class="sc">|&gt;</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">beyond =</span> total <span class="sc">-</span> n) <span class="sc">|&gt;</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, <span class="at">within =</span> n, beyond) <span class="sc">|&gt;</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(within, beyond), <span class="at">names_to =</span> <span class="st">"category"</span>, </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">ifelse</span>(category <span class="sc">==</span> <span class="st">"within"</span>, <span class="st">"Within 3 km"</span>, <span class="st">"Beyond 3 km"</span>))</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Fairfield</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>fairfield_pie <span class="ot">&lt;-</span> fairfield_new_haven <span class="sc">|&gt;</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(county <span class="sc">==</span> <span class="st">"Fairfield"</span>)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Fairfield pie </span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>fairfield_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fairfield_pie, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> value, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">percent</span>(value <span class="sc">/</span> <span class="fu">sum</span>(value))),</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Fairfield County"</span>) <span class="sc">+</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Within 3 km"</span> <span class="ot">=</span> <span class="st">"#2a9d8f"</span>, <span class="st">"Beyond 3 km"</span> <span class="ot">=</span> <span class="st">"#e9c46a"</span>))</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co"># New Haven</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>newhaven_pie <span class="ot">&lt;-</span> fairfield_new_haven <span class="sc">|&gt;</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(county <span class="sc">==</span> <span class="st">"New Haven"</span>)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot New Haven Pie</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>new_haven_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(newhaven_pie, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> value, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">percent</span>(value <span class="sc">/</span> <span class="fu">sum</span>(value))),</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"New Haven County"</span>) <span class="sc">+</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Within 3 km"</span> <span class="ot">=</span> <span class="st">"#4682B4"</span>, <span class="st">"Beyond 3 km"</span> <span class="ot">=</span> <span class="st">"#e9c46a"</span>))</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>(fairfield_plot <span class="sc">+</span> new_haven_plot) <span class="sc">+</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Proximity to Metro-North Station (Within 3 km)"</span>) <span class="sc">&amp;</span></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="how-does-proximity-to-the-nearest-train-station-correlate-with-home-values-in-fairfield-county" class="level2">
<h2 class="anchored" data-anchor-id="how-does-proximity-to-the-nearest-train-station-correlate-with-home-values-in-fairfield-county">7. How does proximity to the nearest train station correlate with home values in Fairfield County?</h2>
<p>The correlation between distance to the nearest Metro-North station and property sale price in Fairfield County is approximately -0.14, indicating a weak negative relationship. This suggests that, on average, properties located closer to train stations tend to have slightly higher sale prices, though the effect is modest.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fairfield <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residentital"</span>, <span class="st">"Single Family"</span>), </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>         county <span class="sc">==</span> <span class="st">"Fairfield"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sale_amount, nearest_rail_station_dist)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fairfield, <span class="fu">aes</span>(<span class="at">x =</span> nearest_rail_station_dist, <span class="at">y =</span> sale_amount)) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distance to Nearest Train Station and Home Price in Fairfield County"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Distance to Nearest Train Station (km)"</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Sale Amount (USD)"</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(fairfield<span class="sc">$</span>nearest_rail_station_dist, fairfield<span class="sc">$</span>sale_amount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1415876</code></pre>
</div>
</div>
</section>
<section id="how-does-proximity-to-new-york-city-correlate-with-home-values-across-connecticut" class="level2">
<h2 class="anchored" data-anchor-id="how-does-proximity-to-new-york-city-correlate-with-home-values-across-connecticut">8. How does proximity to New York City correlate with home values across Connecticut?</h2>
<p>Analysis reveals a moderate negative correlation of -0.51 between distance to New York City (measured from Grand Central Terminal) and log-transformed home sale prices across Connecticut. This suggests that, on average, properties located closer to New York City tend to command higher prices. While distance is not the sole determinant of home value, proximity to the metropolitan center appears to be a significant locational factor influencing real estate pricing, potentially reflecting demand for commuter access and economic opportunities.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ct_homes <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residentital"</span>, <span class="st">"Single Family"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_sale_amount =</span> <span class="fu">log</span>(sale_amount)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(log_sale_amount, point_dist_to_nyc)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ct_homes, <span class="fu">aes</span>(<span class="at">x =</span> point_dist_to_nyc, <span class="at">y =</span> log_sale_amount)) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Impact of Distance to Grand Central Terminal on Log-Transformed Home Prices"</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Distance to Grand Central Terminal (km)"</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Log-Transformed Sale Amount (USD)"</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(ct_homes<span class="sc">$</span>point_dist_to_nyc, ct_homes<span class="sc">$</span>log_sale_amount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.5144631</code></pre>
</div>
</div>
</section>
<section id="how-do-average-property-values-differ-by-property-type-between-new-haven-and-hartford-towns" class="level2">
<h2 class="anchored" data-anchor-id="how-do-average-property-values-differ-by-property-type-between-new-haven-and-hartford-towns">9. How do average property values differ by property type between New Haven and Hartford towns?</h2>
<p>Across multiple residential types, New Haven consistently commands higher prices than Hartford: on average, single-family homes are 41.38% more expensive, three-family homes are 32.94% higher, and two-family homes command a 17.82% premium. These patterns suggest that access to commuter rail significantly influences real estate demand and pricing power.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the average property value differences across property types between </span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the towns: New Haven and Hartford</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>new_haven_hartford_wide <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hartford"</span>, <span class="st">"New Haven"</span>), </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>         property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>, <span class="st">"Two Family"</span>, </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Three Family"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town, property_type) <span class="sc">|&gt;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg =</span> <span class="fu">mean</span>(sale_amount)) <span class="sc">|&gt;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> town,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> avg</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">price_pct_diff =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">round</span>((<span class="st">`</span><span class="at">New Haven</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Hartford</span><span class="st">`</span>)<span class="sc">/</span>(<span class="st">`</span><span class="at">Hartford</span><span class="st">`</span>), <span class="dv">4</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot long </span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>new_haven_hartford_long <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hartford"</span>, <span class="st">"New Haven"</span>), </span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>         property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>, <span class="st">"Two Family"</span>, </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Three Family"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town, property_type) <span class="sc">|&gt;</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg =</span> <span class="fu">mean</span>(sale_amount)) <span class="sc">|&gt;</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_haven_hartford_long, <span class="fu">aes</span>(<span class="at">x =</span> property_type, <span class="at">y =</span> avg, <span class="at">fill =</span> town)) <span class="sc">+</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>), <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">dollar</span>(avg)),</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>),</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.4</span>,</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">3.5</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Hartford"</span> <span class="ot">=</span> <span class="st">"#c81d25"</span>, <span class="st">"New Haven"</span> <span class="ot">=</span> <span class="st">"#4895ef"</span>)) <span class="sc">+</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Property Prices: New Haven vs. Hartford"</span>,</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Property Type"</span>,</span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Price (USD)"</span>,</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Town"</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="which-ten-towns-in-connecticut-have-the-highest-number-of-bus-stops" class="level2">
<h2 class="anchored" data-anchor-id="which-ten-towns-in-connecticut-have-the-highest-number-of-bus-stops">10. Which ten towns in Connecticut have the highest number of bus stops?”</h2>
<p>Based on the distribution of bus stops across Connecticut towns, we observe that Hartford, New Haven, and Waterbury lead in public transit infrastructure, each with more than 750 bus stops.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CT bus stops data</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(stops_file, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    stop_id, stop_code, stop_name, stop_lat, stop_lon,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Connecticut towns' geometry </span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>ct_towns_geom <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span> <span class="fu">select</span>(STATEFP, NAME)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a sf object based on the bus stop coordinate </span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>bus_stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(bus_stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain the town name for each bus stop using `st_join` </span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">st_join</span>(bus_stops_sf, ct_ny_towns_geom, <span class="at">join =</span> st_within) <span class="sc">|&gt;</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME) <span class="sc">|&gt;</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"09"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"36"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>STATEFP)</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of bus stops in each town</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>top10_town <span class="ot">&lt;-</span> bus_stops <span class="sc">|&gt;</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"CT"</span>) <span class="sc">|&gt;</span>        </span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town) <span class="sc">|&gt;</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_stops =</span> <span class="fu">n_distinct</span>(stop_id)) <span class="sc">|&gt;</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_stops)) <span class="sc">|&gt;</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(n_stops, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top10_town, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(town, n_stops), <span class="at">y =</span> n_stops)) <span class="sc">+</span></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2a9d8f"</span>) <span class="sc">+</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_stops), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 10 Connecticut Towns by Number of Bus Stops"</span>,</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Town"</span>,</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Bus Stops"</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-are-the-top-five-towns-with-the-most-connectivity-to-other-towns" class="level2">
<h2 class="anchored" data-anchor-id="what-are-the-top-five-towns-with-the-most-connectivity-to-other-towns">11. What are the top five towns with the most connectivity to other towns?</h2>
<p>Hartford stands out as the most connected town in Connecticut’s bus network, with direct connections to 62 other towns. This high level of connectivity underscores Hartford’s role as a central transportation hub in the region.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of trips that go between town pairs</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>town_edges <span class="ot">&lt;-</span> bus_trip_stop_data <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(trip_id) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">origin_town =</span> town[<span class="fu">which.min</span>(stop_sequence)],</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dest_town =</span> town[<span class="fu">which.max</span>(stop_sequence)],</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(origin_town <span class="sc">!=</span> dest_town) <span class="sc">|&gt;</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(origin_town, dest_town, <span class="at">name =</span> <span class="st">"weight"</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>town_graph <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(town_edges, <span class="at">directed =</span> <span class="cn">FALSE</span>) </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of towns a town connects to </span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>town_connectivity <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">town =</span> <span class="fu">V</span>(town_graph)<span class="sc">$</span>name,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">degree =</span> <span class="fu">degree</span>(town_graph)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(degree)) <span class="sc">|&gt;</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(town, degree) <span class="sc">|&gt;</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">n_connected_towns =</span> degree)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(town_connectivity) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the first top five towns with the highest connectivity to other towns </span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>top5_towns <span class="ot">&lt;-</span> town_connectivity <span class="sc">|&gt;</span> <span class="fu">slice_max</span>(n_connected_towns, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top5_towns, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(town, <span class="sc">-</span>n_connected_towns), </span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> n_connected_towns)) <span class="sc">+</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_connected_towns), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top Towns by Connectivity to Other Towns"</span>,</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Town"</span>,</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Connected Towns"</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-performance" class="level1">
<h1>Model Performance</h1>
<ul>
<li>The three predictors together explain 36% variation in real estate pricing in Connecticut.</li>
<li>Due to missing values in the property type variable, 223,811 observations were omitted in the model fitting process. This represents a limitation that should be addressed in future work.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Center the predictor `nearest_rail_station_dist` as it is highly correlated </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with `point_dist_to_nyc`</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">centered_nearest_rail_station_dist =</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(nearest_rail_station_dist <span class="sc">-</span> <span class="fu">mean</span>(nearest_rail_station_dist), <span class="dv">2</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply a log transformation to predicting variable: `sale_amount` and fit a </span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># linear regression model using three predictors</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(sale_amount) <span class="sc">~</span> point_dist_to_nyc <span class="sc">+</span> </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>              centered_nearest_rail_station_dist <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>              property_type, <span class="at">data =</span> ct_sales_cleaned)</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(sale_amount) ~ point_dist_to_nyc + centered_nearest_rail_station_dist + 
    property_type, data = ct_sales_cleaned)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.1003 -0.3346 -0.0118  0.3305  5.8462 

Coefficients:
                                     Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept)                         1.587e+01  1.780e-02  891.860  &lt; 2e-16 ***
point_dist_to_nyc                  -1.837e-02  4.475e-05 -410.592  &lt; 2e-16 ***
centered_nearest_rail_station_dist  1.816e-02  7.075e-05  256.757  &lt; 2e-16 ***
property_typeCommercial            -3.024e-01  1.918e-02  -15.764  &lt; 2e-16 ***
property_typeCondo                 -1.507e+00  1.694e-02  -88.995  &lt; 2e-16 ***
property_typeFour Family           -1.069e+00  2.372e-02  -45.065  &lt; 2e-16 ***
property_typeIndustrial             1.385e-01  2.933e-02    4.722 2.34e-06 ***
property_typePublic Utility        -1.404e+00  3.460e-01   -4.058 4.95e-05 ***
property_typeResidential           -8.983e-01  1.689e-02  -53.201  &lt; 2e-16 ***
property_typeSingle Family         -9.433e-01  1.684e-02  -56.012  &lt; 2e-16 ***
property_typeThree Family          -1.207e+00  1.828e-02  -66.013  &lt; 2e-16 ***
property_typeTwo Family            -1.276e+00  1.748e-02  -72.966  &lt; 2e-16 ***
property_typeVacant Land           -1.930e+00  1.933e-02  -99.871  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5986 on 559276 degrees of freedom
  (223811 observations deleted due to missingness)
Multiple R-squared:  0.3615,    Adjusted R-squared:  0.3615 
F-statistic: 2.639e+04 on 12 and 559276 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="future-work" class="level1">
<h1>Future Work</h1>
<ul>
<li><p>There are several challenges and limitations we aim to address in future work. First, we plan to obtain accurate property type classifications for properties with missing values. Our initial attempt to impute property type using the nearest neighbor method proved to be unreliable.</p></li>
<li><p>We also intend to explore alternative statistical learning models to train the dataset. Given the large volume of observations in the Connecticut real estate dataset, implementing models such as random forests may require significant computational resources.</p></li>
<li><p>Additionally, we are interested in applying network theory to model the connectivity among towns. This could help us better understand whether certain structural or regional factors contribute to the distribution of real estate pricing in Connecticut.</p></li>
</ul>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Based on our analysis and model performance, we found a moderate relationship between property values in Connecticut and two key factors: proximity to the economic center—New York City—and direct accessibility to rail stations. The impact on home values is more pronounced, with values tending to decrease moderately as the distance from these economic and transportation hubs increases.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/hongzhuang1\.github\.io\/STA9750-2025-SPRING\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb30" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Course Project: How does proximity to NYC impact the real estate pricing in Connecticut?"</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> Hong Zhuang</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true       </span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true        </span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true              </span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf: default</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(warning=FALSE, message=FALSE)</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction and Motivation</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>The spatial distribution of real estate activity across Connecticut reveals a </span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>notable geographic trend: counties located closer to major urban economic centers, </span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>particularly New York City, exhibit stronger market performance. Fairfield County, </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>situated in the southwestern corner of the state, stands out as the most active </span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>real estate market. According to the dataset, it recorded 211,845 property </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>transactions between 2001 and 2022—the highest among all counties—spanning </span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>residential, commercial, vacant land, and public utility properties(see Table 1). </span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>This market strength is accompanied by the highest total dollar volume of </span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>transactions, signaling both high demand and high property values.</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>A key differentiation for Fairfield is its geographical proximity to NYC and </span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>accessibility via the Metro-North Railroad, which positions it as a prime </span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>location for commuters seeking suburban living with urban job opportunities. </span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>This suggests that connectivity to economic hubs may play a significant role </span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>in driving property values and transaction volumes.</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>Motivated by this observation, this analysis aims to examine how distance from </span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>New York City correlates with real estate market activity across Connecticut </span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>counties. By quantifying this relationship, we can better understand the extent </span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>to which geographic accessibility influences housing demand and pricing—offering </span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>valuable insights for urban planners, real estate developers/analysts, and policy </span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>makers.</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Acquisition</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Connecticut Real Estate Sales Dataset</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>The primary data source used in our analysis is available at: <span class="co">[</span><span class="ot">CT Real Estate Sales</span><span class="co">](https://data.ct.gov/Housing-and-Development/Real-Estate-Sales-2001-2022-GL/5mzw-sjtu/about_data)</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Load relevant packages</span></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) </span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales) </span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)   </span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmaptools)</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris) </span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb30-70"><a href="#cb30-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-71"><a href="#cb30-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Direct download link for the sales data</span></span>
<span id="cb30-72"><a href="#cb30-72" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://data.ct.gov/api/views/5mzw-sjtu/rows.csv?accessType=DOWNLOAD"</span></span>
<span id="cb30-73"><a href="#cb30-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-74"><a href="#cb30-74" aria-hidden="true" tabindex="-1"></a>data_dir <span class="ot">&lt;-</span> <span class="st">"data/course_project"</span></span>
<span id="cb30-75"><a href="#cb30-75" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"ct_sales.csv"</span>)</span>
<span id="cb30-76"><a href="#cb30-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-77"><a href="#cb30-77" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(data_dir)){</span>
<span id="cb30-78"><a href="#cb30-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(data_dir, <span class="at">showWarnings=</span><span class="cn">FALSE</span>, <span class="at">recursive=</span><span class="cn">TRUE</span>)</span>
<span id="cb30-79"><a href="#cb30-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-80"><a href="#cb30-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-81"><a href="#cb30-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Download file only if it doesn't already exist</span></span>
<span id="cb30-82"><a href="#cb30-82" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"data/course_project/ct_sales.csv"</span>)){</span>
<span id="cb30-83"><a href="#cb30-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(url, <span class="at">destfile =</span> file_name, <span class="at">mode =</span> <span class="st">"wb"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-84"><a href="#cb30-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-85"><a href="#cb30-85" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb30-86"><a href="#cb30-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Read sales data into R</span></span>
<span id="cb30-87"><a href="#cb30-87" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file_name)</span>
<span id="cb30-88"><a href="#cb30-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-89"><a href="#cb30-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Format `ct_sales` column names </span></span>
<span id="cb30-90"><a href="#cb30-90" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ct_sales) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"_"</span>, <span class="fu">colnames</span>(ct_sales)))</span>
<span id="cb30-91"><a href="#cb30-91" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ct_sales) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, <span class="fu">colnames</span>(ct_sales)))</span>
<span id="cb30-92"><a href="#cb30-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-93"><a href="#cb30-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a unique ID for each transaction to facilitate easier referencing </span></span>
<span id="cb30-94"><a href="#cb30-94" aria-hidden="true" tabindex="-1"></a><span class="co"># and joining with other data sources</span></span>
<span id="cb30-95"><a href="#cb30-95" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb30-96"><a href="#cb30-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_id =</span> <span class="fu">row_number</span>()</span>
<span id="cb30-97"><a href="#cb30-97" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-98"><a href="#cb30-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb30-99"><a href="#cb30-99" aria-hidden="true" tabindex="-1"></a>    ref_id,</span>
<span id="cb30-100"><a href="#cb30-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">everything</span>()</span>
<span id="cb30-101"><a href="#cb30-101" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-102"><a href="#cb30-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-103"><a href="#cb30-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the town name for records with "unknown" value</span></span>
<span id="cb30-104"><a href="#cb30-104" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb30-105"><a href="#cb30-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-106"><a href="#cb30-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">town =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-107"><a href="#cb30-107" aria-hidden="true" tabindex="-1"></a>      town <span class="sc">==</span>   <span class="st">"***Unknown***"</span> <span class="sc">~</span> <span class="st">"East Hampton"</span>,</span>
<span id="cb30-108"><a href="#cb30-108" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> town</span>
<span id="cb30-109"><a href="#cb30-109" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-110"><a href="#cb30-110" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-111"><a href="#cb30-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-112"><a href="#cb30-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Map each town to its corresponding county </span></span>
<span id="cb30-113"><a href="#cb30-113" aria-hidden="true" tabindex="-1"></a>ct_town_county_codes<span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/STA9750/STA9750-2025-SPRING/ct_town_county_codes.csv"</span>)</span>
<span id="cb30-114"><a href="#cb30-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-115"><a href="#cb30-115" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb30-116"><a href="#cb30-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb30-117"><a href="#cb30-117" aria-hidden="true" tabindex="-1"></a>    ct_town_county_codes <span class="sc">|&gt;</span> <span class="fu">select</span>(town_name, county),</span>
<span id="cb30-118"><a href="#cb30-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"town"</span> <span class="ot">=</span> <span class="st">"town_name"</span>)</span>
<span id="cb30-119"><a href="#cb30-119" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-120"><a href="#cb30-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-121"><a href="#cb30-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb30-122"><a href="#cb30-122" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(ct_sales, <span class="dv">10</span>), <span class="at">caption =</span> <span class="st">"First 10 Rows of CT Real Estate Sales"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-123"><a href="#cb30-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb30-124"><a href="#cb30-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-125"><a href="#cb30-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-126"><a href="#cb30-126" aria-hidden="true" tabindex="-1"></a><span class="fu">## Download Connecticut County and Town Shapefiles</span></span>
<span id="cb30-127"><a href="#cb30-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-130"><a href="#cb30-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-131"><a href="#cb30-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Read county shapefile into R</span></span>
<span id="cb30-132"><a href="#cb30-132" aria-hidden="true" tabindex="-1"></a>county_shp_url <span class="ot">&lt;-</span> <span class="st">"https://www2.census.gov/geo/tiger/TIGER2020/COUNTY/tl_2020_us_county.zip"</span></span>
<span id="cb30-133"><a href="#cb30-133" aria-hidden="true" tabindex="-1"></a>zip_county_shp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"tl_2020_us_county.zip"</span>)</span>
<span id="cb30-134"><a href="#cb30-134" aria-hidden="true" tabindex="-1"></a>unzip_county_shp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"tl_2020_us_county"</span>)</span>
<span id="cb30-135"><a href="#cb30-135" aria-hidden="true" tabindex="-1"></a>county_shp_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_county_shp_path, <span class="st">"tl_2020_us_county.shp"</span>)</span>
<span id="cb30-136"><a href="#cb30-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-137"><a href="#cb30-137" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(county_shp_file)){</span>
<span id="cb30-138"><a href="#cb30-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(county_shp_url, <span class="at">destfile =</span> zip_county_shp_path, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-139"><a href="#cb30-139" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-140"><a href="#cb30-140" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unzip</span></span>
<span id="cb30-141"><a href="#cb30-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(<span class="at">zipfile =</span> zip_county_shp_path, <span class="at">exdir =</span> unzip_county_shp_path)</span>
<span id="cb30-142"><a href="#cb30-142" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-143"><a href="#cb30-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-144"><a href="#cb30-144" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">&lt;-</span> <span class="fu">st_read</span>(county_shp_file, <span class="at">quiet =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> <span class="fu">filter</span>(STATEFP <span class="sc">==</span> <span class="st">"09"</span>)</span>
<span id="cb30-145"><a href="#cb30-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-146"><a href="#cb30-146" aria-hidden="true" tabindex="-1"></a><span class="co"># Read town shapefile into R</span></span>
<span id="cb30-147"><a href="#cb30-147" aria-hidden="true" tabindex="-1"></a>town_shp_url <span class="ot">&lt;-</span> <span class="st">"https://www2.census.gov/geo/tiger/TIGER2020/COUSUB/tl_2020_09_cousub.zip"</span></span>
<span id="cb30-148"><a href="#cb30-148" aria-hidden="true" tabindex="-1"></a>zip_town_shp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"tl_2020_09_cousub.zip"</span>)</span>
<span id="cb30-149"><a href="#cb30-149" aria-hidden="true" tabindex="-1"></a>unzip_town_shp_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"tl_2020_09_cousub"</span>)</span>
<span id="cb30-150"><a href="#cb30-150" aria-hidden="true" tabindex="-1"></a>town_shp_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_town_shp_path,<span class="st">"tl_2020_09_cousub.shp"</span>)</span>
<span id="cb30-151"><a href="#cb30-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-152"><a href="#cb30-152" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(town_shp_file)){</span>
<span id="cb30-153"><a href="#cb30-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(town_shp_url, <span class="at">destfile =</span> zip_town_shp_path, <span class="at">mode =</span> <span class="st">"wb"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-154"><a href="#cb30-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-155"><a href="#cb30-155" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unzip shapefiles</span></span>
<span id="cb30-156"><a href="#cb30-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(<span class="at">zipfile =</span> zip_town_shp_path, <span class="at">exdir =</span> unzip_town_shp_path)</span>
<span id="cb30-157"><a href="#cb30-157" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-158"><a href="#cb30-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-159"><a href="#cb30-159" aria-hidden="true" tabindex="-1"></a>ct_towns <span class="ot">&lt;-</span> <span class="fu">st_read</span>(town_shp_file, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-160"><a href="#cb30-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-161"><a href="#cb30-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-162"><a href="#cb30-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-163"><a href="#cb30-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-164"><a href="#cb30-164" aria-hidden="true" tabindex="-1"></a><span class="fu">## Metro-North Railroad</span></span>
<span id="cb30-165"><a href="#cb30-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-168"><a href="#cb30-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-169"><a href="#cb30-169" aria-hidden="true" tabindex="-1"></a><span class="co"># Download Metro-North stops </span></span>
<span id="cb30-170"><a href="#cb30-170" aria-hidden="true" tabindex="-1"></a>gtfs_url <span class="ot">&lt;-</span> <span class="st">"https://rrgtfsfeeds.s3.amazonaws.com/gtfsmnr.zip"</span></span>
<span id="cb30-171"><a href="#cb30-171" aria-hidden="true" tabindex="-1"></a>zip_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"gtfsmnr.zip"</span>)</span>
<span id="cb30-172"><a href="#cb30-172" aria-hidden="true" tabindex="-1"></a>unzip_file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"metro-north"</span>)</span>
<span id="cb30-173"><a href="#cb30-173" aria-hidden="true" tabindex="-1"></a>stops_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_file_path, <span class="st">"stops.txt"</span>)</span>
<span id="cb30-174"><a href="#cb30-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-175"><a href="#cb30-175" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(data_dir)){</span>
<span id="cb30-176"><a href="#cb30-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(data_dir, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-177"><a href="#cb30-177" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-178"><a href="#cb30-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-179"><a href="#cb30-179" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(stops_file)){</span>
<span id="cb30-180"><a href="#cb30-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(gtfs_url, <span class="at">destfile =</span> zip_path, <span class="at">mode =</span> <span class="st">"wb"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-181"><a href="#cb30-181" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-182"><a href="#cb30-182" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unzip files</span></span>
<span id="cb30-183"><a href="#cb30-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(<span class="at">zipfile =</span> zip_path, <span class="at">exdir =</span> unzip_file_path)</span>
<span id="cb30-184"><a href="#cb30-184" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-185"><a href="#cb30-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-186"><a href="#cb30-186" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Metro-North stops data into R</span></span>
<span id="cb30-187"><a href="#cb30-187" aria-hidden="true" tabindex="-1"></a>stops <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(stops_file, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb30-188"><a href="#cb30-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-189"><a href="#cb30-189" aria-hidden="true" tabindex="-1"></a><span class="co"># Connecticut towns' geometry </span></span>
<span id="cb30-190"><a href="#cb30-190" aria-hidden="true" tabindex="-1"></a>ct_towns_geom <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span> <span class="fu">select</span>(STATEFP, NAME)</span>
<span id="cb30-191"><a href="#cb30-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-192"><a href="#cb30-192" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb30-193"><a href="#cb30-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-194"><a href="#cb30-194" aria-hidden="true" tabindex="-1"></a><span class="co"># # ny_towns &lt;- county_subdivisions(state = "NY")</span></span>
<span id="cb30-195"><a href="#cb30-195" aria-hidden="true" tabindex="-1"></a><span class="co"># # ny_towns_geom &lt;- ny_towns |&gt; select(STATEFP, NAME)</span></span>
<span id="cb30-196"><a href="#cb30-196" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(ny_towns_geom, "ny_towns_geom.rds")</span></span>
<span id="cb30-197"><a href="#cb30-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-198"><a href="#cb30-198" aria-hidden="true" tabindex="-1"></a>ny_towns_geom <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ny_towns_geom.rds"</span>)</span>
<span id="cb30-199"><a href="#cb30-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-200"><a href="#cb30-200" aria-hidden="true" tabindex="-1"></a>ct_ny_towns_geom <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ct_towns_geom, ny_towns_geom)</span>
<span id="cb30-201"><a href="#cb30-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-202"><a href="#cb30-202" aria-hidden="true" tabindex="-1"></a>stops <span class="ot">&lt;-</span> stops <span class="sc">|&gt;</span> <span class="fu">select</span>(stop_id, stop_name, stop_lon, stop_lat)</span>
<span id="cb30-203"><a href="#cb30-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-204"><a href="#cb30-204" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object of Metro-North stops</span></span>
<span id="cb30-205"><a href="#cb30-205" aria-hidden="true" tabindex="-1"></a>stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb30-206"><a href="#cb30-206" aria-hidden="true" tabindex="-1"></a>                     <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb30-207"><a href="#cb30-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-208"><a href="#cb30-208" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the state and the town for each station</span></span>
<span id="cb30-209"><a href="#cb30-209" aria-hidden="true" tabindex="-1"></a>stops <span class="ot">&lt;-</span> <span class="fu">st_join</span>(stops_sf, ct_ny_towns_geom, <span class="at">join =</span> st_within) <span class="sc">|&gt;</span> </span>
<span id="cb30-210"><a href="#cb30-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-211"><a href="#cb30-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb30-212"><a href="#cb30-212" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb30-213"><a href="#cb30-213" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-214"><a href="#cb30-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-215"><a href="#cb30-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME) <span class="sc">|&gt;</span></span>
<span id="cb30-216"><a href="#cb30-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-217"><a href="#cb30-217" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-218"><a href="#cb30-218" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"09"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb30-219"><a href="#cb30-219" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"36"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb30-220"><a href="#cb30-220" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb30-221"><a href="#cb30-221" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-222"><a href="#cb30-222" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-223"><a href="#cb30-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>STATEFP) <span class="sc">|&gt;</span></span>
<span id="cb30-224"><a href="#cb30-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(stops, <span class="at">by =</span> <span class="st">"stop_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-225"><a href="#cb30-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb30-226"><a href="#cb30-226" aria-hidden="true" tabindex="-1"></a>    <span class="at">stop_name =</span> stop_name.x</span>
<span id="cb30-227"><a href="#cb30-227" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-228"><a href="#cb30-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>stop_name.y)</span>
<span id="cb30-229"><a href="#cb30-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-230"><a href="#cb30-230" aria-hidden="true" tabindex="-1"></a>stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb30-231"><a href="#cb30-231" aria-hidden="true" tabindex="-1"></a>                     <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb30-232"><a href="#cb30-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-233"><a href="#cb30-233" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the first ten rows to display</span></span>
<span id="cb30-234"><a href="#cb30-234" aria-hidden="true" tabindex="-1"></a>to_display <span class="ot">&lt;-</span> stops <span class="sc">|&gt;</span></span>
<span id="cb30-235"><a href="#cb30-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(stop_id, stop_name, town, state, stop_lon, stop_lat) <span class="sc">|&gt;</span></span>
<span id="cb30-236"><a href="#cb30-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb30-237"><a href="#cb30-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-238"><a href="#cb30-238" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb30-239"><a href="#cb30-239" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(to_display, <span class="at">caption =</span> <span class="st">"First 10 Rows of Metro-North Stations"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-240"><a href="#cb30-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb30-241"><a href="#cb30-241" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-242"><a href="#cb30-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-243"><a href="#cb30-243" aria-hidden="true" tabindex="-1"></a><span class="fu">## Download CT transit Data</span></span>
<span id="cb30-244"><a href="#cb30-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-247"><a href="#cb30-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-248"><a href="#cb30-248" aria-hidden="true" tabindex="-1"></a><span class="co"># GTFS file URL for CT transit data </span></span>
<span id="cb30-249"><a href="#cb30-249" aria-hidden="true" tabindex="-1"></a>ct_bus_url <span class="ot">&lt;-</span> <span class="st">"https://www.cttransit.com/sites/default/files/gtfs/googlect_transit.zip"</span></span>
<span id="cb30-250"><a href="#cb30-250" aria-hidden="true" tabindex="-1"></a>zip_file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"googlect_transit.zip"</span>)</span>
<span id="cb30-251"><a href="#cb30-251" aria-hidden="true" tabindex="-1"></a>unzip_file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(data_dir, <span class="st">"ct_bus"</span>)</span>
<span id="cb30-252"><a href="#cb30-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-253"><a href="#cb30-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Check files </span></span>
<span id="cb30-254"><a href="#cb30-254" aria-hidden="true" tabindex="-1"></a>files_to_unzip <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"stops.txt"</span>, <span class="st">"trips.txt"</span>, <span class="st">"stop_times.txt"</span>)</span>
<span id="cb30-255"><a href="#cb30-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-256"><a href="#cb30-256" aria-hidden="true" tabindex="-1"></a>files_to_check <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_file_path, files_to_unzip)</span>
<span id="cb30-257"><a href="#cb30-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-258"><a href="#cb30-258" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">all</span>(<span class="fu">file.exists</span>(files_to_check))){</span>
<span id="cb30-259"><a href="#cb30-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(ct_bus_url, <span class="at">destfile =</span> zip_file_path, <span class="at">mode =</span> <span class="st">"wb"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-260"><a href="#cb30-260" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-261"><a href="#cb30-261" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unzip</span></span>
<span id="cb30-262"><a href="#cb30-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(<span class="at">zipfile =</span> zip_file_path, <span class="at">exdir =</span> unzip_file_path)</span>
<span id="cb30-263"><a href="#cb30-263" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-264"><a href="#cb30-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-265"><a href="#cb30-265" aria-hidden="true" tabindex="-1"></a><span class="co"># Read relevant files into R</span></span>
<span id="cb30-266"><a href="#cb30-266" aria-hidden="true" tabindex="-1"></a>stops_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_file_path, <span class="st">"stops.txt"</span>)</span>
<span id="cb30-267"><a href="#cb30-267" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(stops_file, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, </span>
<span id="cb30-268"><a href="#cb30-268" aria-hidden="true" tabindex="-1"></a>                        <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-269"><a href="#cb30-269" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb30-270"><a href="#cb30-270" aria-hidden="true" tabindex="-1"></a>    stop_id, stop_code, stop_name, stop_lat, stop_lon,</span>
<span id="cb30-271"><a href="#cb30-271" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-272"><a href="#cb30-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-273"><a href="#cb30-273" aria-hidden="true" tabindex="-1"></a>stop_times_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_file_path, <span class="st">"stop_times.txt"</span>)</span>
<span id="cb30-274"><a href="#cb30-274" aria-hidden="true" tabindex="-1"></a>stop_times <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(stop_times_file, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>,</span>
<span id="cb30-275"><a href="#cb30-275" aria-hidden="true" tabindex="-1"></a>                         <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb30-276"><a href="#cb30-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-277"><a href="#cb30-277" aria-hidden="true" tabindex="-1"></a>trips_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(unzip_file_path, <span class="st">"trips.txt"</span>)</span>
<span id="cb30-278"><a href="#cb30-278" aria-hidden="true" tabindex="-1"></a>trips <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(trips_file, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, </span>
<span id="cb30-279"><a href="#cb30-279" aria-hidden="true" tabindex="-1"></a>                    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb30-280"><a href="#cb30-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-281"><a href="#cb30-281" aria-hidden="true" tabindex="-1"></a><span class="co"># Map bus stop to town </span></span>
<span id="cb30-282"><a href="#cb30-282" aria-hidden="true" tabindex="-1"></a>bus_stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(bus_stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb30-283"><a href="#cb30-283" aria-hidden="true" tabindex="-1"></a>                     <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb30-284"><a href="#cb30-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-285"><a href="#cb30-285" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">st_join</span>(bus_stops_sf, ct_ny_towns_geom, <span class="at">join =</span> st_within) <span class="sc">|&gt;</span> </span>
<span id="cb30-286"><a href="#cb30-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-287"><a href="#cb30-287" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb30-288"><a href="#cb30-288" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb30-289"><a href="#cb30-289" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-290"><a href="#cb30-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-291"><a href="#cb30-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME) <span class="sc">|&gt;</span></span>
<span id="cb30-292"><a href="#cb30-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-293"><a href="#cb30-293" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-294"><a href="#cb30-294" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"09"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb30-295"><a href="#cb30-295" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"36"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb30-296"><a href="#cb30-296" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb30-297"><a href="#cb30-297" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-298"><a href="#cb30-298" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-299"><a href="#cb30-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>STATEFP)</span>
<span id="cb30-300"><a href="#cb30-300" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-301"><a href="#cb30-301" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine these data sets to obtain trip-level bus data in Connecticut</span></span>
<span id="cb30-302"><a href="#cb30-302" aria-hidden="true" tabindex="-1"></a>bus_trip_stop_data <span class="ot">&lt;-</span> stop_times <span class="sc">|&gt;</span></span>
<span id="cb30-303"><a href="#cb30-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bus_stops, <span class="at">by =</span> <span class="st">"stop_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-304"><a href="#cb30-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(trips, <span class="at">by =</span> <span class="st">"trip_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-305"><a href="#cb30-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb30-306"><a href="#cb30-306" aria-hidden="true" tabindex="-1"></a>    trip_id,</span>
<span id="cb30-307"><a href="#cb30-307" aria-hidden="true" tabindex="-1"></a>    route_id,</span>
<span id="cb30-308"><a href="#cb30-308" aria-hidden="true" tabindex="-1"></a>    block_id,</span>
<span id="cb30-309"><a href="#cb30-309" aria-hidden="true" tabindex="-1"></a>    shape_id,</span>
<span id="cb30-310"><a href="#cb30-310" aria-hidden="true" tabindex="-1"></a>    stop_sequence,</span>
<span id="cb30-311"><a href="#cb30-311" aria-hidden="true" tabindex="-1"></a>    stop_id,</span>
<span id="cb30-312"><a href="#cb30-312" aria-hidden="true" tabindex="-1"></a>    arrival_time,</span>
<span id="cb30-313"><a href="#cb30-313" aria-hidden="true" tabindex="-1"></a>    departure_time,</span>
<span id="cb30-314"><a href="#cb30-314" aria-hidden="true" tabindex="-1"></a>    shape_dist_traveled,</span>
<span id="cb30-315"><a href="#cb30-315" aria-hidden="true" tabindex="-1"></a>    stop_name,</span>
<span id="cb30-316"><a href="#cb30-316" aria-hidden="true" tabindex="-1"></a>    town,</span>
<span id="cb30-317"><a href="#cb30-317" aria-hidden="true" tabindex="-1"></a>    lon,</span>
<span id="cb30-318"><a href="#cb30-318" aria-hidden="true" tabindex="-1"></a>    lat,</span>
<span id="cb30-319"><a href="#cb30-319" aria-hidden="true" tabindex="-1"></a>    state,</span>
<span id="cb30-320"><a href="#cb30-320" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-321"><a href="#cb30-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-322"><a href="#cb30-322" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows</span></span>
<span id="cb30-323"><a href="#cb30-323" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(bus_trip_stop_data, <span class="dv">10</span>), <span class="at">caption =</span> <span class="st">"First 10 Rows of CT Bus Trips"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-324"><a href="#cb30-324" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb30-325"><a href="#cb30-325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-326"><a href="#cb30-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-327"><a href="#cb30-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-328"><a href="#cb30-328" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Cleaning  </span></span>
<span id="cb30-329"><a href="#cb30-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-330"><a href="#cb30-330" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Identify wrong/incorrect/duplicate entries. Use anti_join to remove these records </span>
<span id="cb30-331"><a href="#cb30-331" aria-hidden="true" tabindex="-1"></a>  from our <span class="in">`ct_sales`</span> data.</span>
<span id="cb30-332"><a href="#cb30-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-333"><a href="#cb30-333" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Remove properties whose sale prices are not comparable to similar properties </span>
<span id="cb30-334"><a href="#cb30-334" aria-hidden="true" tabindex="-1"></a>  due to foreclosure, private sale, change in property or other reasons based </span>
<span id="cb30-335"><a href="#cb30-335" aria-hidden="true" tabindex="-1"></a>  on the information provided in <span class="in">`non_use_code`</span> column.</span>
<span id="cb30-336"><a href="#cb30-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-339"><a href="#cb30-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-340"><a href="#cb30-340" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplicates, incorrect property values, etc </span></span>
<span id="cb30-341"><a href="#cb30-341" aria-hidden="true" tabindex="-1"></a>to_remove <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb30-342"><a href="#cb30-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-343"><a href="#cb30-343" aria-hidden="true" tabindex="-1"></a>  <span class="at">concerning =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-344"><a href="#cb30-344" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(opm_remarks, <span class="fu">regex</span>(<span class="st">"duplicate|incorrect|wrong|error|missing"</span>, </span>
<span id="cb30-345"><a href="#cb30-345" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb30-346"><a href="#cb30-346" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No"</span>)</span>
<span id="cb30-347"><a href="#cb30-347" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb30-348"><a href="#cb30-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(concerning <span class="sc">==</span> <span class="st">"Yes"</span>)</span>
<span id="cb30-349"><a href="#cb30-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-350"><a href="#cb30-350" aria-hidden="true" tabindex="-1"></a><span class="co"># Use anti_join to remove these incorrect/duplicate from `ct_sales` </span></span>
<span id="cb30-351"><a href="#cb30-351" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb30-352"><a href="#cb30-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(to_remove, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"serial_number"</span>, <span class="st">"address"</span>))</span>
<span id="cb30-353"><a href="#cb30-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-354"><a href="#cb30-354" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove properties with non_use_code </span></span>
<span id="cb30-355"><a href="#cb30-355" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(non_use_code))</span>
<span id="cb30-356"><a href="#cb30-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-357"><a href="#cb30-357" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove transactions with `sale_amount` 0 </span></span>
<span id="cb30-358"><a href="#cb30-358" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">filter</span>(sale_amount <span class="sc">&gt;</span> <span class="dv">10000</span>)</span>
<span id="cb30-359"><a href="#cb30-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-360"><a href="#cb30-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-361"><a href="#cb30-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-362"><a href="#cb30-362" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Preprocessing </span></span>
<span id="cb30-363"><a href="#cb30-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-364"><a href="#cb30-364" aria-hidden="true" tabindex="-1"></a><span class="fu">## Proximity to NYC: A Grand Central-Based Metric for Measuring Access to the City</span></span>
<span id="cb30-365"><a href="#cb30-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-366"><a href="#cb30-366" aria-hidden="true" tabindex="-1"></a>In this section, we first define the metric of proximity to NYC using </span>
<span id="cb30-367"><a href="#cb30-367" aria-hidden="true" tabindex="-1"></a>Grand Central Terminal Station as the anchor point. Then, we calculate the </span>
<span id="cb30-368"><a href="#cb30-368" aria-hidden="true" tabindex="-1"></a>distance from each property in <span class="in">`ct_sales`</span> to it.</span>
<span id="cb30-369"><a href="#cb30-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-370"><a href="#cb30-370" aria-hidden="true" tabindex="-1"></a>To calculate the distance, we address the following issues:</span>
<span id="cb30-371"><a href="#cb30-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-372"><a href="#cb30-372" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Properties with missing geographic coordinates:</span>
<span id="cb30-373"><a href="#cb30-373" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Use matching <span class="in">`street_name`</span> and <span class="in">`town`</span> to impute the missing values </span>
<span id="cb30-374"><a href="#cb30-374" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>For the remaining cases, impute coordinates using town-level geometry data</span>
<span id="cb30-375"><a href="#cb30-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-376"><a href="#cb30-376" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Properties with incorrect geographic coordinates: </span>
<span id="cb30-377"><a href="#cb30-377" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Identify them using functions from the <span class="in">`sf`</span> library</span>
<span id="cb30-378"><a href="#cb30-378" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Correct them with town-level geometry </span>
<span id="cb30-379"><a href="#cb30-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-380"><a href="#cb30-380" aria-hidden="true" tabindex="-1"></a><span class="fu">## Verify Mappings Between Property Addresses and Their Geographic Coordinates </span></span>
<span id="cb30-381"><a href="#cb30-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-382"><a href="#cb30-382" aria-hidden="true" tabindex="-1"></a>To perform the verification, we first decompose the town-level geometries into </span>
<span id="cb30-383"><a href="#cb30-383" aria-hidden="true" tabindex="-1"></a>points and compute the distance range from Grand Central Terminal. This serves </span>
<span id="cb30-384"><a href="#cb30-384" aria-hidden="true" tabindex="-1"></a>as a benchmark to assess whether the mapping of geographic coordinates and </span>
<span id="cb30-385"><a href="#cb30-385" aria-hidden="true" tabindex="-1"></a>addresses is accurate.</span>
<span id="cb30-386"><a href="#cb30-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-389"><a href="#cb30-389" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-390"><a href="#cb30-390" aria-hidden="true" tabindex="-1"></a><span class="co"># Mutate a variable called `street_name` for `location` imputation later</span></span>
<span id="cb30-391"><a href="#cb30-391" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb30-392"><a href="#cb30-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-393"><a href="#cb30-393" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(address, <span class="st">"^</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">s+"</span>),    </span>
<span id="cb30-394"><a href="#cb30-394" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(street_name, <span class="st">"#.*$"</span>),</span>
<span id="cb30-395"><a href="#cb30-395" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(street_name, <span class="st">"(?&lt;!ROUTE</span><span class="sc">\\</span><span class="st">s)[A-Z]</span><span class="sc">\\</span><span class="st">d+$"</span>),</span>
<span id="cb30-396"><a href="#cb30-396" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(street_name, <span class="st">" UNIT.*"</span>),</span>
<span id="cb30-397"><a href="#cb30-397" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-398"><a href="#cb30-398" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+$"</span>)) <span class="sc">&amp;</span></span>
<span id="cb30-399"><a href="#cb30-399" aria-hidden="true" tabindex="-1"></a>                   (<span class="sc">!</span><span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">bROUTE</span><span class="sc">\\</span><span class="st">b"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))) <span class="sc">~</span> <span class="fu">str_replace</span>(</span>
<span id="cb30-400"><a href="#cb30-400" aria-hidden="true" tabindex="-1"></a>        street_name, <span class="st">"(RD|ROAD|DRIVE|DR|AV|AVE|AVENUE|ST|STREET|LANE|LN|LA|CIR|CT|COURT|TE).*"</span>,</span>
<span id="cb30-401"><a href="#cb30-401" aria-hidden="true" tabindex="-1"></a>        <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span></span>
<span id="cb30-402"><a href="#cb30-402" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb30-403"><a href="#cb30-403" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> street_name</span>
<span id="cb30-404"><a href="#cb30-404" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb30-405"><a href="#cb30-405" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-406"><a href="#cb30-406" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+$"</span>)) <span class="sc">~</span> <span class="fu">str_remove</span>(street_name, <span class="st">"</span><span class="sc">\\</span><span class="st">s*U(N)?</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+$"</span>),</span>
<span id="cb30-407"><a href="#cb30-407" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> street_name</span>
<span id="cb30-408"><a href="#cb30-408" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb30-409"><a href="#cb30-409" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-410"><a href="#cb30-410" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"^[A-Za-z]"</span>)) <span class="sc">~</span> street_name,</span>
<span id="cb30-411"><a href="#cb30-411" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(<span class="fu">str_extract</span>(street_name, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s)[A-Za-z].*"</span>)) <span class="sc">~</span> street_name,</span>
<span id="cb30-412"><a href="#cb30-412" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">str_extract</span>(street_name, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s)[A-Za-z].*"</span>) </span>
<span id="cb30-413"><a href="#cb30-413" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-414"><a href="#cb30-414" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb30-415"><a href="#cb30-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-416"><a href="#cb30-416" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the first ten rows of data with the new variable included</span></span>
<span id="cb30-417"><a href="#cb30-417" aria-hidden="true" tabindex="-1"></a>sample_data_to_display <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb30-418"><a href="#cb30-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ref_id, address, town, county, street_name, sale_amount) <span class="sc">|&gt;</span></span>
<span id="cb30-419"><a href="#cb30-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb30-420"><a href="#cb30-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-421"><a href="#cb30-421" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sample_data_to_display) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb30-422"><a href="#cb30-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-423"><a href="#cb30-423" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sample_data_to_display) <span class="sc">|&gt;</span></span>
<span id="cb30-424"><a href="#cb30-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb30-425"><a href="#cb30-425" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-426"><a href="#cb30-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-429"><a href="#cb30-429" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-430"><a href="#cb30-430" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object to compute the distance from Grand Central Terminal </span></span>
<span id="cb30-431"><a href="#cb30-431" aria-hidden="true" tabindex="-1"></a>ct_sales_sf <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> </span>
<span id="cb30-432"><a href="#cb30-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(location)) <span class="sc">|&gt;</span>         </span>
<span id="cb30-433"><a href="#cb30-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">location =</span> <span class="fu">st_as_sfc</span>(location, <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))) <span class="sc">|&gt;</span>     </span>
<span id="cb30-434"><a href="#cb30-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()  </span>
<span id="cb30-435"><a href="#cb30-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-436"><a href="#cb30-436" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Grand Central Terminal sf object</span></span>
<span id="cb30-437"><a href="#cb30-437" aria-hidden="true" tabindex="-1"></a>grand_central <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">73.977229</span>, <span class="fl">40.752726</span>)), </span>
<span id="cb30-438"><a href="#cb30-438" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_sales_sf)) <span class="sc">|&gt;</span> <span class="fu">st_sf</span>()</span>
<span id="cb30-439"><a href="#cb30-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-440"><a href="#cb30-440" aria-hidden="true" tabindex="-1"></a>grand_central <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(grand_central, <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_sales_sf)) </span>
<span id="cb30-441"><a href="#cb30-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-442"><a href="#cb30-442" aria-hidden="true" tabindex="-1"></a><span class="co"># These are the mappings that need verification</span></span>
<span id="cb30-443"><a href="#cb30-443" aria-hidden="true" tabindex="-1"></a>to_verify <span class="ot">&lt;-</span> ct_sales_sf <span class="sc">|&gt;</span></span>
<span id="cb30-444"><a href="#cb30-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-445"><a href="#cb30-445" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_dist_to_nyc =</span> </span>
<span id="cb30-446"><a href="#cb30-446" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(location, grand_central)<span class="sc">/</span><span class="dv">1000</span>), <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb30-447"><a href="#cb30-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-448"><a href="#cb30-448" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(location)[, <span class="dv">1</span>],</span>
<span id="cb30-449"><a href="#cb30-449" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(location)[, <span class="dv">2</span>]</span>
<span id="cb30-450"><a href="#cb30-450" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-451"><a href="#cb30-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-452"><a href="#cb30-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ref_id, address, street_name, town, lon, lat, point_dist_to_nyc)</span>
<span id="cb30-453"><a href="#cb30-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-454"><a href="#cb30-454" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(to_verify) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb30-455"><a href="#cb30-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-456"><a href="#cb30-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-457"><a href="#cb30-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-458"><a href="#cb30-458" aria-hidden="true" tabindex="-1"></a><span class="fu">### Define a function to compute the distance range for each town from Grand Central Terminal</span></span>
<span id="cb30-459"><a href="#cb30-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-462"><a href="#cb30-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-463"><a href="#cb30-463" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to compute the distances from each point in the town </span></span>
<span id="cb30-464"><a href="#cb30-464" aria-hidden="true" tabindex="-1"></a><span class="co"># geometry and determine the distance range</span></span>
<span id="cb30-465"><a href="#cb30-465" aria-hidden="true" tabindex="-1"></a>compute_town_dist_range <span class="ot">&lt;-</span> <span class="cf">function</span>(town_name){</span>
<span id="cb30-466"><a href="#cb30-466" aria-hidden="true" tabindex="-1"></a>  vertices <span class="ot">&lt;-</span> towns_sf <span class="sc">|&gt;</span></span>
<span id="cb30-467"><a href="#cb30-467" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(NAME <span class="sc">==</span> town_name) <span class="sc">|&gt;</span></span>
<span id="cb30-468"><a href="#cb30-468" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-469"><a href="#cb30-469" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-470"><a href="#cb30-470" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-471"><a href="#cb30-471" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)</span>
<span id="cb30-472"><a href="#cb30-472" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-473"><a href="#cb30-473" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute distances in kilometers</span></span>
<span id="cb30-474"><a href="#cb30-474" aria-hidden="true" tabindex="-1"></a>  distances <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(vertices, grand_central))<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb30-475"><a href="#cb30-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-476"><a href="#cb30-476" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb30-477"><a href="#cb30-477" aria-hidden="true" tabindex="-1"></a>    <span class="at">town =</span> town_name,</span>
<span id="cb30-478"><a href="#cb30-478" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_dist_km =</span> <span class="fu">round</span>(<span class="fu">min</span>(distances), <span class="dv">2</span>),</span>
<span id="cb30-479"><a href="#cb30-479" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_dist_km =</span> <span class="fu">round</span>(<span class="fu">max</span>(distances), <span class="dv">2</span>)</span>
<span id="cb30-480"><a href="#cb30-480" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-481"><a href="#cb30-481" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-482"><a href="#cb30-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-483"><a href="#cb30-483" aria-hidden="true" tabindex="-1"></a>towns_sf <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span></span>
<span id="cb30-484"><a href="#cb30-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">!=</span> <span class="st">"County subdivisions not defined"</span>)</span>
<span id="cb30-485"><a href="#cb30-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-486"><a href="#cb30-486" aria-hidden="true" tabindex="-1"></a>town_list <span class="ot">&lt;-</span> towns_sf <span class="sc">|&gt;</span></span>
<span id="cb30-487"><a href="#cb30-487" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-488"><a href="#cb30-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb30-489"><a href="#cb30-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb30-490"><a href="#cb30-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-491"><a href="#cb30-491" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the distance range for each town from the anchor point: Grand Central Terminal </span></span>
<span id="cb30-492"><a href="#cb30-492" aria-hidden="true" tabindex="-1"></a>town_distance_range <span class="ot">&lt;-</span> town_list <span class="sc">|&gt;</span> <span class="fu">map</span>(compute_town_dist_range) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb30-493"><a href="#cb30-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-494"><a href="#cb30-494" aria-hidden="true" tabindex="-1"></a>town_distance_range <span class="ot">&lt;-</span> town_distance_range <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="st">"TOWN"</span> <span class="ot">=</span> town)</span>
<span id="cb30-495"><a href="#cb30-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-496"><a href="#cb30-496" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify </span></span>
<span id="cb30-497"><a href="#cb30-497" aria-hidden="true" tabindex="-1"></a>mappings_verified <span class="ot">&lt;-</span> to_verify <span class="sc">|&gt;</span></span>
<span id="cb30-498"><a href="#cb30-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(town_distance_range, <span class="at">by =</span> <span class="st">"town"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-499"><a href="#cb30-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-500"><a href="#cb30-500" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">between</span>(point_dist_to_nyc, min_dist_km, max_dist_km)</span>
<span id="cb30-501"><a href="#cb30-501" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-502"><a href="#cb30-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-503"><a href="#cb30-503" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of verified coordinates </span></span>
<span id="cb30-504"><a href="#cb30-504" aria-hidden="true" tabindex="-1"></a>first10_mappings_verified <span class="ot">&lt;-</span> mappings_verified <span class="sc">|&gt;</span></span>
<span id="cb30-505"><a href="#cb30-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(address, town, point_dist_to_nyc, min_dist_km, max_dist_km, is_valid_location) <span class="sc">|&gt;</span></span>
<span id="cb30-506"><a href="#cb30-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb30-507"><a href="#cb30-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-508"><a href="#cb30-508" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(first10_mappings_verified) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb30-509"><a href="#cb30-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-510"><a href="#cb30-510" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(first10_mappings_verified, </span>
<span id="cb30-511"><a href="#cb30-511" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"First 10 Rows of Verified Mappings"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-512"><a href="#cb30-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb30-513"><a href="#cb30-513" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-514"><a href="#cb30-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-515"><a href="#cb30-515" aria-hidden="true" tabindex="-1"></a><span class="fu">## Handling Missing Geographic Data</span></span>
<span id="cb30-516"><a href="#cb30-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-517"><a href="#cb30-517" aria-hidden="true" tabindex="-1"></a>Impute missing values of <span class="in">`location`</span> based on verified correct mappings from the </span>
<span id="cb30-518"><a href="#cb30-518" aria-hidden="true" tabindex="-1"></a>matching street name and town. </span>
<span id="cb30-519"><a href="#cb30-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-522"><a href="#cb30-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-523"><a href="#cb30-523" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a unique street identifier by combining street_name and town</span></span>
<span id="cb30-524"><a href="#cb30-524" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">street_name1 =</span> <span class="fu">paste</span>(street_name, town))</span>
<span id="cb30-525"><a href="#cb30-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-526"><a href="#cb30-526" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a reference for `location` imputation using the verified mappings </span></span>
<span id="cb30-527"><a href="#cb30-527" aria-hidden="true" tabindex="-1"></a><span class="co"># between `address` and `location`</span></span>
<span id="cb30-528"><a href="#cb30-528" aria-hidden="true" tabindex="-1"></a>loc_imp_ref <span class="ot">&lt;-</span> mappings_verified <span class="sc">|&gt;</span></span>
<span id="cb30-529"><a href="#cb30-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(is_valid_location <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-530"><a href="#cb30-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-531"><a href="#cb30-531" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name1 =</span> <span class="fu">paste</span>(street_name, town)</span>
<span id="cb30-532"><a href="#cb30-532" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-533"><a href="#cb30-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ref_id, street_name1, lon, lat) <span class="sc">|&gt;</span>  </span>
<span id="cb30-534"><a href="#cb30-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(street_name1, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-535"><a href="#cb30-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-536"><a href="#cb30-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-537"><a href="#cb30-537" aria-hidden="true" tabindex="-1"></a><span class="co"># Begin by imputing `location` values using verified coordinates matched by </span></span>
<span id="cb30-538"><a href="#cb30-538" aria-hidden="true" tabindex="-1"></a><span class="co"># `street_name` and `town`</span></span>
<span id="cb30-539"><a href="#cb30-539" aria-hidden="true" tabindex="-1"></a>ct_sales_imputed <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> </span>
<span id="cb30-540"><a href="#cb30-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(location)) <span class="sc">|&gt;</span></span>
<span id="cb30-541"><a href="#cb30-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(loc_imp_ref, <span class="at">by =</span> <span class="st">"street_name1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-542"><a href="#cb30-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb30-543"><a href="#cb30-543" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref_id =</span> ref_id.x</span>
<span id="cb30-544"><a href="#cb30-544" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-545"><a href="#cb30-545" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ref_id.y)</span>
<span id="cb30-546"><a href="#cb30-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-547"><a href="#cb30-547" aria-hidden="true" tabindex="-1"></a><span class="co"># Add additional notes regarding the `location` values </span></span>
<span id="cb30-548"><a href="#cb30-548" aria-hidden="true" tabindex="-1"></a>ct_sales_imputed <span class="ot">&lt;-</span> ct_sales_imputed <span class="sc">|&gt;</span></span>
<span id="cb30-549"><a href="#cb30-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-550"><a href="#cb30-550" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-551"><a href="#cb30-551" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span> <span class="fu">is.na</span>(lon) <span class="sc">&amp;</span> <span class="sc">!</span> <span class="fu">is.na</span>(lat)  <span class="sc">~</span> <span class="st">"value imputed based on matching street name and town"</span>,</span>
<span id="cb30-552"><a href="#cb30-552" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"to fill with town-level geometry"</span></span>
<span id="cb30-553"><a href="#cb30-553" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-554"><a href="#cb30-554" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-555"><a href="#cb30-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-556"><a href="#cb30-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-557"><a href="#cb30-557" aria-hidden="true" tabindex="-1"></a><span class="co"># This subset of the data contains records whose location values were </span></span>
<span id="cb30-558"><a href="#cb30-558" aria-hidden="true" tabindex="-1"></a><span class="co"># verified in the previous step</span></span>
<span id="cb30-559"><a href="#cb30-559" aria-hidden="true" tabindex="-1"></a>ct_sales_verified <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> </span>
<span id="cb30-560"><a href="#cb30-560" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(location)) <span class="sc">|&gt;</span></span>
<span id="cb30-561"><a href="#cb30-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-562"><a href="#cb30-562" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(location, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">().*?(?=</span><span class="sc">\\</span><span class="st">s)"</span>)),</span>
<span id="cb30-563"><a href="#cb30-563" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(location, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s)-?</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">))"</span>))</span>
<span id="cb30-564"><a href="#cb30-564" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-565"><a href="#cb30-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mappings_verified <span class="sc">|&gt;</span> </span>
<span id="cb30-566"><a href="#cb30-566" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(ref_id, is_valid_location),</span>
<span id="cb30-567"><a href="#cb30-567" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"ref_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-568"><a href="#cb30-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-569"><a href="#cb30-569" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">as.character</span>(is_valid_location)</span>
<span id="cb30-570"><a href="#cb30-570" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-571"><a href="#cb30-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-572"><a href="#cb30-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-573"><a href="#cb30-573" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine `ct_sales_imputed` and `ct_sales_verified`</span></span>
<span id="cb30-574"><a href="#cb30-574" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ct_sales_verified, ct_sales_imputed) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(ref_id)</span>
<span id="cb30-575"><a href="#cb30-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-576"><a href="#cb30-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-577"><a href="#cb30-577" aria-hidden="true" tabindex="-1"></a><span class="co"># Last, for properties with incorrect mapping and no matching street name and town, impute the `location` values using the town centroid</span></span>
<span id="cb30-578"><a href="#cb30-578" aria-hidden="true" tabindex="-1"></a>town_centroid <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span></span>
<span id="cb30-579"><a href="#cb30-579" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">!=</span> <span class="st">"County subdivisions not defined"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-580"><a href="#cb30-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-581"><a href="#cb30-581" aria-hidden="true" tabindex="-1"></a>    <span class="at">center =</span> <span class="fu">st_centroid</span>(geometry), </span>
<span id="cb30-582"><a href="#cb30-582" aria-hidden="true" tabindex="-1"></a>    <span class="at">centroid_lon =</span> <span class="fu">st_coordinates</span>(center)[, <span class="dv">1</span>],</span>
<span id="cb30-583"><a href="#cb30-583" aria-hidden="true" tabindex="-1"></a>    <span class="at">centroid_lat =</span> <span class="fu">st_coordinates</span>(center)[, <span class="dv">2</span>]</span>
<span id="cb30-584"><a href="#cb30-584" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-585"><a href="#cb30-585" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-586"><a href="#cb30-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, centroid_lon, centroid_lat) <span class="sc">|&gt;</span></span>
<span id="cb30-587"><a href="#cb30-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME)</span>
<span id="cb30-588"><a href="#cb30-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-589"><a href="#cb30-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-590"><a href="#cb30-590" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb30-591"><a href="#cb30-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(town_centroid, <span class="at">by =</span> <span class="st">"town"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-592"><a href="#cb30-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-593"><a href="#cb30-593" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-594"><a href="#cb30-594" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FALSE"</span>, <span class="st">"to fill with town-level geometry"</span>) </span>
<span id="cb30-595"><a href="#cb30-595" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> centroid_lon,</span>
<span id="cb30-596"><a href="#cb30-596" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> lon</span>
<span id="cb30-597"><a href="#cb30-597" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb30-598"><a href="#cb30-598" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-599"><a href="#cb30-599" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FALSE"</span>, <span class="st">"to fill with town-level geometry"</span>) </span>
<span id="cb30-600"><a href="#cb30-600" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> centroid_lat,</span>
<span id="cb30-601"><a href="#cb30-601" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> lat</span>
<span id="cb30-602"><a href="#cb30-602" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-603"><a href="#cb30-603" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-604"><a href="#cb30-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-605"><a href="#cb30-605" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-606"><a href="#cb30-606" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">==</span> <span class="st">"FALSE"</span> <span class="sc">~</span> <span class="st">"corrected using the town centroid geometry"</span>,</span>
<span id="cb30-607"><a href="#cb30-607" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">==</span> <span class="st">"to fill with town-level geometry"</span> </span>
<span id="cb30-608"><a href="#cb30-608" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="st">"value imputed using the town centroid geometry"</span>,</span>
<span id="cb30-609"><a href="#cb30-609" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> is_valid_location</span>
<span id="cb30-610"><a href="#cb30-610" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-611"><a href="#cb30-611" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-612"><a href="#cb30-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-613"><a href="#cb30-613" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>centroid_lon, <span class="sc">-</span>centroid_lat) </span>
<span id="cb30-614"><a href="#cb30-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-615"><a href="#cb30-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-616"><a href="#cb30-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-617"><a href="#cb30-617" aria-hidden="true" tabindex="-1"></a><span class="fu">## Handling Categorical Missing Data: Property Type</span></span>
<span id="cb30-618"><a href="#cb30-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-621"><a href="#cb30-621" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-622"><a href="#cb30-622" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">address1 =</span> <span class="fu">paste</span>(address, town))</span>
<span id="cb30-623"><a href="#cb30-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-624"><a href="#cb30-624" aria-hidden="true" tabindex="-1"></a><span class="co"># Properties with missing property type </span></span>
<span id="cb30-625"><a href="#cb30-625" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb30-626"><a href="#cb30-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(property_type))</span>
<span id="cb30-627"><a href="#cb30-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-628"><a href="#cb30-628" aria-hidden="true" tabindex="-1"></a>property_w_type <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb30-629"><a href="#cb30-629" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(property_type))</span>
<span id="cb30-630"><a href="#cb30-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-631"><a href="#cb30-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-632"><a href="#cb30-632" aria-hidden="true" tabindex="-1"></a><span class="co"># Find common properties in both categories </span></span>
<span id="cb30-633"><a href="#cb30-633" aria-hidden="true" tabindex="-1"></a>common_properties <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb30-634"><a href="#cb30-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(address1) <span class="sc">|&gt;</span></span>
<span id="cb30-635"><a href="#cb30-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(address1) <span class="sc">|&gt;</span></span>
<span id="cb30-636"><a href="#cb30-636" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(property_w_type <span class="sc">|&gt;</span> </span>
<span id="cb30-637"><a href="#cb30-637" aria-hidden="true" tabindex="-1"></a>               <span class="fu">select</span>(address1, property_type, residential_type), </span>
<span id="cb30-638"><a href="#cb30-638" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="st">"address1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-639"><a href="#cb30-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(address1, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-640"><a href="#cb30-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-641"><a href="#cb30-641" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in `property_type` by performing left joining  with `common_properties`</span></span>
<span id="cb30-642"><a href="#cb30-642" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb30-643"><a href="#cb30-643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(common_properties, <span class="at">by =</span> <span class="st">"address1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-644"><a href="#cb30-644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-645"><a href="#cb30-645" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type.x =</span> property_type.y,</span>
<span id="cb30-646"><a href="#cb30-646" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type.x =</span> residential_type.y</span>
<span id="cb30-647"><a href="#cb30-647" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-648"><a href="#cb30-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>property_type.y, <span class="sc">-</span> residential_type.y) <span class="sc">|&gt;</span></span>
<span id="cb30-649"><a href="#cb30-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb30-650"><a href="#cb30-650" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type =</span> property_type.x,</span>
<span id="cb30-651"><a href="#cb30-651" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type =</span> residential_type.x</span>
<span id="cb30-652"><a href="#cb30-652" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb30-653"><a href="#cb30-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-654"><a href="#cb30-654" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine updated properties with the existing `property_w_type` data frame</span></span>
<span id="cb30-655"><a href="#cb30-655" aria-hidden="true" tabindex="-1"></a>property_w_type <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb30-656"><a href="#cb30-656" aria-hidden="true" tabindex="-1"></a>  property_missing_type <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(property_type)),    </span>
<span id="cb30-657"><a href="#cb30-657" aria-hidden="true" tabindex="-1"></a>  property_w_type</span>
<span id="cb30-658"><a href="#cb30-658" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-659"><a href="#cb30-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-660"><a href="#cb30-660" aria-hidden="true" tabindex="-1"></a><span class="co"># New subset of properties without `property_type`</span></span>
<span id="cb30-661"><a href="#cb30-661" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb30-662"><a href="#cb30-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(property_type))</span>
<span id="cb30-663"><a href="#cb30-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-664"><a href="#cb30-664" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(property_w_type, property_missing_type) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(ref_id)</span>
<span id="cb30-665"><a href="#cb30-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-666"><a href="#cb30-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-667"><a href="#cb30-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-668"><a href="#cb30-668" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exploratory Data Analysis</span></span>
<span id="cb30-669"><a href="#cb30-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-670"><a href="#cb30-670" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1. What is the total number of real estate transactions and the corresponding aggregate sale volume by county?</span></span>
<span id="cb30-671"><a href="#cb30-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-672"><a href="#cb30-672" aria-hidden="true" tabindex="-1"></a>Fairfield County leads Connecticut in real estate activity, recording over 211,845 </span>
<span id="cb30-673"><a href="#cb30-673" aria-hidden="true" tabindex="-1"></a>transactions and a total sales volume of $153 billion—nearly triple that of any </span>
<span id="cb30-674"><a href="#cb30-674" aria-hidden="true" tabindex="-1"></a>other county. Hartford and New Haven follow with significant volumes of $58 billion </span>
<span id="cb30-675"><a href="#cb30-675" aria-hidden="true" tabindex="-1"></a>and $53 billion, respectively, while the remaining counties contribute more </span>
<span id="cb30-676"><a href="#cb30-676" aria-hidden="true" tabindex="-1"></a>modestly to the state's overall market.</span>
<span id="cb30-677"><a href="#cb30-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-680"><a href="#cb30-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-681"><a href="#cb30-681" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the total number of recorded properties by county </span></span>
<span id="cb30-682"><a href="#cb30-682" aria-hidden="true" tabindex="-1"></a>n_by_county <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-683"><a href="#cb30-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb30-684"><a href="#cb30-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">total_billion =</span> <span class="fu">round</span>(<span class="fu">sum</span>(sale_amount)<span class="sc">/</span><span class="fl">1e9</span>, <span class="dv">0</span>)) </span>
<span id="cb30-685"><a href="#cb30-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-686"><a href="#cb30-686" aria-hidden="true" tabindex="-1"></a>n_by_county <span class="sc">|&gt;</span></span>
<span id="cb30-687"><a href="#cb30-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-688"><a href="#cb30-688" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">comma</span>(n),</span>
<span id="cb30-689"><a href="#cb30-689" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_billion =</span> <span class="fu">dollar</span>(total_billion, <span class="at">suffix =</span> <span class="st">"B"</span>)</span>
<span id="cb30-690"><a href="#cb30-690" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-691"><a href="#cb30-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb30-692"><a href="#cb30-692" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"County"</span>, <span class="st">"Transactions"</span>, <span class="st">"Total Volume (Billion)"</span>),</span>
<span id="cb30-693"><a href="#cb30-693" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"&lt;b&gt;&lt;span style='color:black'&gt;Table 1: Real Estate Transactions and Volume by County (2001–2022)&lt;/span&gt;&lt;/b&gt;"</span>,</span>
<span id="cb30-694"><a href="#cb30-694" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span></span>
<span id="cb30-695"><a href="#cb30-695" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-696"><a href="#cb30-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb30-697"><a href="#cb30-697" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb30-698"><a href="#cb30-698" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span></span>
<span id="cb30-699"><a href="#cb30-699" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-700"><a href="#cb30-700" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-701"><a href="#cb30-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-702"><a href="#cb30-702" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. How many repeated sales are there in each county? </span></span>
<span id="cb30-703"><a href="#cb30-703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-704"><a href="#cb30-704" aria-hidden="true" tabindex="-1"></a>Hartford County recorded the highest number of repeated sales with 30,721 transactions, </span>
<span id="cb30-705"><a href="#cb30-705" aria-hidden="true" tabindex="-1"></a>followed closely by Fairfield County with 27,548. New Haven County also demonstrated </span>
<span id="cb30-706"><a href="#cb30-706" aria-hidden="true" tabindex="-1"></a>strong market activity, with 27,213 repeated transactions during the period.</span>
<span id="cb30-707"><a href="#cb30-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-708"><a href="#cb30-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-711"><a href="#cb30-711" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-712"><a href="#cb30-712" aria-hidden="true" tabindex="-1"></a><span class="co"># Find repeated sales</span></span>
<span id="cb30-713"><a href="#cb30-713" aria-hidden="true" tabindex="-1"></a><span class="co"># repeated_sales &lt;- ct_sales_cleaned |&gt;</span></span>
<span id="cb30-714"><a href="#cb30-714" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(address1, list_year) |&gt;</span></span>
<span id="cb30-715"><a href="#cb30-715" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(address1) |&gt;</span></span>
<span id="cb30-716"><a href="#cb30-716" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(n() &gt; 1) |&gt;</span></span>
<span id="cb30-717"><a href="#cb30-717" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb30-718"><a href="#cb30-718" aria-hidden="true" tabindex="-1"></a><span class="co">#     town = first(town),</span></span>
<span id="cb30-719"><a href="#cb30-719" aria-hidden="true" tabindex="-1"></a><span class="co">#     county = first(county),</span></span>
<span id="cb30-720"><a href="#cb30-720" aria-hidden="true" tabindex="-1"></a><span class="co">#     property_type = first(property_type),</span></span>
<span id="cb30-721"><a href="#cb30-721" aria-hidden="true" tabindex="-1"></a><span class="co">#     earliest_sale = first(sale_amount),</span></span>
<span id="cb30-722"><a href="#cb30-722" aria-hidden="true" tabindex="-1"></a><span class="co">#     latest_sale = last(sale_amount),</span></span>
<span id="cb30-723"><a href="#cb30-723" aria-hidden="true" tabindex="-1"></a><span class="co">#     chg_in_value = latest_sale - earliest_sale,</span></span>
<span id="cb30-724"><a href="#cb30-724" aria-hidden="true" tabindex="-1"></a><span class="co">#     .groups = "drop"</span></span>
<span id="cb30-725"><a href="#cb30-725" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb30-726"><a href="#cb30-726" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb30-727"><a href="#cb30-727" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(repeated_sales, "repeated_sales.csv", row.names = FALSE)</span></span>
<span id="cb30-728"><a href="#cb30-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-729"><a href="#cb30-729" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the saved data into R</span></span>
<span id="cb30-730"><a href="#cb30-730" aria-hidden="true" tabindex="-1"></a>repeated_sales <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"repeated_sales.csv"</span>)</span>
<span id="cb30-731"><a href="#cb30-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-732"><a href="#cb30-732" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of repeated sales for each county </span></span>
<span id="cb30-733"><a href="#cb30-733" aria-hidden="true" tabindex="-1"></a>n_repeated_sales_by_county <span class="ot">&lt;-</span> repeated_sales <span class="sc">|&gt;</span></span>
<span id="cb30-734"><a href="#cb30-734" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb30-735"><a href="#cb30-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb30-736"><a href="#cb30-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-737"><a href="#cb30-737" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb30-738"><a href="#cb30-738" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(n_repeated_sales_by_county, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(county, <span class="sc">-</span>total), <span class="at">y =</span> total)) <span class="sc">+</span></span>
<span id="cb30-739"><a href="#cb30-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb30-740"><a href="#cb30-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">comma</span>(total)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb30-741"><a href="#cb30-741" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb30-742"><a href="#cb30-742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-743"><a href="#cb30-743" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Number of Repeated Sales by County"</span>,</span>
<span id="cb30-744"><a href="#cb30-744" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"County"</span>,</span>
<span id="cb30-745"><a href="#cb30-745" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Repeated Sales"</span></span>
<span id="cb30-746"><a href="#cb30-746" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-747"><a href="#cb30-747" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb30-748"><a href="#cb30-748" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-749"><a href="#cb30-749" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),        <span class="co"># Bold title</span></span>
<span id="cb30-750"><a href="#cb30-750" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb30-751"><a href="#cb30-751" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb30-752"><a href="#cb30-752" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()   </span>
<span id="cb30-753"><a href="#cb30-753" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-754"><a href="#cb30-754" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-755"><a href="#cb30-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-756"><a href="#cb30-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-757"><a href="#cb30-757" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3. How much have average single-family home values changed in each county? </span></span>
<span id="cb30-758"><a href="#cb30-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-759"><a href="#cb30-759" aria-hidden="true" tabindex="-1"></a>Rapid home price appreciation typically indicates a strong and robust market. </span>
<span id="cb30-760"><a href="#cb30-760" aria-hidden="true" tabindex="-1"></a>Fairfield County stands out with the highest average increase in single-family </span>
<span id="cb30-761"><a href="#cb30-761" aria-hidden="true" tabindex="-1"></a>home values, rising by approximately $172,000 between 2001 and 2022. This growth </span>
<span id="cb30-762"><a href="#cb30-762" aria-hidden="true" tabindex="-1"></a>is more than double the appreciation seen in Middlesex and Litchfield counties, </span>
<span id="cb30-763"><a href="#cb30-763" aria-hidden="true" tabindex="-1"></a>and over three times greater than in Hartford County. The substantial increase </span>
<span id="cb30-764"><a href="#cb30-764" aria-hidden="true" tabindex="-1"></a>underscores Fairfield’s market strength. It also reinforces the pattern of </span>
<span id="cb30-765"><a href="#cb30-765" aria-hidden="true" tabindex="-1"></a>declining price growth and increasing distance from New York City.</span>
<span id="cb30-766"><a href="#cb30-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-769"><a href="#cb30-769" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-770"><a href="#cb30-770" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the mean change in value for each county </span></span>
<span id="cb30-771"><a href="#cb30-771" aria-hidden="true" tabindex="-1"></a>avg_value_by_county <span class="ot">&lt;-</span> repeated_sales <span class="sc">|&gt;</span></span>
<span id="cb30-772"><a href="#cb30-772" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Single Family"</span>, <span class="st">"Residential"</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb30-773"><a href="#cb30-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb30-774"><a href="#cb30-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg =</span> <span class="fu">mean</span>(chg_in_value)) <span class="sc">|&gt;</span></span>
<span id="cb30-775"><a href="#cb30-775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg)) </span>
<span id="cb30-776"><a href="#cb30-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-777"><a href="#cb30-777" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(avg_value_by_county, <span class="fu">aes</span>(<span class="at">x =</span> avg, <span class="at">y =</span> <span class="fu">reorder</span>(county, avg))) <span class="sc">+</span></span>
<span id="cb30-778"><a href="#cb30-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2a9d8f"</span>) <span class="sc">+</span></span>
<span id="cb30-779"><a href="#cb30-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">dollar</span>(avg)), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb30-780"><a href="#cb30-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>(), </span>
<span id="cb30-781"><a href="#cb30-781" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))) <span class="sc">+</span></span>
<span id="cb30-782"><a href="#cb30-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-783"><a href="#cb30-783" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Property Value Appreciation"</span>,</span>
<span id="cb30-784"><a href="#cb30-784" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Single-Family Homes with Repeated Sales (by County)"</span>,</span>
<span id="cb30-785"><a href="#cb30-785" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Average Appreciation ($)"</span>,</span>
<span id="cb30-786"><a href="#cb30-786" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"County"</span></span>
<span id="cb30-787"><a href="#cb30-787" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-788"><a href="#cb30-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb30-789"><a href="#cb30-789" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-790"><a href="#cb30-790" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb30-791"><a href="#cb30-791" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb30-792"><a href="#cb30-792" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()   </span>
<span id="cb30-793"><a href="#cb30-793" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-794"><a href="#cb30-794" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-795"><a href="#cb30-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-796"><a href="#cb30-796" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4. Which months or quarters see the most activity?</span></span>
<span id="cb30-797"><a href="#cb30-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-798"><a href="#cb30-798" aria-hidden="true" tabindex="-1"></a>An analysis of monthly real estate transactions in Connecticut reveals clear </span>
<span id="cb30-799"><a href="#cb30-799" aria-hidden="true" tabindex="-1"></a>seasonal trends in sales volume. Transaction activity is lowest during the winter </span>
<span id="cb30-800"><a href="#cb30-800" aria-hidden="true" tabindex="-1"></a>months, with January (47,181) and February (40,234) recording the fewest sales. </span>
<span id="cb30-801"><a href="#cb30-801" aria-hidden="true" tabindex="-1"></a>As the market enters the spring and summer months, sales volume increases </span>
<span id="cb30-802"><a href="#cb30-802" aria-hidden="true" tabindex="-1"></a>significantly, peaking in June with 84,100 transactions. July (82,882) and </span>
<span id="cb30-803"><a href="#cb30-803" aria-hidden="true" tabindex="-1"></a>August (82,399) follow closely behind, highlighting a strong summer market.</span>
<span id="cb30-804"><a href="#cb30-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-807"><a href="#cb30-807" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-808"><a href="#cb30-808" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the number of transactions by month </span></span>
<span id="cb30-809"><a href="#cb30-809" aria-hidden="true" tabindex="-1"></a>monthly_sales <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-810"><a href="#cb30-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-811"><a href="#cb30-811" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(date_recorded, <span class="at">format =</span> <span class="st">"%m/%d/%Y"</span>), <span class="st">"%m"</span>))</span>
<span id="cb30-812"><a href="#cb30-812" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-813"><a href="#cb30-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb30-814"><a href="#cb30-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb30-815"><a href="#cb30-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb30-816"><a href="#cb30-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-817"><a href="#cb30-817" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert month to factor with labels </span></span>
<span id="cb30-818"><a href="#cb30-818" aria-hidden="true" tabindex="-1"></a>monthly_sales <span class="ot">&lt;-</span> monthly_sales <span class="sc">|&gt;</span></span>
<span id="cb30-819"><a href="#cb30-819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-820"><a href="#cb30-820" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">factor</span>(month, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">labels =</span> month.name)</span>
<span id="cb30-821"><a href="#cb30-821" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-822"><a href="#cb30-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-823"><a href="#cb30-823" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb30-824"><a href="#cb30-824" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_sales, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> total)) <span class="sc">+</span></span>
<span id="cb30-825"><a href="#cb30-825" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb30-826"><a href="#cb30-826" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">comma</span>(total)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb30-827"><a href="#cb30-827" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-828"><a href="#cb30-828" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Real Estate Transactions in Connecticut"</span>,</span>
<span id="cb30-829"><a href="#cb30-829" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb30-830"><a href="#cb30-830" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Transactions"</span></span>
<span id="cb30-831"><a href="#cb30-831" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-832"><a href="#cb30-832" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb30-833"><a href="#cb30-833" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-834"><a href="#cb30-834" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb30-835"><a href="#cb30-835" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb30-836"><a href="#cb30-836" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-837"><a href="#cb30-837" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb30-838"><a href="#cb30-838" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-839"><a href="#cb30-839" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma)</span>
<span id="cb30-840"><a href="#cb30-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-841"><a href="#cb30-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-842"><a href="#cb30-842" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5. What are the hotspots for high-value transactions?</span></span>
<span id="cb30-843"><a href="#cb30-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-844"><a href="#cb30-844" aria-hidden="true" tabindex="-1"></a>The vast majority of high-value residential property sales (over $5 million) in </span>
<span id="cb30-845"><a href="#cb30-845" aria-hidden="true" tabindex="-1"></a>Connecticut are concentrated in Fairfield County, which accounts for approximately </span>
<span id="cb30-846"><a href="#cb30-846" aria-hidden="true" tabindex="-1"></a>96.9% of such transactions. All other counties combined represent just 3.1%, </span>
<span id="cb30-847"><a href="#cb30-847" aria-hidden="true" tabindex="-1"></a>highlighting Fairfield’s dominant position as the primary market for luxury real </span>
<span id="cb30-848"><a href="#cb30-848" aria-hidden="true" tabindex="-1"></a>estate in the state.</span>
<span id="cb30-849"><a href="#cb30-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-852"><a href="#cb30-852" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-853"><a href="#cb30-853" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb30-854"><a href="#cb30-854" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of single family home sales with over 5 million for each county</span></span>
<span id="cb30-855"><a href="#cb30-855" aria-hidden="true" tabindex="-1"></a>hotspots <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-856"><a href="#cb30-856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>), </span>
<span id="cb30-857"><a href="#cb30-857" aria-hidden="true" tabindex="-1"></a>         sale_amount <span class="sc">&gt;</span> <span class="dv">5000000</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-858"><a href="#cb30-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(county, <span class="at">name =</span> <span class="st">"count"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-859"><a href="#cb30-859" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-860"><a href="#cb30-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">county =</span> <span class="fu">ifelse</span>(percentage <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="st">"Others"</span>, county)) <span class="sc">|&gt;</span></span>
<span id="cb30-861"><a href="#cb30-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb30-862"><a href="#cb30-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-863"><a href="#cb30-863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-864"><a href="#cb30-864" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentage =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb30-865"><a href="#cb30-865" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(county, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">round</span>(percentage, <span class="dv">1</span>), <span class="st">"%"</span>)</span>
<span id="cb30-866"><a href="#cb30-866" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-867"><a href="#cb30-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-868"><a href="#cb30-868" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Pie </span></span>
<span id="cb30-869"><a href="#cb30-869" aria-hidden="true" tabindex="-1"></a>pie_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(hotspots, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> count, <span class="at">fill =</span> county)) <span class="sc">+</span></span>
<span id="cb30-870"><a href="#cb30-870" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb30-871"><a href="#cb30-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb30-872"><a href="#cb30-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb30-873"><a href="#cb30-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"High-Value Residential Sales by County"</span>) <span class="sc">+</span></span>
<span id="cb30-874"><a href="#cb30-874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb30-875"><a href="#cb30-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-876"><a href="#cb30-876" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb30-877"><a href="#cb30-877" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb30-878"><a href="#cb30-878" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-879"><a href="#cb30-879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Fairfield"</span> <span class="ot">=</span> <span class="st">"#2a9d8f"</span>, <span class="st">"Others"</span> <span class="ot">=</span> <span class="st">"#e9c46a"</span>))</span>
<span id="cb30-880"><a href="#cb30-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-881"><a href="#cb30-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-882"><a href="#cb30-882" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a table </span></span>
<span id="cb30-883"><a href="#cb30-883" aria-hidden="true" tabindex="-1"></a>high_value_summary <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-884"><a href="#cb30-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>), </span>
<span id="cb30-885"><a href="#cb30-885" aria-hidden="true" tabindex="-1"></a>         sale_amount <span class="sc">&gt;</span> <span class="dv">5000000</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-886"><a href="#cb30-886" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb30-887"><a href="#cb30-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb30-888"><a href="#cb30-888" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb30-889"><a href="#cb30-889" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb30-890"><a href="#cb30-890" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">|&gt;</span></span>
<span id="cb30-891"><a href="#cb30-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-892"><a href="#cb30-892" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentage =</span> <span class="fu">round</span>(count<span class="sc">/</span><span class="fu">sum</span>(count) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb30-893"><a href="#cb30-893" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-894"><a href="#cb30-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-895"><a href="#cb30-895" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(high_value_summary) <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(<span class="fu">colnames</span>(high_value_summary))</span>
<span id="cb30-896"><a href="#cb30-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-897"><a href="#cb30-897" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb30-898"><a href="#cb30-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-899"><a href="#cb30-899" aria-hidden="true" tabindex="-1"></a>hotspots_tbl <span class="ot">&lt;-</span> <span class="fu">tableGrob</span>(</span>
<span id="cb30-900"><a href="#cb30-900" aria-hidden="true" tabindex="-1"></a>  high_value_summary,</span>
<span id="cb30-901"><a href="#cb30-901" aria-hidden="true" tabindex="-1"></a>  <span class="at">rows =</span> <span class="cn">NULL</span></span>
<span id="cb30-902"><a href="#cb30-902" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-903"><a href="#cb30-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-904"><a href="#cb30-904" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb30-905"><a href="#cb30-905" aria-hidden="true" tabindex="-1"></a>pie_plot <span class="sc">+</span> <span class="fu">wrap_elements</span>(hotspots_tbl) <span class="sc">+</span></span>
<span id="cb30-906"><a href="#cb30-906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb30-907"><a href="#cb30-907" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-908"><a href="#cb30-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-909"><a href="#cb30-909" aria-hidden="true" tabindex="-1"></a><span class="fu"># Feature Engineering </span></span>
<span id="cb30-910"><a href="#cb30-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-911"><a href="#cb30-911" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calculate Distance (km) from Grand Central Terminal for Each Property </span></span>
<span id="cb30-912"><a href="#cb30-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-915"><a href="#cb30-915" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-916"><a href="#cb30-916" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object to compute the distance to Grand Central </span></span>
<span id="cb30-917"><a href="#cb30-917" aria-hidden="true" tabindex="-1"></a>ct_sales_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(ct_sales_cleaned, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), </span>
<span id="cb30-918"><a href="#cb30-918" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb30-919"><a href="#cb30-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-920"><a href="#cb30-920" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the distance from each property to Grand Central Terminal</span></span>
<span id="cb30-921"><a href="#cb30-921" aria-hidden="true" tabindex="-1"></a>ct_sales_sf <span class="ot">&lt;-</span> ct_sales_sf <span class="sc">|&gt;</span></span>
<span id="cb30-922"><a href="#cb30-922" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-923"><a href="#cb30-923" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_dist_to_nyc =</span> </span>
<span id="cb30-924"><a href="#cb30-924" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, grand_central)<span class="sc">/</span><span class="dv">1000</span>), <span class="dv">2</span>)</span>
<span id="cb30-925"><a href="#cb30-925" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-926"><a href="#cb30-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-927"><a href="#cb30-927" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-928"><a href="#cb30-928" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ct_sales_sf <span class="sc">|&gt;</span> <span class="fu">select</span>(ref_id, point_dist_to_nyc),</span>
<span id="cb30-929"><a href="#cb30-929" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"ref_id"</span>)</span>
<span id="cb30-930"><a href="#cb30-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-931"><a href="#cb30-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-932"><a href="#cb30-932" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-933"><a href="#cb30-933" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(town_distance_range, <span class="at">by =</span> <span class="st">"town"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-934"><a href="#cb30-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>TOWN)</span>
<span id="cb30-935"><a href="#cb30-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-936"><a href="#cb30-936" aria-hidden="true" tabindex="-1"></a><span class="co"># After performing feature engineering, select the desired columns for display</span></span>
<span id="cb30-937"><a href="#cb30-937" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-938"><a href="#cb30-938" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb30-939"><a href="#cb30-939" aria-hidden="true" tabindex="-1"></a>    address, town, sale_amount, property_type, point_dist_to_nyc</span>
<span id="cb30-940"><a href="#cb30-940" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-941"><a href="#cb30-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb30-942"><a href="#cb30-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-943"><a href="#cb30-943" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb30-944"><a href="#cb30-944" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sample, <span class="at">caption =</span> <span class="st">"First 10 Rows of Data with First Predictor"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-945"><a href="#cb30-945" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb30-946"><a href="#cb30-946" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-947"><a href="#cb30-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-948"><a href="#cb30-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-949"><a href="#cb30-949" aria-hidden="true" tabindex="-1"></a><span class="fu">## Compute Distance from Each Property to the Nearest Train Station</span></span>
<span id="cb30-950"><a href="#cb30-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-953"><a href="#cb30-953" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-954"><a href="#cb30-954" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to compute the distances from each train station for each property</span></span>
<span id="cb30-955"><a href="#cb30-955" aria-hidden="true" tabindex="-1"></a><span class="co"># compute_distance &lt;- function(stop_id_value){</span></span>
<span id="cb30-956"><a href="#cb30-956" aria-hidden="true" tabindex="-1"></a><span class="co">#   stop &lt;- stops_sf |&gt;</span></span>
<span id="cb30-957"><a href="#cb30-957" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(stop_id == stop_id_value)</span></span>
<span id="cb30-958"><a href="#cb30-958" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb30-959"><a href="#cb30-959" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Compute distances in kilometers</span></span>
<span id="cb30-960"><a href="#cb30-960" aria-hidden="true" tabindex="-1"></a><span class="co">#   distances &lt;- as.numeric(st_distance(property_list, stop))/1000</span></span>
<span id="cb30-961"><a href="#cb30-961" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb30-962"><a href="#cb30-962" aria-hidden="true" tabindex="-1"></a><span class="co">#   data.frame(</span></span>
<span id="cb30-963"><a href="#cb30-963" aria-hidden="true" tabindex="-1"></a><span class="co">#     dist = distances</span></span>
<span id="cb30-964"><a href="#cb30-964" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb30-965"><a href="#cb30-965" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb30-966"><a href="#cb30-966" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb30-967"><a href="#cb30-967" aria-hidden="true" tabindex="-1"></a><span class="co"># property_list &lt;- ct_sales_sf |&gt; select(ref_id, geometry)</span></span>
<span id="cb30-968"><a href="#cb30-968" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb30-969"><a href="#cb30-969" aria-hidden="true" tabindex="-1"></a><span class="co"># stop_list &lt;- stops |&gt;</span></span>
<span id="cb30-970"><a href="#cb30-970" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(stop_id) |&gt;</span></span>
<span id="cb30-971"><a href="#cb30-971" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull()</span></span>
<span id="cb30-972"><a href="#cb30-972" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-973"><a href="#cb30-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-974"><a href="#cb30-974" aria-hidden="true" tabindex="-1"></a><span class="co"># dist_to_train_stations &lt;- stop_list |&gt; map(compute_distance) |&gt; bind_cols()</span></span>
<span id="cb30-975"><a href="#cb30-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-976"><a href="#cb30-976" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the distance to the nearest Metro-North station for each property</span></span>
<span id="cb30-977"><a href="#cb30-977" aria-hidden="true" tabindex="-1"></a><span class="co"># min_distance &lt;- apply(distance_to_train_stations[, 2:ncol(distance_to_train_stations)], 1, min, na.rm = TRUE)</span></span>
<span id="cb30-978"><a href="#cb30-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-979"><a href="#cb30-979" aria-hidden="true" tabindex="-1"></a><span class="co"># ref_idx &lt;- property_list |&gt; st_drop_geometry() |&gt; select(ref_id)</span></span>
<span id="cb30-980"><a href="#cb30-980" aria-hidden="true" tabindex="-1"></a><span class="co"># min_dist_to_train_station &lt;- cbind(ref_idx, min_distance)</span></span>
<span id="cb30-981"><a href="#cb30-981" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb30-982"><a href="#cb30-982" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(min_dist_to_train_station, "min_dist.csv", row.names = FALSE)</span></span>
<span id="cb30-983"><a href="#cb30-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-984"><a href="#cb30-984" aria-hidden="true" tabindex="-1"></a>min_dist <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"min_dist.csv"</span>)</span>
<span id="cb30-985"><a href="#cb30-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-986"><a href="#cb30-986" aria-hidden="true" tabindex="-1"></a><span class="co"># Round the distance to the 10th place for readability</span></span>
<span id="cb30-987"><a href="#cb30-987" aria-hidden="true" tabindex="-1"></a>min_dist <span class="ot">&lt;-</span> min_dist <span class="sc">|&gt;</span></span>
<span id="cb30-988"><a href="#cb30-988" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-989"><a href="#cb30-989" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_distance =</span> <span class="fu">round</span>(min_distance, <span class="dv">2</span>)</span>
<span id="cb30-990"><a href="#cb30-990" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-991"><a href="#cb30-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-992"><a href="#cb30-992" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span> <span class="fu">left_join</span>(min_dist, <span class="at">by =</span> <span class="st">"ref_id"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-993"><a href="#cb30-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">nearest_rail_station_dist =</span> min_distance)</span>
<span id="cb30-994"><a href="#cb30-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-995"><a href="#cb30-995" aria-hidden="true" tabindex="-1"></a><span class="co"># After performing feature engineering, select the desired columns for display</span></span>
<span id="cb30-996"><a href="#cb30-996" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-997"><a href="#cb30-997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb30-998"><a href="#cb30-998" aria-hidden="true" tabindex="-1"></a>    address, town, sale_amount, property_type, point_dist_to_nyc, </span>
<span id="cb30-999"><a href="#cb30-999" aria-hidden="true" tabindex="-1"></a>    nearest_rail_station_dist</span>
<span id="cb30-1000"><a href="#cb30-1000" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-1001"><a href="#cb30-1001" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb30-1002"><a href="#cb30-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1003"><a href="#cb30-1003" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb30-1004"><a href="#cb30-1004" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sample_data, <span class="at">caption =</span> <span class="st">"First 10 Rows of Data with Second Predictor"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-1005"><a href="#cb30-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb30-1006"><a href="#cb30-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-1007"><a href="#cb30-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1008"><a href="#cb30-1008" aria-hidden="true" tabindex="-1"></a><span class="fu">## 6. What percentage of properties in Fairfield and New Haven Counties are located within 3 km of the nearest Metro-North station?</span></span>
<span id="cb30-1009"><a href="#cb30-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1010"><a href="#cb30-1010" aria-hidden="true" tabindex="-1"></a>In Fairfield County, approximately 59% of all recorded property transactions </span>
<span id="cb30-1011"><a href="#cb30-1011" aria-hidden="true" tabindex="-1"></a>(125,669 out of 211,845) are situated within this 3 km radius. This suggests </span>
<span id="cb30-1012"><a href="#cb30-1012" aria-hidden="true" tabindex="-1"></a>that access to reliable commuter rail service may be a key driver of real estate </span>
<span id="cb30-1013"><a href="#cb30-1013" aria-hidden="true" tabindex="-1"></a>activity in the region, particularly given Fairfield’s direct rail connectivity </span>
<span id="cb30-1014"><a href="#cb30-1014" aria-hidden="true" tabindex="-1"></a>to New York City.</span>
<span id="cb30-1015"><a href="#cb30-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1016"><a href="#cb30-1016" aria-hidden="true" tabindex="-1"></a>In contrast, New Haven County shows a different spatial pattern, with only 30% </span>
<span id="cb30-1017"><a href="#cb30-1017" aria-hidden="true" tabindex="-1"></a>of its transactions (52,958 out of 175,862) occurring within the same proximity </span>
<span id="cb30-1018"><a href="#cb30-1018" aria-hidden="true" tabindex="-1"></a>threshold.</span>
<span id="cb30-1019"><a href="#cb30-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1020"><a href="#cb30-1020" aria-hidden="true" tabindex="-1"></a>Litchfield County has limited, indirect access to Metro-North service through </span>
<span id="cb30-1021"><a href="#cb30-1021" aria-hidden="true" tabindex="-1"></a>a small number of peripheral stations, but the impact is far more subtle. Other </span>
<span id="cb30-1022"><a href="#cb30-1022" aria-hidden="true" tabindex="-1"></a>counties in the state lack direct Metro-North connectivity altogether, which may </span>
<span id="cb30-1023"><a href="#cb30-1023" aria-hidden="true" tabindex="-1"></a>contribute to differences in real estate volume and spatial distribution.</span>
<span id="cb30-1024"><a href="#cb30-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1027"><a href="#cb30-1027" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-1028"><a href="#cb30-1028" aria-hidden="true" tabindex="-1"></a>fairfield_new_haven <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-1029"><a href="#cb30-1029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nearest_rail_station_dist <span class="sc">&lt;</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-1030"><a href="#cb30-1030" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb30-1031"><a href="#cb30-1031" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb30-1032"><a href="#cb30-1032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb30-1033"><a href="#cb30-1033" aria-hidden="true" tabindex="-1"></a>    ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-1034"><a href="#cb30-1034" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(county <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Fairfield"</span>, <span class="st">"New Haven"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-1035"><a href="#cb30-1035" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb30-1036"><a href="#cb30-1036" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb30-1037"><a href="#cb30-1037" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-1038"><a href="#cb30-1038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-1039"><a href="#cb30-1039" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentage =</span> <span class="fu">round</span>(n<span class="sc">/</span>total, <span class="dv">2</span>)</span>
<span id="cb30-1040"><a href="#cb30-1040" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-1041"><a href="#cb30-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1042"><a href="#cb30-1042" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot long </span></span>
<span id="cb30-1043"><a href="#cb30-1043" aria-hidden="true" tabindex="-1"></a>fairfield_new_haven <span class="ot">&lt;-</span> fairfield_new_haven <span class="sc">|&gt;</span></span>
<span id="cb30-1044"><a href="#cb30-1044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">beyond =</span> total <span class="sc">-</span> n) <span class="sc">|&gt;</span></span>
<span id="cb30-1045"><a href="#cb30-1045" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, <span class="at">within =</span> n, beyond) <span class="sc">|&gt;</span></span>
<span id="cb30-1046"><a href="#cb30-1046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(within, beyond), <span class="at">names_to =</span> <span class="st">"category"</span>, </span>
<span id="cb30-1047"><a href="#cb30-1047" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-1048"><a href="#cb30-1048" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">ifelse</span>(category <span class="sc">==</span> <span class="st">"within"</span>, <span class="st">"Within 3 km"</span>, <span class="st">"Beyond 3 km"</span>))</span>
<span id="cb30-1049"><a href="#cb30-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1050"><a href="#cb30-1050" aria-hidden="true" tabindex="-1"></a><span class="co"># Fairfield</span></span>
<span id="cb30-1051"><a href="#cb30-1051" aria-hidden="true" tabindex="-1"></a>fairfield_pie <span class="ot">&lt;-</span> fairfield_new_haven <span class="sc">|&gt;</span></span>
<span id="cb30-1052"><a href="#cb30-1052" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(county <span class="sc">==</span> <span class="st">"Fairfield"</span>)</span>
<span id="cb30-1053"><a href="#cb30-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1054"><a href="#cb30-1054" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Fairfield pie </span></span>
<span id="cb30-1055"><a href="#cb30-1055" aria-hidden="true" tabindex="-1"></a>fairfield_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fairfield_pie, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> value, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb30-1056"><a href="#cb30-1056" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb30-1057"><a href="#cb30-1057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb30-1058"><a href="#cb30-1058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">percent</span>(value <span class="sc">/</span> <span class="fu">sum</span>(value))),</span>
<span id="cb30-1059"><a href="#cb30-1059" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb30-1060"><a href="#cb30-1060" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Fairfield County"</span>) <span class="sc">+</span></span>
<span id="cb30-1061"><a href="#cb30-1061" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb30-1062"><a href="#cb30-1062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Within 3 km"</span> <span class="ot">=</span> <span class="st">"#2a9d8f"</span>, <span class="st">"Beyond 3 km"</span> <span class="ot">=</span> <span class="st">"#e9c46a"</span>))</span>
<span id="cb30-1063"><a href="#cb30-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1064"><a href="#cb30-1064" aria-hidden="true" tabindex="-1"></a><span class="co"># New Haven</span></span>
<span id="cb30-1065"><a href="#cb30-1065" aria-hidden="true" tabindex="-1"></a>newhaven_pie <span class="ot">&lt;-</span> fairfield_new_haven <span class="sc">|&gt;</span></span>
<span id="cb30-1066"><a href="#cb30-1066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(county <span class="sc">==</span> <span class="st">"New Haven"</span>)</span>
<span id="cb30-1067"><a href="#cb30-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1068"><a href="#cb30-1068" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot New Haven Pie</span></span>
<span id="cb30-1069"><a href="#cb30-1069" aria-hidden="true" tabindex="-1"></a>new_haven_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(newhaven_pie, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> value, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb30-1070"><a href="#cb30-1070" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb30-1071"><a href="#cb30-1071" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb30-1072"><a href="#cb30-1072" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">percent</span>(value <span class="sc">/</span> <span class="fu">sum</span>(value))),</span>
<span id="cb30-1073"><a href="#cb30-1073" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb30-1074"><a href="#cb30-1074" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"New Haven County"</span>) <span class="sc">+</span></span>
<span id="cb30-1075"><a href="#cb30-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb30-1076"><a href="#cb30-1076" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Within 3 km"</span> <span class="ot">=</span> <span class="st">"#4682B4"</span>, <span class="st">"Beyond 3 km"</span> <span class="ot">=</span> <span class="st">"#e9c46a"</span>))</span>
<span id="cb30-1077"><a href="#cb30-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1078"><a href="#cb30-1078" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb30-1079"><a href="#cb30-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1080"><a href="#cb30-1080" aria-hidden="true" tabindex="-1"></a>(fairfield_plot <span class="sc">+</span> new_haven_plot) <span class="sc">+</span></span>
<span id="cb30-1081"><a href="#cb30-1081" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb30-1082"><a href="#cb30-1082" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Proximity to Metro-North Station (Within 3 km)"</span>) <span class="sc">&amp;</span></span>
<span id="cb30-1083"><a href="#cb30-1083" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb30-1084"><a href="#cb30-1084" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb30-1085"><a href="#cb30-1085" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-1086"><a href="#cb30-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1087"><a href="#cb30-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1088"><a href="#cb30-1088" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7. How does proximity to the nearest train station correlate with home values in Fairfield County?</span></span>
<span id="cb30-1089"><a href="#cb30-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1090"><a href="#cb30-1090" aria-hidden="true" tabindex="-1"></a>The correlation between distance to the nearest Metro-North station and property </span>
<span id="cb30-1091"><a href="#cb30-1091" aria-hidden="true" tabindex="-1"></a>sale price in Fairfield County is approximately -0.14, indicating a weak negative </span>
<span id="cb30-1092"><a href="#cb30-1092" aria-hidden="true" tabindex="-1"></a>relationship. This suggests that, on average, properties located closer to train </span>
<span id="cb30-1093"><a href="#cb30-1093" aria-hidden="true" tabindex="-1"></a>stations tend to have slightly higher sale prices, though the effect is modest.</span>
<span id="cb30-1094"><a href="#cb30-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1097"><a href="#cb30-1097" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-1098"><a href="#cb30-1098" aria-hidden="true" tabindex="-1"></a>fairfield <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-1099"><a href="#cb30-1099" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residentital"</span>, <span class="st">"Single Family"</span>), </span>
<span id="cb30-1100"><a href="#cb30-1100" aria-hidden="true" tabindex="-1"></a>         county <span class="sc">==</span> <span class="st">"Fairfield"</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-1101"><a href="#cb30-1101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sale_amount, nearest_rail_station_dist)</span>
<span id="cb30-1102"><a href="#cb30-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1103"><a href="#cb30-1103" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb30-1104"><a href="#cb30-1104" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb30-1105"><a href="#cb30-1105" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb30-1106"><a href="#cb30-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1107"><a href="#cb30-1107" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fairfield, <span class="fu">aes</span>(<span class="at">x =</span> nearest_rail_station_dist, <span class="at">y =</span> sale_amount)) <span class="sc">+</span></span>
<span id="cb30-1108"><a href="#cb30-1108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb30-1109"><a href="#cb30-1109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb30-1110"><a href="#cb30-1110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb30-1111"><a href="#cb30-1111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-1112"><a href="#cb30-1112" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distance to Nearest Train Station and Home Price in Fairfield County"</span>,</span>
<span id="cb30-1113"><a href="#cb30-1113" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Distance to Nearest Train Station (km)"</span>,</span>
<span id="cb30-1114"><a href="#cb30-1114" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Sale Amount (USD)"</span></span>
<span id="cb30-1115"><a href="#cb30-1115" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-1116"><a href="#cb30-1116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span>
<span id="cb30-1117"><a href="#cb30-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1118"><a href="#cb30-1118" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(fairfield<span class="sc">$</span>nearest_rail_station_dist, fairfield<span class="sc">$</span>sale_amount)</span>
<span id="cb30-1119"><a href="#cb30-1119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-1120"><a href="#cb30-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1121"><a href="#cb30-1121" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8. How does proximity to New York City correlate with home values across Connecticut?</span></span>
<span id="cb30-1122"><a href="#cb30-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1123"><a href="#cb30-1123" aria-hidden="true" tabindex="-1"></a>Analysis reveals a moderate negative correlation of -0.51 between distance to </span>
<span id="cb30-1124"><a href="#cb30-1124" aria-hidden="true" tabindex="-1"></a>New York City (measured from Grand Central Terminal) and log-transformed home </span>
<span id="cb30-1125"><a href="#cb30-1125" aria-hidden="true" tabindex="-1"></a>sale prices across Connecticut. This suggests that, on average, properties </span>
<span id="cb30-1126"><a href="#cb30-1126" aria-hidden="true" tabindex="-1"></a>located closer to New York City tend to command higher prices. While distance </span>
<span id="cb30-1127"><a href="#cb30-1127" aria-hidden="true" tabindex="-1"></a>is not the sole determinant of home value, proximity to the metropolitan center </span>
<span id="cb30-1128"><a href="#cb30-1128" aria-hidden="true" tabindex="-1"></a>appears to be a significant locational factor influencing real estate pricing, </span>
<span id="cb30-1129"><a href="#cb30-1129" aria-hidden="true" tabindex="-1"></a>potentially reflecting demand for commuter access and economic opportunities. </span>
<span id="cb30-1130"><a href="#cb30-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1133"><a href="#cb30-1133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-1134"><a href="#cb30-1134" aria-hidden="true" tabindex="-1"></a>ct_homes <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-1135"><a href="#cb30-1135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residentital"</span>, <span class="st">"Single Family"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-1136"><a href="#cb30-1136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-1137"><a href="#cb30-1137" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_sale_amount =</span> <span class="fu">log</span>(sale_amount)</span>
<span id="cb30-1138"><a href="#cb30-1138" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-1139"><a href="#cb30-1139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(log_sale_amount, point_dist_to_nyc)</span>
<span id="cb30-1140"><a href="#cb30-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1141"><a href="#cb30-1141" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb30-1142"><a href="#cb30-1142" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ct_homes, <span class="fu">aes</span>(<span class="at">x =</span> point_dist_to_nyc, <span class="at">y =</span> log_sale_amount)) <span class="sc">+</span></span>
<span id="cb30-1143"><a href="#cb30-1143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb30-1144"><a href="#cb30-1144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb30-1145"><a href="#cb30-1145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb30-1146"><a href="#cb30-1146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-1147"><a href="#cb30-1147" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Impact of Distance to Grand Central Terminal on Log-Transformed Home Prices"</span>,</span>
<span id="cb30-1148"><a href="#cb30-1148" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Distance to Grand Central Terminal (km)"</span>,</span>
<span id="cb30-1149"><a href="#cb30-1149" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Log-Transformed Sale Amount (USD)"</span></span>
<span id="cb30-1150"><a href="#cb30-1150" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-1151"><a href="#cb30-1151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span>
<span id="cb30-1152"><a href="#cb30-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1153"><a href="#cb30-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1154"><a href="#cb30-1154" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(ct_homes<span class="sc">$</span>point_dist_to_nyc, ct_homes<span class="sc">$</span>log_sale_amount)</span>
<span id="cb30-1155"><a href="#cb30-1155" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-1156"><a href="#cb30-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1157"><a href="#cb30-1157" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9. How do average property values differ by property type between New Haven and Hartford towns?</span></span>
<span id="cb30-1158"><a href="#cb30-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1159"><a href="#cb30-1159" aria-hidden="true" tabindex="-1"></a>Across multiple residential types, New Haven consistently commands higher </span>
<span id="cb30-1160"><a href="#cb30-1160" aria-hidden="true" tabindex="-1"></a>prices than Hartford: on average, single-family homes are 41.38% more expensive, </span>
<span id="cb30-1161"><a href="#cb30-1161" aria-hidden="true" tabindex="-1"></a>three-family homes are 32.94% higher, and two-family homes command a 17.82% premium.</span>
<span id="cb30-1162"><a href="#cb30-1162" aria-hidden="true" tabindex="-1"></a>These patterns suggest that access to commuter rail significantly influences</span>
<span id="cb30-1163"><a href="#cb30-1163" aria-hidden="true" tabindex="-1"></a>real estate demand and pricing power. </span>
<span id="cb30-1164"><a href="#cb30-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1167"><a href="#cb30-1167" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-1168"><a href="#cb30-1168" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the average property value differences across property types between </span></span>
<span id="cb30-1169"><a href="#cb30-1169" aria-hidden="true" tabindex="-1"></a><span class="co"># the towns: New Haven and Hartford</span></span>
<span id="cb30-1170"><a href="#cb30-1170" aria-hidden="true" tabindex="-1"></a>new_haven_hartford_wide <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-1171"><a href="#cb30-1171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hartford"</span>, <span class="st">"New Haven"</span>), </span>
<span id="cb30-1172"><a href="#cb30-1172" aria-hidden="true" tabindex="-1"></a>         property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>, <span class="st">"Two Family"</span>, </span>
<span id="cb30-1173"><a href="#cb30-1173" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Three Family"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-1174"><a href="#cb30-1174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town, property_type) <span class="sc">|&gt;</span></span>
<span id="cb30-1175"><a href="#cb30-1175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg =</span> <span class="fu">mean</span>(sale_amount)) <span class="sc">|&gt;</span></span>
<span id="cb30-1176"><a href="#cb30-1176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-1177"><a href="#cb30-1177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb30-1178"><a href="#cb30-1178" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> town,</span>
<span id="cb30-1179"><a href="#cb30-1179" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> avg</span>
<span id="cb30-1180"><a href="#cb30-1180" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-1181"><a href="#cb30-1181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-1182"><a href="#cb30-1182" aria-hidden="true" tabindex="-1"></a>    <span class="at">price_pct_diff =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">round</span>((<span class="st">`</span><span class="at">New Haven</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Hartford</span><span class="st">`</span>)<span class="sc">/</span>(<span class="st">`</span><span class="at">Hartford</span><span class="st">`</span>), <span class="dv">4</span>)</span>
<span id="cb30-1183"><a href="#cb30-1183" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-1184"><a href="#cb30-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1185"><a href="#cb30-1185" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot long </span></span>
<span id="cb30-1186"><a href="#cb30-1186" aria-hidden="true" tabindex="-1"></a>new_haven_hartford_long <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb30-1187"><a href="#cb30-1187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hartford"</span>, <span class="st">"New Haven"</span>), </span>
<span id="cb30-1188"><a href="#cb30-1188" aria-hidden="true" tabindex="-1"></a>         property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>, <span class="st">"Two Family"</span>, </span>
<span id="cb30-1189"><a href="#cb30-1189" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Three Family"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb30-1190"><a href="#cb30-1190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town, property_type) <span class="sc">|&gt;</span></span>
<span id="cb30-1191"><a href="#cb30-1191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg =</span> <span class="fu">mean</span>(sale_amount)) <span class="sc">|&gt;</span></span>
<span id="cb30-1192"><a href="#cb30-1192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb30-1193"><a href="#cb30-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1194"><a href="#cb30-1194" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb30-1195"><a href="#cb30-1195" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_haven_hartford_long, <span class="fu">aes</span>(<span class="at">x =</span> property_type, <span class="at">y =</span> avg, <span class="at">fill =</span> town)) <span class="sc">+</span></span>
<span id="cb30-1196"><a href="#cb30-1196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>), <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb30-1197"><a href="#cb30-1197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb30-1198"><a href="#cb30-1198" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">dollar</span>(avg)),</span>
<span id="cb30-1199"><a href="#cb30-1199" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>),</span>
<span id="cb30-1200"><a href="#cb30-1200" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.4</span>,</span>
<span id="cb30-1201"><a href="#cb30-1201" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">3.5</span></span>
<span id="cb30-1202"><a href="#cb30-1202" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-1203"><a href="#cb30-1203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb30-1204"><a href="#cb30-1204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Hartford"</span> <span class="ot">=</span> <span class="st">"#c81d25"</span>, <span class="st">"New Haven"</span> <span class="ot">=</span> <span class="st">"#4895ef"</span>)) <span class="sc">+</span></span>
<span id="cb30-1205"><a href="#cb30-1205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-1206"><a href="#cb30-1206" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Property Prices: New Haven vs. Hartford"</span>,</span>
<span id="cb30-1207"><a href="#cb30-1207" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Property Type"</span>,</span>
<span id="cb30-1208"><a href="#cb30-1208" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Price (USD)"</span>,</span>
<span id="cb30-1209"><a href="#cb30-1209" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Town"</span></span>
<span id="cb30-1210"><a href="#cb30-1210" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-1211"><a href="#cb30-1211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb30-1212"><a href="#cb30-1212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-1213"><a href="#cb30-1213" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb30-1214"><a href="#cb30-1214" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb30-1215"><a href="#cb30-1215" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb30-1216"><a href="#cb30-1216" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb30-1217"><a href="#cb30-1217" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb30-1218"><a href="#cb30-1218" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-1219"><a href="#cb30-1219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-1220"><a href="#cb30-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1221"><a href="#cb30-1221" aria-hidden="true" tabindex="-1"></a><span class="fu">## 10. Which ten towns in Connecticut have the highest number of bus stops?"</span></span>
<span id="cb30-1222"><a href="#cb30-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1223"><a href="#cb30-1223" aria-hidden="true" tabindex="-1"></a>Based on the distribution of bus stops across Connecticut towns, we observe </span>
<span id="cb30-1224"><a href="#cb30-1224" aria-hidden="true" tabindex="-1"></a>that Hartford, New Haven, and Waterbury lead in public transit infrastructure, </span>
<span id="cb30-1225"><a href="#cb30-1225" aria-hidden="true" tabindex="-1"></a>each with more than 750 bus stops. </span>
<span id="cb30-1226"><a href="#cb30-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1229"><a href="#cb30-1229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-1230"><a href="#cb30-1230" aria-hidden="true" tabindex="-1"></a><span class="co"># CT bus stops data</span></span>
<span id="cb30-1231"><a href="#cb30-1231" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(stops_file, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, </span>
<span id="cb30-1232"><a href="#cb30-1232" aria-hidden="true" tabindex="-1"></a>                        <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-1233"><a href="#cb30-1233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb30-1234"><a href="#cb30-1234" aria-hidden="true" tabindex="-1"></a>    stop_id, stop_code, stop_name, stop_lat, stop_lon,</span>
<span id="cb30-1235"><a href="#cb30-1235" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-1236"><a href="#cb30-1236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1237"><a href="#cb30-1237" aria-hidden="true" tabindex="-1"></a><span class="co"># Connecticut towns' geometry </span></span>
<span id="cb30-1238"><a href="#cb30-1238" aria-hidden="true" tabindex="-1"></a>ct_towns_geom <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span> <span class="fu">select</span>(STATEFP, NAME)</span>
<span id="cb30-1239"><a href="#cb30-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1240"><a href="#cb30-1240" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a sf object based on the bus stop coordinate </span></span>
<span id="cb30-1241"><a href="#cb30-1241" aria-hidden="true" tabindex="-1"></a>bus_stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(bus_stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb30-1242"><a href="#cb30-1242" aria-hidden="true" tabindex="-1"></a>                         <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb30-1243"><a href="#cb30-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1244"><a href="#cb30-1244" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain the town name for each bus stop using `st_join` </span></span>
<span id="cb30-1245"><a href="#cb30-1245" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">st_join</span>(bus_stops_sf, ct_ny_towns_geom, <span class="at">join =</span> st_within) <span class="sc">|&gt;</span></span>
<span id="cb30-1246"><a href="#cb30-1246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-1247"><a href="#cb30-1247" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb30-1248"><a href="#cb30-1248" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb30-1249"><a href="#cb30-1249" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-1250"><a href="#cb30-1250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-1251"><a href="#cb30-1251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME) <span class="sc">|&gt;</span></span>
<span id="cb30-1252"><a href="#cb30-1252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-1253"><a href="#cb30-1253" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb30-1254"><a href="#cb30-1254" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"09"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb30-1255"><a href="#cb30-1255" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"36"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb30-1256"><a href="#cb30-1256" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb30-1257"><a href="#cb30-1257" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-1258"><a href="#cb30-1258" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-1259"><a href="#cb30-1259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>STATEFP)</span>
<span id="cb30-1260"><a href="#cb30-1260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1261"><a href="#cb30-1261" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of bus stops in each town</span></span>
<span id="cb30-1262"><a href="#cb30-1262" aria-hidden="true" tabindex="-1"></a>top10_town <span class="ot">&lt;-</span> bus_stops <span class="sc">|&gt;</span></span>
<span id="cb30-1263"><a href="#cb30-1263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"CT"</span>) <span class="sc">|&gt;</span>        </span>
<span id="cb30-1264"><a href="#cb30-1264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town) <span class="sc">|&gt;</span></span>
<span id="cb30-1265"><a href="#cb30-1265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_stops =</span> <span class="fu">n_distinct</span>(stop_id)) <span class="sc">|&gt;</span></span>
<span id="cb30-1266"><a href="#cb30-1266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_stops)) <span class="sc">|&gt;</span></span>
<span id="cb30-1267"><a href="#cb30-1267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(n_stops, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb30-1268"><a href="#cb30-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1269"><a href="#cb30-1269" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb30-1270"><a href="#cb30-1270" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top10_town, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(town, n_stops), <span class="at">y =</span> n_stops)) <span class="sc">+</span></span>
<span id="cb30-1271"><a href="#cb30-1271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2a9d8f"</span>) <span class="sc">+</span></span>
<span id="cb30-1272"><a href="#cb30-1272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_stops), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb30-1273"><a href="#cb30-1273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-1274"><a href="#cb30-1274" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 10 Connecticut Towns by Number of Bus Stops"</span>,</span>
<span id="cb30-1275"><a href="#cb30-1275" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Town"</span>,</span>
<span id="cb30-1276"><a href="#cb30-1276" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Bus Stops"</span></span>
<span id="cb30-1277"><a href="#cb30-1277" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-1278"><a href="#cb30-1278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb30-1279"><a href="#cb30-1279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-1280"><a href="#cb30-1280" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb30-1281"><a href="#cb30-1281" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb30-1282"><a href="#cb30-1282" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb30-1283"><a href="#cb30-1283" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb30-1284"><a href="#cb30-1284" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-1285"><a href="#cb30-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1286"><a href="#cb30-1286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-1287"><a href="#cb30-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1288"><a href="#cb30-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1289"><a href="#cb30-1289" aria-hidden="true" tabindex="-1"></a><span class="fu">## 11. What are the top five towns with the most connectivity to other towns? </span></span>
<span id="cb30-1290"><a href="#cb30-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1291"><a href="#cb30-1291" aria-hidden="true" tabindex="-1"></a>Hartford stands out as the most connected town in Connecticut's bus network, </span>
<span id="cb30-1292"><a href="#cb30-1292" aria-hidden="true" tabindex="-1"></a>with direct connections to 62 other towns. This high level of connectivity </span>
<span id="cb30-1293"><a href="#cb30-1293" aria-hidden="true" tabindex="-1"></a>underscores Hartford’s role as a central transportation hub in the region.</span>
<span id="cb30-1294"><a href="#cb30-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1297"><a href="#cb30-1297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-1298"><a href="#cb30-1298" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of trips that go between town pairs</span></span>
<span id="cb30-1299"><a href="#cb30-1299" aria-hidden="true" tabindex="-1"></a>town_edges <span class="ot">&lt;-</span> bus_trip_stop_data <span class="sc">|&gt;</span></span>
<span id="cb30-1300"><a href="#cb30-1300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(trip_id) <span class="sc">|&gt;</span></span>
<span id="cb30-1301"><a href="#cb30-1301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb30-1302"><a href="#cb30-1302" aria-hidden="true" tabindex="-1"></a>    <span class="at">origin_town =</span> town[<span class="fu">which.min</span>(stop_sequence)],</span>
<span id="cb30-1303"><a href="#cb30-1303" aria-hidden="true" tabindex="-1"></a>    <span class="at">dest_town =</span> town[<span class="fu">which.max</span>(stop_sequence)],</span>
<span id="cb30-1304"><a href="#cb30-1304" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb30-1305"><a href="#cb30-1305" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb30-1306"><a href="#cb30-1306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(origin_town <span class="sc">!=</span> dest_town) <span class="sc">|&gt;</span></span>
<span id="cb30-1307"><a href="#cb30-1307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(origin_town, dest_town, <span class="at">name =</span> <span class="st">"weight"</span>)</span>
<span id="cb30-1308"><a href="#cb30-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1309"><a href="#cb30-1309" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb30-1310"><a href="#cb30-1310" aria-hidden="true" tabindex="-1"></a>town_graph <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(town_edges, <span class="at">directed =</span> <span class="cn">FALSE</span>) </span>
<span id="cb30-1311"><a href="#cb30-1311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1312"><a href="#cb30-1312" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of towns a town connects to </span></span>
<span id="cb30-1313"><a href="#cb30-1313" aria-hidden="true" tabindex="-1"></a>town_connectivity <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb30-1314"><a href="#cb30-1314" aria-hidden="true" tabindex="-1"></a>  <span class="at">town =</span> <span class="fu">V</span>(town_graph)<span class="sc">$</span>name,</span>
<span id="cb30-1315"><a href="#cb30-1315" aria-hidden="true" tabindex="-1"></a>  <span class="at">degree =</span> <span class="fu">degree</span>(town_graph)</span>
<span id="cb30-1316"><a href="#cb30-1316" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb30-1317"><a href="#cb30-1317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(degree)) <span class="sc">|&gt;</span></span>
<span id="cb30-1318"><a href="#cb30-1318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(town, degree) <span class="sc">|&gt;</span></span>
<span id="cb30-1319"><a href="#cb30-1319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">n_connected_towns =</span> degree)</span>
<span id="cb30-1320"><a href="#cb30-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1321"><a href="#cb30-1321" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(town_connectivity) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb30-1322"><a href="#cb30-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1323"><a href="#cb30-1323" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the first top five towns with the highest connectivity to other towns </span></span>
<span id="cb30-1324"><a href="#cb30-1324" aria-hidden="true" tabindex="-1"></a>top5_towns <span class="ot">&lt;-</span> town_connectivity <span class="sc">|&gt;</span> <span class="fu">slice_max</span>(n_connected_towns, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb30-1325"><a href="#cb30-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1326"><a href="#cb30-1326" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb30-1327"><a href="#cb30-1327" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top5_towns, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(town, <span class="sc">-</span>n_connected_towns), </span>
<span id="cb30-1328"><a href="#cb30-1328" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> n_connected_towns)) <span class="sc">+</span></span>
<span id="cb30-1329"><a href="#cb30-1329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb30-1330"><a href="#cb30-1330" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_connected_towns), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb30-1331"><a href="#cb30-1331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-1332"><a href="#cb30-1332" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top Towns by Connectivity to Other Towns"</span>,</span>
<span id="cb30-1333"><a href="#cb30-1333" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Town"</span>,</span>
<span id="cb30-1334"><a href="#cb30-1334" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Connected Towns"</span></span>
<span id="cb30-1335"><a href="#cb30-1335" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-1336"><a href="#cb30-1336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb30-1337"><a href="#cb30-1337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb30-1338"><a href="#cb30-1338" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb30-1339"><a href="#cb30-1339" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb30-1340"><a href="#cb30-1340" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb30-1341"><a href="#cb30-1341" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb30-1342"><a href="#cb30-1342" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-1343"><a href="#cb30-1343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-1344"><a href="#cb30-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1345"><a href="#cb30-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1346"><a href="#cb30-1346" aria-hidden="true" tabindex="-1"></a><span class="fu"># Model Performance</span></span>
<span id="cb30-1347"><a href="#cb30-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1348"><a href="#cb30-1348" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The three predictors together explain 36% variation in real estate pricing in</span>
<span id="cb30-1349"><a href="#cb30-1349" aria-hidden="true" tabindex="-1"></a>  Connecticut.</span>
<span id="cb30-1350"><a href="#cb30-1350" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Due to missing values in the property type variable, 223,811 observations were </span>
<span id="cb30-1351"><a href="#cb30-1351" aria-hidden="true" tabindex="-1"></a>  omitted in the model fitting process. This represents a limitation that should</span>
<span id="cb30-1352"><a href="#cb30-1352" aria-hidden="true" tabindex="-1"></a>  be addressed in future work.</span>
<span id="cb30-1353"><a href="#cb30-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1356"><a href="#cb30-1356" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb30-1357"><a href="#cb30-1357" aria-hidden="true" tabindex="-1"></a><span class="co"># Center the predictor `nearest_rail_station_dist` as it is highly correlated </span></span>
<span id="cb30-1358"><a href="#cb30-1358" aria-hidden="true" tabindex="-1"></a><span class="co"># with `point_dist_to_nyc`</span></span>
<span id="cb30-1359"><a href="#cb30-1359" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span> </span>
<span id="cb30-1360"><a href="#cb30-1360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-1361"><a href="#cb30-1361" aria-hidden="true" tabindex="-1"></a>    <span class="at">centered_nearest_rail_station_dist =</span> </span>
<span id="cb30-1362"><a href="#cb30-1362" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(nearest_rail_station_dist <span class="sc">-</span> <span class="fu">mean</span>(nearest_rail_station_dist), <span class="dv">2</span>)</span>
<span id="cb30-1363"><a href="#cb30-1363" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-1364"><a href="#cb30-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1365"><a href="#cb30-1365" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply a log transformation to predicting variable: `sale_amount` and fit a </span></span>
<span id="cb30-1366"><a href="#cb30-1366" aria-hidden="true" tabindex="-1"></a><span class="co"># linear regression model using three predictors</span></span>
<span id="cb30-1367"><a href="#cb30-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1368"><a href="#cb30-1368" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(sale_amount) <span class="sc">~</span> point_dist_to_nyc <span class="sc">+</span> </span>
<span id="cb30-1369"><a href="#cb30-1369" aria-hidden="true" tabindex="-1"></a>              centered_nearest_rail_station_dist <span class="sc">+</span></span>
<span id="cb30-1370"><a href="#cb30-1370" aria-hidden="true" tabindex="-1"></a>              property_type, <span class="at">data =</span> ct_sales_cleaned)</span>
<span id="cb30-1371"><a href="#cb30-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1372"><a href="#cb30-1372" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb30-1373"><a href="#cb30-1373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb30-1374"><a href="#cb30-1374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1375"><a href="#cb30-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1376"><a href="#cb30-1376" aria-hidden="true" tabindex="-1"></a><span class="fu"># Future Work</span></span>
<span id="cb30-1377"><a href="#cb30-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1378"><a href="#cb30-1378" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are several challenges and limitations we aim to address in future work. </span>
<span id="cb30-1379"><a href="#cb30-1379" aria-hidden="true" tabindex="-1"></a>  First, we plan to obtain accurate property type classifications for properties </span>
<span id="cb30-1380"><a href="#cb30-1380" aria-hidden="true" tabindex="-1"></a>  with missing values. Our initial attempt to impute property type using the </span>
<span id="cb30-1381"><a href="#cb30-1381" aria-hidden="true" tabindex="-1"></a>  nearest neighbor method proved to be unreliable.</span>
<span id="cb30-1382"><a href="#cb30-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1383"><a href="#cb30-1383" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We also intend to explore alternative statistical learning models to train the </span>
<span id="cb30-1384"><a href="#cb30-1384" aria-hidden="true" tabindex="-1"></a>  dataset. Given the large volume of observations in the Connecticut real estate </span>
<span id="cb30-1385"><a href="#cb30-1385" aria-hidden="true" tabindex="-1"></a>  dataset, implementing models such as random forests may require significant </span>
<span id="cb30-1386"><a href="#cb30-1386" aria-hidden="true" tabindex="-1"></a>  computational resources. </span>
<span id="cb30-1387"><a href="#cb30-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1388"><a href="#cb30-1388" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Additionally, we are interested in applying network theory to model the </span>
<span id="cb30-1389"><a href="#cb30-1389" aria-hidden="true" tabindex="-1"></a>  connectivity among towns. This could help us better understand whether certain </span>
<span id="cb30-1390"><a href="#cb30-1390" aria-hidden="true" tabindex="-1"></a>  structural or regional factors contribute to the distribution of real estate </span>
<span id="cb30-1391"><a href="#cb30-1391" aria-hidden="true" tabindex="-1"></a>  pricing in Connecticut.</span>
<span id="cb30-1392"><a href="#cb30-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1393"><a href="#cb30-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1394"><a href="#cb30-1394" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusion</span></span>
<span id="cb30-1395"><a href="#cb30-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1396"><a href="#cb30-1396" aria-hidden="true" tabindex="-1"></a>Based on our analysis and model performance, we found a moderate relationship </span>
<span id="cb30-1397"><a href="#cb30-1397" aria-hidden="true" tabindex="-1"></a>between property values in Connecticut and two key factors: proximity to the </span>
<span id="cb30-1398"><a href="#cb30-1398" aria-hidden="true" tabindex="-1"></a>economic center—New York City—and direct accessibility to rail stations. The </span>
<span id="cb30-1399"><a href="#cb30-1399" aria-hidden="true" tabindex="-1"></a>impact on home values is more pronounced, with values tending to decrease </span>
<span id="cb30-1400"><a href="#cb30-1400" aria-hidden="true" tabindex="-1"></a>moderately as the distance from these economic and transportation hubs increases.</span>
<span id="cb30-1401"><a href="#cb30-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1402"><a href="#cb30-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1403"><a href="#cb30-1403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1404"><a href="#cb30-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1405"><a href="#cb30-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1406"><a href="#cb30-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1407"><a href="#cb30-1407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1408"><a href="#cb30-1408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1409"><a href="#cb30-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1410"><a href="#cb30-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1411"><a href="#cb30-1411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1412"><a href="#cb30-1412" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>