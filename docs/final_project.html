<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hong Zhuang">

<title>Final Project: How does proximity to NYC impact the real estate pricing in Connecticut? – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-and-motivation" id="toc-introduction-and-motivation" class="nav-link active" data-scroll-target="#introduction-and-motivation">Introduction and Motivation</a></li>
  <li><a href="#data-acquisitions" id="toc-data-acquisitions" class="nav-link" data-scroll-target="#data-acquisitions">Data Acquisitions</a>
  <ul class="collapse">
  <li><a href="#connecticut-real-estate-sales-dataset" id="toc-connecticut-real-estate-sales-dataset" class="nav-link" data-scroll-target="#connecticut-real-estate-sales-dataset">Connecticut Real Estate Sales Dataset</a></li>
  <li><a href="#connecticut-county-and-town-shape-files" id="toc-connecticut-county-and-town-shape-files" class="nav-link" data-scroll-target="#connecticut-county-and-town-shape-files">Connecticut County and Town Shape files</a></li>
  <li><a href="#metro-north" id="toc-metro-north" class="nav-link" data-scroll-target="#metro-north">Metro North</a></li>
  <li><a href="#ct-transit-data" id="toc-ct-transit-data" class="nav-link" data-scroll-target="#ct-transit-data">CT transit Data</a></li>
  </ul></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">Data Cleaning</a></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing">Data Preprocessing</a>
  <ul class="collapse">
  <li><a href="#define-the-metric-of-proximity-to-nyc-using-grand-central-as-anchor-point" id="toc-define-the-metric-of-proximity-to-nyc-using-grand-central-as-anchor-point" class="nav-link" data-scroll-target="#define-the-metric-of-proximity-to-nyc-using-grand-central-as-anchor-point">Define the metric of proximity to NYC: using Grand Central as anchor point</a></li>
  <li><a href="#verify-mappings-between-property-addresses-and-their-geographic-coordinates" id="toc-verify-mappings-between-property-addresses-and-their-geographic-coordinates" class="nav-link" data-scroll-target="#verify-mappings-between-property-addresses-and-their-geographic-coordinates">Verify Mappings Between Property Addresses and Their Geographic Coordinates</a>
  <ul class="collapse">
  <li><a href="#define-a-function-to-compute-the-distance-range-for-each-town-from-grand-central-terminal" id="toc-define-a-function-to-compute-the-distance-range-for-each-town-from-grand-central-terminal" class="nav-link" data-scroll-target="#define-a-function-to-compute-the-distance-range-for-each-town-from-grand-central-terminal">Define a function to compute the distance range for each town from Grand Central Terminal</a></li>
  </ul></li>
  <li><a href="#imputation-of-missing-values-location" id="toc-imputation-of-missing-values-location" class="nav-link" data-scroll-target="#imputation-of-missing-values-location">Imputation of Missing Values: <code>location</code></a></li>
  <li><a href="#handle-missing-values-property_type" id="toc-handle-missing-values-property_type" class="nav-link" data-scroll-target="#handle-missing-values-property_type">Handle Missing Values: <code>property_type</code></a>
  <ul class="collapse">
  <li><a href="#fill-missing-values-using-ct-state-parcel-records" id="toc-fill-missing-values-using-ct-state-parcel-records" class="nav-link" data-scroll-target="#fill-missing-values-using-ct-state-parcel-records">Fill Missing Values: Using CT State Parcel Records</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#what-is-the-total-number-of-real-estate-transactions-and-the-corresponding-aggregate-sale-volume-by-county" id="toc-what-is-the-total-number-of-real-estate-transactions-and-the-corresponding-aggregate-sale-volume-by-county" class="nav-link" data-scroll-target="#what-is-the-total-number-of-real-estate-transactions-and-the-corresponding-aggregate-sale-volume-by-county">1. What is the total number of real estate transactions and the corresponding aggregate sale volume by county?</a></li>
  <li><a href="#how-many-repeated-sales-are-there-in-each-county" id="toc-how-many-repeated-sales-are-there-in-each-county" class="nav-link" data-scroll-target="#how-many-repeated-sales-are-there-in-each-county">2. How many repeated sales are there in each county?</a></li>
  <li><a href="#how-much-have-average-single-family-home-values-changed-in-each-county" id="toc-how-much-have-average-single-family-home-values-changed-in-each-county" class="nav-link" data-scroll-target="#how-much-have-average-single-family-home-values-changed-in-each-county">3. How much have average single-family home values changed in each county?</a></li>
  <li><a href="#which-months-or-quarters-see-the-most-activity" id="toc-which-months-or-quarters-see-the-most-activity" class="nav-link" data-scroll-target="#which-months-or-quarters-see-the-most-activity">4. Which months or quarters see the most activity?</a></li>
  <li><a href="#what-are-the-hotspots-for-high-value-transactions" id="toc-what-are-the-hotspots-for-high-value-transactions" class="nav-link" data-scroll-target="#what-are-the-hotspots-for-high-value-transactions">5. What are the hotspots for high-value transactions?</a></li>
  </ul></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering">Feature Engineering</a>
  <ul class="collapse">
  <li><a href="#calculate-distance-km-from-grand-central-terminal-for-each-property" id="toc-calculate-distance-km-from-grand-central-terminal-for-each-property" class="nav-link" data-scroll-target="#calculate-distance-km-from-grand-central-terminal-for-each-property">Calculate Distance (km) from Grand Central Terminal for Each Property</a></li>
  <li><a href="#compute-distance-from-each-property-to-the-nearest-train-station" id="toc-compute-distance-from-each-property-to-the-nearest-train-station" class="nav-link" data-scroll-target="#compute-distance-from-each-property-to-the-nearest-train-station">Compute Distance from Each Property to the Nearest Train Station</a></li>
  <li><a href="#what-percentage-of-properties-in-fairfield-and-new-haven-counties-are-located-within-3-km-of-the-nearest-metro-north-station" id="toc-what-percentage-of-properties-in-fairfield-and-new-haven-counties-are-located-within-3-km-of-the-nearest-metro-north-station" class="nav-link" data-scroll-target="#what-percentage-of-properties-in-fairfield-and-new-haven-counties-are-located-within-3-km-of-the-nearest-metro-north-station">6. What percentage of properties in Fairfield and New Haven Counties are located within 3 km of the nearest Metro-North station?</a></li>
  <li><a href="#how-does-proximity-to-the-nearest-train-station-correlate-with-home-values-in-fairfield-county" id="toc-how-does-proximity-to-the-nearest-train-station-correlate-with-home-values-in-fairfield-county" class="nav-link" data-scroll-target="#how-does-proximity-to-the-nearest-train-station-correlate-with-home-values-in-fairfield-county">7. How does proximity to the nearest train station correlate with home values in Fairfield County?</a></li>
  <li><a href="#how-do-average-property-values-differ-by-property-type-between-new-haven-and-hartford-towns" id="toc-how-do-average-property-values-differ-by-property-type-between-new-haven-and-hartford-towns" class="nav-link" data-scroll-target="#how-do-average-property-values-differ-by-property-type-between-new-haven-and-hartford-towns">8. How do average property values differ by property type between New Haven and Hartford towns?</a></li>
  <li><a href="#which-ten-towns-in-connecticut-have-the-highest-number-of-bus-stops" id="toc-which-ten-towns-in-connecticut-have-the-highest-number-of-bus-stops" class="nav-link" data-scroll-target="#which-ten-towns-in-connecticut-have-the-highest-number-of-bus-stops">9. Which ten towns in Connecticut have the highest number of bus stops?”</a></li>
  <li><a href="#what-are-the-top-five-towns-with-the-most-connectivity-to-other-towns" id="toc-what-are-the-top-five-towns-with-the-most-connectivity-to-other-towns" class="nav-link" data-scroll-target="#what-are-the-top-five-towns-with-the-most-connectivity-to-other-towns">10. What are the top five towns with the most connectivity to other towns?</a></li>
  </ul></li>
  <li><a href="#model-performance" id="toc-model-performance" class="nav-link" data-scroll-target="#model-performance">Model Performance</a></li>
  <li><a href="#future-work" id="toc-future-work" class="nav-link" data-scroll-target="#future-work">Future Work</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="final_project.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Final Project: How does proximity to NYC impact the real estate pricing in Connecticut?</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hong Zhuang </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction-and-motivation" class="level1">
<h1>Introduction and Motivation</h1>
<p>The spatial distribution of real estate activity across Connecticut reveals a notable geographic trend: counties located closer to major urban economic centers, particularly New York City, exhibit stronger market performance. Fairfield County, situated in the southwestern corner of the state, stands out as the most active real estate market. According to the dataset, it recorded 211,845 property transactions between 2001 and 2022—the highest among all counties—spanning residential, commercial, vacant land, and public utility properties(see Table 1). This market strength is accompanied by the highest total dollar volume of transactions, signaling both high demand and high property values.</p>
<p>A key differentiation for Fairfield is its geographical proximity to NYC and accessibility via the Metro-North Railroad, which positions it as a prime location for commuters seeking suburban living with urban job opportunities. This suggests that connectivity to economic hubs may play a significant role in driving property values and transaction volumes.</p>
<p>Motivated by this observation, this analysis aims to examine how distance from New York City correlates with real estate market activity across Connecticut counties. By quantifying this relationship, we can better understand the extent to which geographic accessibility influences housing demand and pricing—offering valuable insights for urban planners, real estate developers/analysts, and policy makers.</p>
</section>
<section id="data-acquisitions" class="level1">
<h1>Data Acquisitions</h1>
<section id="connecticut-real-estate-sales-dataset" class="level2">
<h2 class="anchored" data-anchor-id="connecticut-real-estate-sales-dataset">Connecticut Real Estate Sales Dataset</h2>
<p>The primary data source used in our analysis can be found at: <a href="https://data.ct.gov/Housing-and-Development/Real-Estate-Sales-2001-2022-GL/5mzw-sjtu/about_data">CT Real Estate Sales</a></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load relevant packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales) </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)   </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmaptools)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris) </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the sales dataset into R</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/STA9750/STA9750-2025-SPRING/data/fp01/ct_sales.csv"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Format `ct_sales` column names </span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ct_sales) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"_"</span>, <span class="fu">colnames</span>(ct_sales)))</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a unique ID for each transaction to facilitate easier referencing </span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># and joining with other data sources</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_id =</span> <span class="fu">row_number</span>()</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    ref_id,</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">everything</span>()</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the town name for records with "unknown" value</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">town =</span> <span class="fu">case_when</span>(</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>      town <span class="sc">==</span>   <span class="st">"***Unknown***"</span> <span class="sc">~</span> <span class="st">"East Hampton"</span>,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> town</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Map each town to its corresponding county </span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>ct_town_county_codes<span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/STA9750/STA9750-2025-SPRING/ct_town_county_codes.csv"</span>)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    ct_town_county_codes <span class="sc">|&gt;</span> <span class="fu">select</span>(town_name, county),</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"town"</span> <span class="ot">=</span> <span class="st">"town_name"</span>)</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(ct_sales, <span class="dv">10</span>), <span class="at">caption =</span> <span class="st">"First 10 Rows of CT Real Estate Sales"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 10 Rows of CT Real Estate Sales</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">ref_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">serial_number</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">list_year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">date_recorded</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">address</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">assessed_value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sale_amount</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sales_ratio</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">property_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">residential_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">non_use_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">assessor_remarks</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">opm_remarks</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">county</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">220008</td>
<td style="text-align: right;">2022</td>
<td style="text-align: left;">01/30/2023</td>
<td style="text-align: left;">Andover</td>
<td style="text-align: left;">618 ROUTE 6</td>
<td style="text-align: right;">139020</td>
<td style="text-align: right;">232000</td>
<td style="text-align: right;">0.5992</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">POINT (-72.343628962 41.728431984)</td>
<td style="text-align: left;">Tolland</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2020348</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">09/13/2021</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: left;">230 WAKELEE AVE</td>
<td style="text-align: right;">150500</td>
<td style="text-align: right;">325000</td>
<td style="text-align: right;">0.4630</td>
<td style="text-align: left;">Commercial</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">New Haven</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">20002</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">10/02/2020</td>
<td style="text-align: left;">Ashford</td>
<td style="text-align: left;">390 TURNPIKE RD</td>
<td style="text-align: right;">253000</td>
<td style="text-align: right;">430000</td>
<td style="text-align: right;">0.5883</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Windham</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">210317</td>
<td style="text-align: right;">2021</td>
<td style="text-align: left;">07/05/2022</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">53 COTSWOLD WAY</td>
<td style="text-align: right;">329730</td>
<td style="text-align: right;">805000</td>
<td style="text-align: right;">0.4096</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">POINT (-72.846365959 41.781677018)</td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">200212</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">03/09/2021</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">5 CHESTNUT DRIVE</td>
<td style="text-align: right;">130400</td>
<td style="text-align: right;">179900</td>
<td style="text-align: right;">0.7248</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Condo</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">200243</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">04/13/2021</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">111 NORTHINGTON DRIVE</td>
<td style="text-align: right;">619290</td>
<td style="text-align: right;">890000</td>
<td style="text-align: right;">0.6958</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">200377</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">07/02/2021</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">70 FAR HILLS DRIVE</td>
<td style="text-align: right;">862330</td>
<td style="text-align: right;">1447500</td>
<td style="text-align: right;">0.5957</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">22043</td>
<td style="text-align: right;">2022</td>
<td style="text-align: left;">03/15/2023</td>
<td style="text-align: left;">Beacon Falls</td>
<td style="text-align: left;">41 EDGEWOOD DRIVE</td>
<td style="text-align: right;">164170</td>
<td style="text-align: right;">285000</td>
<td style="text-align: right;">0.5760</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">POINT (-73.053071989 41.439434021)</td>
<td style="text-align: left;">New Haven</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">200109</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">12/09/2020</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">57 FAR HILLS DRIVE</td>
<td style="text-align: right;">847520</td>
<td style="text-align: right;">1250000</td>
<td style="text-align: right;">0.6780</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">2020180</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">03/01/2021</td>
<td style="text-align: left;">Berlin</td>
<td style="text-align: left;">1539 FARMINGTON AVE</td>
<td style="text-align: right;">234200</td>
<td style="text-align: right;">130000</td>
<td style="text-align: right;">1.8015</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Two Family</td>
<td style="text-align: left;">08 - Part Interest</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Hartford</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="connecticut-county-and-town-shape-files" class="level2">
<h2 class="anchored" data-anchor-id="connecticut-county-and-town-shape-files">Connecticut County and Town Shape files</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read county shape file into R</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"~/downloads/tl_2020_us_county/tl_2020_us_county.shp"</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">quiet =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(STATEFP <span class="sc">==</span> <span class="st">"09"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Town shape file</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>ct_towns <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"~/downloads/tl_2020_09_cousub/tl_2020_09_cousub.shp"</span>, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="metro-north" class="level2">
<h2 class="anchored" data-anchor-id="metro-north">Metro North</h2>
<p>The Metro North stations can be obtained here: <a href="https://www.mta.info/developers">Metro-North Railroad</a></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>stops <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">"~/STA9750/STA9750-2025-SPRING/data/fp01/gtfsmnr/stops.txt"</span>, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Connecticut towns' geometry </span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>ct_towns_geom <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span> <span class="fu">select</span>(STATEFP, NAME)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># # ny_towns &lt;- county_subdivisions(state = "NY")</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # ny_towns_geom &lt;- ny_towns |&gt; select(STATEFP, NAME)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(ny_towns_geom, "ny_towns_geom.rds")</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>ny_towns_geom <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ny_towns_geom.rds"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>ct_ny_towns_geom <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ct_towns_geom, ny_towns_geom)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>stops <span class="ot">&lt;-</span> stops <span class="sc">|&gt;</span> <span class="fu">select</span>(stop_id, stop_name, stop_lon, stop_lat)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object of Metro North stops</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the state and the town for each stop where it is located </span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>stops <span class="ot">&lt;-</span> <span class="fu">st_join</span>(stops_sf, ct_ny_towns_geom, <span class="at">join =</span> st_within) <span class="sc">|&gt;</span> </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME) <span class="sc">|&gt;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"09"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"36"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>STATEFP) <span class="sc">|&gt;</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(stops, <span class="at">by =</span> <span class="st">"stop_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">stop_name =</span> stop_name.x</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>stop_name.y)</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(stops, <span class="dv">10</span>), <span class="at">caption =</span> <span class="st">"First 10 Rows of Metro North Stations"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 10 Rows of Metro North Stations</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">stop_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stop_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lon</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lat</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stop_lon</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stop_lat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Grand Central</td>
<td style="text-align: left;">Manhattan</td>
<td style="text-align: right;">-73.97706</td>
<td style="text-align: right;">40.75300</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.97706</td>
<td style="text-align: right;">40.75300</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Harlem-125 St</td>
<td style="text-align: left;">Manhattan</td>
<td style="text-align: right;">-73.93915</td>
<td style="text-align: right;">40.80516</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.93915</td>
<td style="text-align: right;">40.80516</td>
</tr>
<tr class="odd">
<td style="text-align: right;">622</td>
<td style="text-align: left;">Yankees-E 153 St</td>
<td style="text-align: left;">Bronx</td>
<td style="text-align: right;">-73.92990</td>
<td style="text-align: right;">40.82530</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.92990</td>
<td style="text-align: right;">40.82530</td>
</tr>
<tr class="even">
<td style="text-align: right;">184</td>
<td style="text-align: left;">Highbridge Yard</td>
<td style="text-align: left;">Bronx</td>
<td style="text-align: right;">-73.93150</td>
<td style="text-align: right;">40.83590</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.93150</td>
<td style="text-align: right;">40.83590</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: left;">Morris Heights</td>
<td style="text-align: left;">Bronx</td>
<td style="text-align: right;">-73.91958</td>
<td style="text-align: right;">40.85425</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.91958</td>
<td style="text-align: right;">40.85425</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">University Heights</td>
<td style="text-align: left;">Bronx</td>
<td style="text-align: right;">-73.91312</td>
<td style="text-align: right;">40.86225</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.91312</td>
<td style="text-align: right;">40.86225</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: left;">Marble Hill</td>
<td style="text-align: left;">Manhattan</td>
<td style="text-align: right;">-73.91094</td>
<td style="text-align: right;">40.87433</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.91094</td>
<td style="text-align: right;">40.87433</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: left;">Spuyten Duyvil</td>
<td style="text-align: left;">Bronx</td>
<td style="text-align: right;">-73.92145</td>
<td style="text-align: right;">40.87824</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.92145</td>
<td style="text-align: right;">40.87824</td>
</tr>
<tr class="odd">
<td style="text-align: right;">16</td>
<td style="text-align: left;">Riverdale</td>
<td style="text-align: left;">Bronx</td>
<td style="text-align: right;">-73.91413</td>
<td style="text-align: right;">40.90398</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.91413</td>
<td style="text-align: right;">40.90398</td>
</tr>
<tr class="even">
<td style="text-align: right;">17</td>
<td style="text-align: left;">Ludlow</td>
<td style="text-align: left;">Yonkers</td>
<td style="text-align: right;">-73.90461</td>
<td style="text-align: right;">40.92497</td>
<td style="text-align: left;">NY</td>
<td style="text-align: right;">-73.90461</td>
<td style="text-align: right;">40.92497</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="ct-transit-data" class="level2">
<h2 class="anchored" data-anchor-id="ct-transit-data">CT transit Data</h2>
<p>CT transit data can be found: <a href="https://www.cttransit.com/about/developers">CT Bus Data</a></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bus_stops &lt;- read.delim("~/Downloads/googlect_transit/stops.txt",</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#                         header = TRUE, sep = ",", stringsAsFactors = FALSE) |&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     stop_id, stop_code, stop_name, stop_lat, stop_lon  # Select relevant columns</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># stop_times &lt;- read.delim("~/Downloads/googlect_transit/stop_times.txt", </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                          header = TRUE, sep = ",", stringsAsFactors = FALSE)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># trips &lt;- read.delim("~/Downloads/googlect_transit/trips.txt", </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                     header = TRUE, sep = ",", stringsAsFactors = FALSE)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># # Combine these datasets to obtain trip-level bus data in Connecticut</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># bus_trip_stop_data &lt;- stop_times |&gt;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(bus_stops, by = "stop_id") |&gt;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(trips, by = "trip_id") |&gt;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     trip_id,</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     route_id,</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     block_id,</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     shape_id,</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     stop_sequence,</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     stop_id, </span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     arrival_time,</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">#     departure_time,</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     shape_dist_traveled,</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     stop_name,</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     town, </span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     lon,</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     lat, </span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     state,</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the combined datasets</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(bus_trip_stop_data, "bus_trip_stop_data.csv", row.names = FALSE)</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Trip-level CTtransit data into R using </span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>bus_trip_stop_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"bus_trip_stop_data.csv"</span>)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(bus_trip_stop_data, <span class="dv">10</span>), <span class="at">caption =</span> <span class="st">"First 10 Rows of CT Bus Trips"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 10 Rows of CT Bus Trips</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">trip_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">route_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">block_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">shape_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stop_sequence</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">stop_id</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">arrival_time</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">departure_time</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">shape_dist_traveled</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">stop_name</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lon</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lat</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">state</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8558</td>
<td style="text-align: left;">17:15:00</td>
<td style="text-align: left;">17:15:00</td>
<td style="text-align: right;">NA</td>
<td style="text-align: left;">Church St @ George St</td>
<td style="text-align: left;">New Haven</td>
<td style="text-align: right;">-72.92707</td>
<td style="text-align: right;">41.30416</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="even">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8557</td>
<td style="text-align: left;">17:18:00</td>
<td style="text-align: left;">17:18:00</td>
<td style="text-align: right;">0.5315</td>
<td style="text-align: left;">College St @ George St</td>
<td style="text-align: left;">New Haven</td>
<td style="text-align: right;">-72.93073</td>
<td style="text-align: right;">41.30468</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5769</td>
<td style="text-align: left;">17:18:19</td>
<td style="text-align: left;">17:18:19</td>
<td style="text-align: right;">0.6892</td>
<td style="text-align: left;">S Frontage @ College St</td>
<td style="text-align: left;">New Haven</td>
<td style="text-align: right;">-72.93133</td>
<td style="text-align: right;">41.30342</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="even">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4744</td>
<td style="text-align: left;">17:28:56</td>
<td style="text-align: left;">17:28:56</td>
<td style="text-align: right;">5.9520</td>
<td style="text-align: left;">Frontage Rd @ Kimberly Ave</td>
<td style="text-align: left;">East Haven</td>
<td style="text-align: right;">-72.87874</td>
<td style="text-align: right;">41.28577</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">4743</td>
<td style="text-align: left;">17:29:55</td>
<td style="text-align: left;">17:29:55</td>
<td style="text-align: right;">6.4437</td>
<td style="text-align: left;">Saltonstall Pkwy @ Forbes Pl</td>
<td style="text-align: left;">East Haven</td>
<td style="text-align: right;">-72.87369</td>
<td style="text-align: right;">41.28361</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="even">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">4742</td>
<td style="text-align: left;">17:30:49</td>
<td style="text-align: left;">17:30:49</td>
<td style="text-align: right;">6.8914</td>
<td style="text-align: left;">Saltonstall Pkwy @ Sanford St</td>
<td style="text-align: left;">East Haven</td>
<td style="text-align: right;">-72.86922</td>
<td style="text-align: right;">41.28140</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">4745</td>
<td style="text-align: left;">17:31:22</td>
<td style="text-align: left;">17:31:22</td>
<td style="text-align: right;">7.1657</td>
<td style="text-align: left;">Saltonstall Pkwy @ Hemingway Ave</td>
<td style="text-align: left;">East Haven</td>
<td style="text-align: right;">-72.86672</td>
<td style="text-align: right;">41.27981</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="even">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">10488</td>
<td style="text-align: left;">17:32:21</td>
<td style="text-align: left;">17:32:21</td>
<td style="text-align: right;">7.6591</td>
<td style="text-align: left;">Saltonstall Pkwy @ Main St</td>
<td style="text-align: left;">East Haven</td>
<td style="text-align: right;">-72.86182</td>
<td style="text-align: right;">41.27727</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">4612</td>
<td style="text-align: left;">17:32:35</td>
<td style="text-align: left;">17:32:35</td>
<td style="text-align: right;">7.7823</td>
<td style="text-align: left;">W Main St @ Dominican Rd</td>
<td style="text-align: left;">Branford</td>
<td style="text-align: right;">-72.86029</td>
<td style="text-align: right;">41.27732</td>
<td style="text-align: left;">CT</td>
</tr>
<tr class="even">
<td style="text-align: right;">1796748</td>
<td style="text-align: right;">15182</td>
<td style="text-align: right;">130551</td>
<td style="text-align: right;">157578</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4613</td>
<td style="text-align: left;">17:33:07</td>
<td style="text-align: left;">17:33:07</td>
<td style="text-align: right;">8.0512</td>
<td style="text-align: left;">W Main St @ Rose Hill Rd</td>
<td style="text-align: left;">Branford</td>
<td style="text-align: right;">-72.85712</td>
<td style="text-align: right;">41.27746</td>
<td style="text-align: left;">CT</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="data-cleaning" class="level1">
<h1>Data Cleaning</h1>
<ul>
<li><p>Identify wrong/incorrect/duplicate entries. Use anti_join to remove these records from our <code>ct_sales</code> data.</p></li>
<li><p>Remove properties whose sale prices are not comparable to similar properties due to foreclosure, private sale, change in property or other reasons based on the information provided in <code>non_use_code</code> column.</p></li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplicates, incorrect property values, etc </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>to_remove <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">concerning =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(opm_remarks, <span class="fu">regex</span>(<span class="st">"duplicate|incorrect|wrong|error|missing"</span>, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(concerning <span class="sc">==</span> <span class="st">"Yes"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Use anti_join to remove these incorrect/duplicate from `ct_sales` </span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(to_remove, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"serial_number"</span>, <span class="st">"address"</span>))</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove properties with non_use_code </span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">nchar</span>(non_use_code) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove transactions with `sale_amount` 0 </span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">filter</span>(sale_amount <span class="sc">&gt;</span> <span class="dv">10000</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(ct_sales, <span class="dv">10</span>), <span class="at">caption =</span> <span class="st">"First 10 Rows of CT Sales"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 10 Rows of CT Sales</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">ref_id</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">serial_number</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">list_year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">date_recorded</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">address</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">assessed_value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sale_amount</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sales_ratio</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">property_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">residential_type</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">non_use_code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">assessor_remarks</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">opm_remarks</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">location</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">county</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">220008</td>
<td style="text-align: right;">2022</td>
<td style="text-align: left;">01/30/2023</td>
<td style="text-align: left;">Andover</td>
<td style="text-align: left;">618 ROUTE 6</td>
<td style="text-align: right;">139020</td>
<td style="text-align: right;">232000</td>
<td style="text-align: right;">0.5992</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">POINT (-72.343628962 41.728431984)</td>
<td style="text-align: left;">Tolland</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2020348</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">09/13/2021</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: left;">230 WAKELEE AVE</td>
<td style="text-align: right;">150500</td>
<td style="text-align: right;">325000</td>
<td style="text-align: right;">0.4630</td>
<td style="text-align: left;">Commercial</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">New Haven</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">20002</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">10/02/2020</td>
<td style="text-align: left;">Ashford</td>
<td style="text-align: left;">390 TURNPIKE RD</td>
<td style="text-align: right;">253000</td>
<td style="text-align: right;">430000</td>
<td style="text-align: right;">0.5883</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Windham</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">210317</td>
<td style="text-align: right;">2021</td>
<td style="text-align: left;">07/05/2022</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">53 COTSWOLD WAY</td>
<td style="text-align: right;">329730</td>
<td style="text-align: right;">805000</td>
<td style="text-align: right;">0.4096</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">POINT (-72.846365959 41.781677018)</td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">200212</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">03/09/2021</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">5 CHESTNUT DRIVE</td>
<td style="text-align: right;">130400</td>
<td style="text-align: right;">179900</td>
<td style="text-align: right;">0.7248</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Condo</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">200243</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">04/13/2021</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">111 NORTHINGTON DRIVE</td>
<td style="text-align: right;">619290</td>
<td style="text-align: right;">890000</td>
<td style="text-align: right;">0.6958</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">200377</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">07/02/2021</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">70 FAR HILLS DRIVE</td>
<td style="text-align: right;">862330</td>
<td style="text-align: right;">1447500</td>
<td style="text-align: right;">0.5957</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">22043</td>
<td style="text-align: right;">2022</td>
<td style="text-align: left;">03/15/2023</td>
<td style="text-align: left;">Beacon Falls</td>
<td style="text-align: left;">41 EDGEWOOD DRIVE</td>
<td style="text-align: right;">164170</td>
<td style="text-align: right;">285000</td>
<td style="text-align: right;">0.5760</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">POINT (-73.053071989 41.439434021)</td>
<td style="text-align: left;">New Haven</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">200109</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">12/09/2020</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: left;">57 FAR HILLS DRIVE</td>
<td style="text-align: right;">847520</td>
<td style="text-align: right;">1250000</td>
<td style="text-align: right;">0.6780</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Hartford</td>
</tr>
<tr class="even">
<td style="text-align: right;">11</td>
<td style="text-align: right;">2020313</td>
<td style="text-align: right;">2020</td>
<td style="text-align: left;">07/01/2021</td>
<td style="text-align: left;">Berlin</td>
<td style="text-align: left;">216 WATCH HILL RD</td>
<td style="text-align: right;">412000</td>
<td style="text-align: right;">677500</td>
<td style="text-align: right;">0.6081</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: left;">Single Family</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Hartford</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="data-preprocessing" class="level1">
<h1>Data Preprocessing</h1>
<section id="define-the-metric-of-proximity-to-nyc-using-grand-central-as-anchor-point" class="level2">
<h2 class="anchored" data-anchor-id="define-the-metric-of-proximity-to-nyc-using-grand-central-as-anchor-point">Define the metric of proximity to NYC: using Grand Central as anchor point</h2>
<p>In this section, we first define the metric of proximity to NYC using Grand Central Station as the anchor point. Then, we calculate the distance from each property in <code>ct_sales</code> to it.</p>
<p>To calculate the distance, we address the following issues:</p>
<ol type="1">
<li>Properties with missing geographic coordinates:</li>
</ol>
<ul>
<li>Use matching <code>street_name</code> and <code>town</code> to impute the missing values</li>
<li>For the remaining cases, impute coordinates using town-level geometry data</li>
</ul>
<ol start="2" type="1">
<li>Properties with incorrect geographic coordinates:</li>
</ol>
<ul>
<li>Identify them using functions from the <code>sf</code> library</li>
<li>Correct them with town-level geometry</li>
</ul>
</section>
<section id="verify-mappings-between-property-addresses-and-their-geographic-coordinates" class="level2">
<h2 class="anchored" data-anchor-id="verify-mappings-between-property-addresses-and-their-geographic-coordinates">Verify Mappings Between Property Addresses and Their Geographic Coordinates</h2>
<p>To perform the verification, we first decompose the town-level geometries into points and compute the distance range from Grand Central Terminal. This serves as a benchmark to assess whether the mapping of geographic coordinates and addresses is accurate.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mutate a column `street_name` column for `location` imputation</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(address, <span class="st">"^</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">s+"</span>),    </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(street_name, <span class="st">"#.*$"</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(street_name, <span class="st">"(?&lt;!ROUTE</span><span class="sc">\\</span><span class="st">s)[A-Z]</span><span class="sc">\\</span><span class="st">d+$"</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(street_name, <span class="st">" UNIT.*"</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+$"</span>)) <span class="sc">&amp;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                   (<span class="sc">!</span><span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">bROUTE</span><span class="sc">\\</span><span class="st">b"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))) <span class="sc">~</span> <span class="fu">str_replace</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        street_name, <span class="st">"(RD|ROAD|DRIVE|DR|AV|AVE|AVENUE|ST|STREET|LANE|LN|LA|CIR|CT|COURT|TE).*"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> street_name</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+$"</span>)) <span class="sc">~</span> <span class="fu">str_remove</span>(street_name, <span class="st">"</span><span class="sc">\\</span><span class="st">s*U(N)?</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+$"</span>),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> street_name</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"^[A-Za-z]"</span>)) <span class="sc">~</span> street_name,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(<span class="fu">str_extract</span>(street_name, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s)[A-Za-z].*"</span>)) <span class="sc">~</span> street_name,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">str_extract</span>(street_name, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s)[A-Za-z].*"</span>) </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ct_sales_sf <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(location) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span>         </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">location =</span> <span class="fu">st_as_sfc</span>(location, <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))) <span class="sc">|&gt;</span>     </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()  </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Grand Central Terminal sf object</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>grand_central <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">73.977229</span>, <span class="fl">40.752726</span>)), </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_sales_sf)) <span class="sc">|&gt;</span> <span class="fu">st_sf</span>()</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>grand_central <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(grand_central, <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_sales_sf)) </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The mappings to be verified</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>to_verify <span class="ot">&lt;-</span> ct_sales_sf <span class="sc">|&gt;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_dist_to_nyc =</span> </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(location, grand_central)<span class="sc">/</span><span class="dv">1000</span>), <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(location)[, <span class="dv">1</span>],</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(location)[, <span class="dv">2</span>]</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ref_id, address, street_name, town, lon, lat, point_dist_to_nyc)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(to_verify) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="define-a-function-to-compute-the-distance-range-for-each-town-from-grand-central-terminal" class="level3">
<h3 class="anchored" data-anchor-id="define-a-function-to-compute-the-distance-range-for-each-town-from-grand-central-terminal">Define a function to compute the distance range for each town from Grand Central Terminal</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to compute the distances from each point in the town </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># geometry and determine the range</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>compute_town_dist_range <span class="ot">&lt;-</span> <span class="cf">function</span>(town_name){</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  vertices <span class="ot">&lt;-</span> towns_sf <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(NAME <span class="sc">==</span> town_name) <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute distances in kilometers</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  distances <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(vertices, grand_central))<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">town =</span> town_name,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_dist_km =</span> <span class="fu">round</span>(<span class="fu">min</span>(distances), <span class="dv">2</span>),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_dist_km =</span> <span class="fu">round</span>(<span class="fu">max</span>(distances), <span class="dv">2</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>towns_sf <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">!=</span> <span class="st">"County subdivisions not defined"</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>town_list <span class="ot">&lt;-</span> towns_sf <span class="sc">|&gt;</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the distance range for each town from the anchor point: Grand Central Terminal </span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>town_distance_range <span class="ot">&lt;-</span> town_list <span class="sc">|&gt;</span> <span class="fu">map</span>(compute_town_dist_range) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>town_distance_range <span class="ot">&lt;-</span> town_distance_range <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="st">"TOWN"</span> <span class="ot">=</span> town)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify </span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>mappings_verified <span class="ot">&lt;-</span> to_verify <span class="sc">|&gt;</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(town_distance_range, <span class="at">by =</span> <span class="st">"town"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">between</span>(point_dist_to_nyc, min_dist_km, max_dist_km)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="imputation-of-missing-values-location" class="level2">
<h2 class="anchored" data-anchor-id="imputation-of-missing-values-location">Imputation of Missing Values: <code>location</code></h2>
<p>Impute missing values of <code>location</code> based on verified correct mappings from the same street and town.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a unique street identifier by combining street_name and town</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">street_name1 =</span> <span class="fu">paste</span>(street_name, town))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a reference for `location` imputation using the verified mappings </span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># between `address` and `location`</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>loc_imp_ref <span class="ot">&lt;-</span> mappings_verified <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(is_valid_location <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name1 =</span> <span class="fu">paste</span>(street_name, town)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ref_id, street_name1, lon, lat) <span class="sc">|&gt;</span>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(street_name1, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Begin by imputing `location` values using verified coordinates matched by </span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># `street_name` and `town`</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>ct_sales_imputed <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(location) <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(loc_imp_ref, <span class="at">by =</span> <span class="st">"street_name1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref_id =</span> ref_id.x</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ref_id.y)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Add additional notes regarding the `location` values </span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>ct_sales_imputed <span class="ot">&lt;-</span> ct_sales_imputed <span class="sc">|&gt;</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span> <span class="fu">is.na</span>(lon) <span class="sc">&amp;</span> <span class="sc">!</span> <span class="fu">is.na</span>(lat)  <span class="sc">~</span> <span class="st">"value imputed based on matching street name and town"</span>,</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"to fill with town-level geometry"</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co"># This subset of the data contains records whose location values were </span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co"># verified in the previous step</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>ct_sales_verified <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> </span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(location) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(location, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">().*?(?=</span><span class="sc">\\</span><span class="st">s)"</span>)),</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(location, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s)-?</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">))"</span>))</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mappings_verified <span class="sc">|&gt;</span> </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(ref_id, is_valid_location),</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"ref_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">as.character</span>(is_valid_location)</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine `ct_sales_imputed` and `ct_sales_verified`</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ct_sales_verified, ct_sales_imputed) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(ref_id)</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Last, for properties with incorrect mapping and no matching street name and town, impute the `location` values using the town centroid</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>town_centroid <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">!=</span> <span class="st">"County subdivisions not defined"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">center =</span> <span class="fu">st_centroid</span>(geometry), </span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">centroid_lon =</span> <span class="fu">st_coordinates</span>(center)[, <span class="dv">1</span>],</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">centroid_lat =</span> <span class="fu">st_coordinates</span>(center)[, <span class="dv">2</span>]</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, centroid_lon, centroid_lat) <span class="sc">|&gt;</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME)</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(town_centroid, <span class="at">by =</span> <span class="st">"town"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FALSE"</span>, <span class="st">"to fill with town-level geometry"</span>) </span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> centroid_lon,</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> lon</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FALSE"</span>, <span class="st">"to fill with town-level geometry"</span>) </span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> centroid_lat,</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> lat</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">==</span> <span class="st">"FALSE"</span> <span class="sc">~</span> <span class="st">"corrected using the town centroid geometry"</span>,</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">==</span> <span class="st">"to fill with town-level geometry"</span> </span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="st">"value imputed using the town centroid geometry"</span>,</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> is_valid_location</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>centroid_lon, <span class="sc">-</span>centroid_lat) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="handle-missing-values-property_type" class="level2">
<h2 class="anchored" data-anchor-id="handle-missing-values-property_type">Handle Missing Values: <code>property_type</code></h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">address1 =</span> <span class="fu">paste</span>(address, town))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Properties with missing property type </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>property_w_type <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Find common properties in both categories </span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>common_properties <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(address1) <span class="sc">|&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(address1) <span class="sc">|&gt;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(property_w_type <span class="sc">|&gt;</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>               <span class="fu">select</span>(address1, property_type, residential_type), </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="st">"address1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(address1, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in `property_type` by performing left joining  with `common_properties`</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(common_properties, <span class="at">by =</span> <span class="st">"address1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type.x =</span> property_type.y,</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type.x =</span> residential_type.y</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>property_type.y, <span class="sc">-</span> residential_type.y) <span class="sc">|&gt;</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type =</span> property_type.x,</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type =</span> residential_type.x</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine updated properties with the existing `property_w_type` data frame</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>property_w_type <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  property_missing_type <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">&gt;</span> <span class="dv">0</span>),    </span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  property_w_type</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co"># New subset of properties without `property_type`</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(property_type))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="fill-missing-values-using-ct-state-parcel-records" class="level3">
<h3 class="anchored" data-anchor-id="fill-missing-values-using-ct-state-parcel-records">Fill Missing Values: Using <a href="https://geodata.ct.gov/datasets/ctmaps::connecticut-cama-and-parcel-layer/explore">CT State Parcel Records</a></h3>
<p>Obtain property type information from the Connecticut parcel data: <code>state_use</code> and <code>state_use_description</code> provide the details about the property type and residential type.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parcel data of Connecticut</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>state_parcel_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/Downloads/Connecticut_CAMA_and_Parcel_Layer_3895368049124948111.csv"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Format `state_parcel` column names</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(state_parcel_data) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"_"</span>, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">colnames</span>(state_parcel_data)))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Connecticut land use code and description</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>land_use_codes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/Downloads/Connecticut Land Use Codes.csv"</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(land_use_codes) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(land_use_codes))</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Find code prefix for easy property type mapping</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>land_use_codes <span class="ot">&lt;-</span> land_use_codes <span class="sc">|&gt;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">code_prefix =</span> <span class="fu">substr</span>(code, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Vacant land use code </span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>vacant_land_codes <span class="ot">&lt;-</span> land_use_codes <span class="sc">|&gt;</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"vac"</span>, description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(code) <span class="sc">|&gt;</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Map land use codes to property types</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>land_use_codes <span class="ot">&lt;-</span> land_use_codes <span class="sc">|&gt;</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>      description <span class="sc">==</span> <span class="st">"null"</span> <span class="sc">~</span> <span class="st">"Unknown"</span>,</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>      description <span class="sc">==</span> <span class="st">"Apartment Land"</span> <span class="sc">~</span> <span class="st">"Apartment Land"</span>,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>      code <span class="sc">%in%</span> vacant_land_codes <span class="sc">~</span> <span class="st">"Vacant Land"</span>,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&gt;=</span> <span class="dv">100</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"Residential"</span>,</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"Commercial"</span>,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">~</span> <span class="st">"Industrial"</span>,</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&gt;=</span> <span class="dv">400</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"Public Utility"</span>,</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&gt;=</span> <span class="dv">600</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&lt;</span> <span class="dv">800</span> <span class="sc">~</span> <span class="st">"Agricultural"</span>,</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&gt;=</span> <span class="dv">800</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&lt;</span> <span class="dv">900</span> <span class="sc">~</span> <span class="st">"Apartments"</span>,</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>      property_type <span class="sc">==</span> <span class="st">"Residential"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"res"</span>, description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Residential"</span>,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>      property_type <span class="sc">==</span> <span class="st">"Residential"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"condo"</span>, description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Condominium"</span>,</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>      property_type <span class="sc">==</span> <span class="st">"Residential"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"sfr"</span>, description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Single Family"</span>,</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>      property_type <span class="sc">==</span> <span class="st">"Residential"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"2 fam"</span>, description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Two Family"</span>,</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>      property_type <span class="sc">==</span> <span class="st">"Residential"</span> <span class="sc">~</span> description,</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select distinct land use description for joining </span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>land_use_codes <span class="ot">&lt;-</span> land_use_codes <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(description, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the properties in `state_parcel` with land use description column </span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>property_type_ref <span class="ot">&lt;-</span> state_parcel_data <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(location) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">location_w_town =</span> <span class="fu">paste</span>(location, town_name)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    location_w_town,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    state_use_description</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(location_w_town, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join with `land_use_codes` to obtain property type and residential type info</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>property_type_ref <span class="ot">&lt;-</span> property_type_ref <span class="sc">|&gt;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    land_use_codes,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state_use_description"</span> <span class="ot">=</span> <span class="st">"description"</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    location_w_town,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    property_type,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    residential_type</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(location_w_town, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in the `property_type` and `residential_type` </span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(property_type_ref, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"address1"</span> <span class="ot">=</span> <span class="st">"location_w_town"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type.x =</span> property_type.y,</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type.x =</span> residential_type.y</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type =</span> property_type.x,</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type =</span> residential_type.x</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">".y"</span>))</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>property_w_type <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(property_missing_type <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span> <span class="fu">is.na</span>(property_type)), </span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>                             property_w_type)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(property_type))</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(property_w_type, property_missing_type) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(ref_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>
<section id="exploratory-data-analysis" class="level1">
<h1>Exploratory Data Analysis</h1>
<section id="what-is-the-total-number-of-real-estate-transactions-and-the-corresponding-aggregate-sale-volume-by-county" class="level2">
<h2 class="anchored" data-anchor-id="what-is-the-total-number-of-real-estate-transactions-and-the-corresponding-aggregate-sale-volume-by-county">1. What is the total number of real estate transactions and the corresponding aggregate sale volume by county?</h2>
<p>Fairfield County leads Connecticut in real estate activity, recording over 211,845 transactions and a total sales volume of $153 billion—nearly triple that of any other county. Hartford and New Haven follow with significant volumes of $58 billion and $53 billion, respectively, while the remaining counties contribute more modestly to the state’s overall market.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the total number of recorded properties by county </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>n_by_county <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">total_billion =</span> <span class="fu">round</span>(<span class="fu">sum</span>(sale_amount)<span class="sc">/</span><span class="fl">1e9</span>, <span class="dv">0</span>)) </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>n_by_county <span class="sc">|&gt;</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">comma</span>(n),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_billion =</span> <span class="fu">dollar</span>(total_billion, <span class="at">suffix =</span> <span class="st">"B"</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"County"</span>, <span class="st">"Transactions"</span>, <span class="st">"Total Volume (Billion)"</span>),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"&lt;b&gt;&lt;span style='color:black'&gt;Table 1: Real Estate Transactions and Volume by County (2001–2022)&lt;/span&gt;&lt;/b&gt;"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption><strong><span style="color:black">Table 1: Real Estate Transactions and Volume by County (2001–2022)</span></strong></caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">County</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Transactions</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Total Volume (Billion)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Fairfield</td>
<td style="text-align: left;">211,845</td>
<td style="text-align: left;">$153B</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hartford</td>
<td style="text-align: left;">193,427</td>
<td style="text-align: left;">$58B</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Litchfield</td>
<td style="text-align: left;">46,487</td>
<td style="text-align: left;">$15B</td>
</tr>
<tr class="even">
<td style="text-align: left;">Middlesex</td>
<td style="text-align: left;">41,392</td>
<td style="text-align: left;">$13B</td>
</tr>
<tr class="odd">
<td style="text-align: left;">New Haven</td>
<td style="text-align: left;">175,862</td>
<td style="text-align: left;">$53B</td>
</tr>
<tr class="even">
<td style="text-align: left;">New London</td>
<td style="text-align: left;">59,965</td>
<td style="text-align: left;">$17B</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tolland</td>
<td style="text-align: left;">29,732</td>
<td style="text-align: left;">$8B</td>
</tr>
<tr class="even">
<td style="text-align: left;">Windham</td>
<td style="text-align: left;">24,390</td>
<td style="text-align: left;">$5B</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="how-many-repeated-sales-are-there-in-each-county" class="level2">
<h2 class="anchored" data-anchor-id="how-many-repeated-sales-are-there-in-each-county">2. How many repeated sales are there in each county?</h2>
<p>Hartford County recorded the highest number of repeated sales with 30,721 transactions, followed closely by Fairfield County with 27,548. New Haven County also demonstrated strong market activity, with 27,213 repeated transactions during the period.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find repeated sales </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># repeated_sales &lt;- ct_sales_cleaned |&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(address1, list_year) |&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(address1) |&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(n() &gt; 1) |&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     town = first(town),</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     county = first(county),</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     property_type = first(property_type),</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     earliest_sale = first(sale_amount),</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     latest_sale = last(sale_amount),</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     chg_in_value = latest_sale - earliest_sale,</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     .groups = "drop"</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(repeated_sales, "repeated_sales.csv", row.names = FALSE)</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the saved data into R</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>repeated_sales <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"repeated_sales.csv"</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of repeated sales for each county </span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>n_repeated_sales_by_county <span class="ot">&lt;-</span> repeated_sales <span class="sc">|&gt;</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(n_repeated_sales_by_county, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(county, <span class="sc">-</span>total), <span class="at">y =</span> total)) <span class="sc">+</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">comma</span>(total)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Number of Repeated Sales by County"</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"County"</span>,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Repeated Sales"</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),        <span class="co"># Bold title</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()   </span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="how-much-have-average-single-family-home-values-changed-in-each-county" class="level2">
<h2 class="anchored" data-anchor-id="how-much-have-average-single-family-home-values-changed-in-each-county">3. How much have average single-family home values changed in each county?</h2>
<p>Rapid home price appreciation typically indicates a strong and robust market. Fairfield County stands out with the highest average increase in single-family home values, rising by approximately $169,000 between 2001 and 2022. This growth is more than double the appreciation seen in Middlesex and Litchfield counties, and over three times greater than in Hartford County. The substantial increase underscores Fairfield’s market strength. It also reinforces the pattern of declining price growth and increasing distance from New York City.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the mean change in value for each county </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>avg_value_by_county <span class="ot">&lt;-</span> repeated_sales <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Single Family"</span>, <span class="st">"Residential"</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg =</span> <span class="fu">mean</span>(chg_in_value)) <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg)) </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(avg_value_by_county, <span class="fu">aes</span>(<span class="at">x =</span> avg, <span class="at">y =</span> <span class="fu">reorder</span>(county, avg))) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2a9d8f"</span>) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">dollar</span>(avg)), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>(), </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))) <span class="sc">+</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Property Value Appreciation"</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Single-Family Homes with Repeated Sales (by County)"</span>,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Average Appreciation ($)"</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"County"</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()   </span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="which-months-or-quarters-see-the-most-activity" class="level2">
<h2 class="anchored" data-anchor-id="which-months-or-quarters-see-the-most-activity">4. Which months or quarters see the most activity?</h2>
<p>An analysis of monthly real estate transactions in Connecticut reveals clear seasonal trends in sales volume. Transaction activity is lowest during the winter months, with January (47,181) and February (40,234) recording the fewest sales. As the market enters the spring and summer months, sales volume increases significantly, peaking in June with 84,100 transactions. July (82,882) and August (82,399) follow closely behind, highlighting a strong summer market.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the number of transactions by month </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>monthly_sales <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(date_recorded, <span class="at">format =</span> <span class="st">"%m/%d/%Y"</span>), <span class="st">"%m"</span>))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert month to factor with labels </span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>monthly_sales <span class="ot">&lt;-</span> monthly_sales <span class="sc">|&gt;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">factor</span>(month, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">labels =</span> month.name)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_sales, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> total)) <span class="sc">+</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">comma</span>(total)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Real Estate Transactions in Connecticut"</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Transactions"</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-are-the-hotspots-for-high-value-transactions" class="level2">
<h2 class="anchored" data-anchor-id="what-are-the-hotspots-for-high-value-transactions">5. What are the hotspots for high-value transactions?</h2>
<p>The vast majority of high-value residential property sales (over $5 million) in Connecticut are concentrated in Fairfield County, which accounts for approximately 96.9% of such transactions. All other counties combined represent just 3.1%, highlighting Fairfield’s dominant position as the primary market for luxury real estate in the state.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of single family home sales with over 5 million for each county</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>hotspots <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>), </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>         sale_amount <span class="sc">&gt;</span> <span class="dv">5000000</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(county, <span class="at">name =</span> <span class="st">"count"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">county =</span> <span class="fu">ifelse</span>(percentage <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="st">"Others"</span>, county)) <span class="sc">|&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentage =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(county, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">round</span>(percentage, <span class="dv">1</span>), <span class="st">"%"</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hotspots, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> count, <span class="at">fill =</span> county)) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"High-Value Residential Sales by County"</span>) <span class="sc">+</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Fairfield"</span> <span class="ot">=</span> <span class="st">"#2a9d8f"</span>, <span class="st">"Others"</span> <span class="ot">=</span> <span class="st">"#e9c46a"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="feature-engineering" class="level1">
<h1>Feature Engineering</h1>
<section id="calculate-distance-km-from-grand-central-terminal-for-each-property" class="level2">
<h2 class="anchored" data-anchor-id="calculate-distance-km-from-grand-central-terminal-for-each-property">Calculate Distance (km) from Grand Central Terminal for Each Property</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object to compute the distance to Grand Central </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>ct_sales_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(ct_sales_cleaned, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the distance from each property to Grand Central Terminal</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>ct_sales_sf <span class="ot">&lt;-</span> ct_sales_sf <span class="sc">|&gt;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_dist_to_nyc =</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, grand_central)<span class="sc">/</span><span class="dv">1000</span>), <span class="dv">2</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ct_sales_sf <span class="sc">|&gt;</span> <span class="fu">select</span>(ref_id, point_dist_to_nyc),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"ref_id"</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(town_distance_range, <span class="at">by =</span> <span class="st">"town"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>TOWN)</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co"># After performing feature engineering, select the desired columns for display</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    address, town, sale_amount, property_type, point_dist_to_nyc</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sample, <span class="at">caption =</span> <span class="st">"First 10 Rows of Sample Data"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 10 Rows of Sample Data</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">address</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sale_amount</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">property_type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">point_dist_to_nyc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">618 ROUTE 6</td>
<td style="text-align: left;">Andover</td>
<td style="text-align: right;">232000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">174.43</td>
</tr>
<tr class="even">
<td style="text-align: left;">230 WAKELEE AVE</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: right;">325000</td>
<td style="text-align: left;">Commercial</td>
<td style="text-align: right;">99.59</td>
</tr>
<tr class="odd">
<td style="text-align: left;">390 TURNPIKE RD</td>
<td style="text-align: left;">Ashford</td>
<td style="text-align: right;">430000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">196.35</td>
</tr>
<tr class="even">
<td style="text-align: left;">53 COTSWOLD WAY</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">805000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">148.40</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5 CHESTNUT DRIVE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">179900</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">145.94</td>
</tr>
<tr class="even">
<td style="text-align: left;">111 NORTHINGTON DRIVE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">890000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">147.49</td>
</tr>
<tr class="odd">
<td style="text-align: left;">70 FAR HILLS DRIVE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">1447500</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">151.71</td>
</tr>
<tr class="even">
<td style="text-align: left;">41 EDGEWOOD DRIVE</td>
<td style="text-align: left;">Beacon Falls</td>
<td style="text-align: right;">285000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">108.75</td>
</tr>
<tr class="odd">
<td style="text-align: left;">57 FAR HILLS DRIVE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">1250000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">151.71</td>
</tr>
<tr class="even">
<td style="text-align: left;">216 WATCH HILL RD</td>
<td style="text-align: left;">Berlin</td>
<td style="text-align: right;">677500</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">138.77</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="compute-distance-from-each-property-to-the-nearest-train-station" class="level2">
<h2 class="anchored" data-anchor-id="compute-distance-from-each-property-to-the-nearest-train-station">Compute Distance from Each Property to the Nearest Train Station</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to compute the distances from each train station for each property </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># compute_distance &lt;- function(stop_id_value){</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   stop &lt;- stops_sf |&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(stop_id == stop_id_value)</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Compute distances in kilometers</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   distances &lt;- as.numeric(st_distance(properties, stop))/1000</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   data.frame(</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     dist = distances </span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co"># properties &lt;- ct_sales_sf |&gt; select(ref_id, geometry)</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># stop_list &lt;- stops |&gt;</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(state == "CT") |&gt;</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(stop_id) |&gt;</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull()</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co"># dist_from_train_stops &lt;- stop_list |&gt; map(compute_distance) |&gt; bind_cols()</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(dist_from_train_stops, "dist_from_train_stops.csv", row.names = FALSE)</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>dist_to_train_stops <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"dist_to_train_stops.csv"</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the distance to the nearest Metro-North station for each property</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>min_distance <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_to_train_stops[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(dist_to_train_stops)], <span class="dv">1</span>, min, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>to_join <span class="ot">&lt;-</span> dist_to_train_stops <span class="sc">|&gt;</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist =</span> <span class="fu">round</span>(min_distance, <span class="dv">2</span>)</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>    ref_id, dist</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span> <span class="fu">left_join</span>(to_join, <span class="at">by =</span> <span class="st">"ref_id"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">nearest_rail_station_dist =</span> dist)</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="co"># After performing feature engineering, select the desired columns for display</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a>    address, town, sale_amount, property_type, point_dist_to_nyc, </span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>    nearest_rail_station_dist</span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sample_data, <span class="at">caption =</span> <span class="st">"First 10 Rows of Sample Data"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>First 10 Rows of Sample Data</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">address</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">town</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sale_amount</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">property_type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">point_dist_to_nyc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">nearest_rail_station_dist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">618 ROUTE 6</td>
<td style="text-align: left;">Andover</td>
<td style="text-align: right;">232000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">174.43</td>
<td style="text-align: right;">61.56</td>
</tr>
<tr class="even">
<td style="text-align: left;">230 WAKELEE AVE</td>
<td style="text-align: left;">Ansonia</td>
<td style="text-align: right;">325000</td>
<td style="text-align: left;">Commercial</td>
<td style="text-align: right;">99.59</td>
<td style="text-align: right;">1.10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">390 TURNPIKE RD</td>
<td style="text-align: left;">Ashford</td>
<td style="text-align: right;">430000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">196.35</td>
<td style="text-align: right;">80.40</td>
</tr>
<tr class="even">
<td style="text-align: left;">53 COTSWOLD WAY</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">805000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">148.40</td>
<td style="text-align: right;">30.39</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5 CHESTNUT DRIVE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">179900</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">145.94</td>
<td style="text-align: right;">28.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">111 NORTHINGTON DRIVE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">890000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">147.49</td>
<td style="text-align: right;">30.42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">70 FAR HILLS DRIVE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">1447500</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">151.71</td>
<td style="text-align: right;">33.54</td>
</tr>
<tr class="even">
<td style="text-align: left;">41 EDGEWOOD DRIVE</td>
<td style="text-align: left;">Beacon Falls</td>
<td style="text-align: right;">285000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">108.75</td>
<td style="text-align: right;">0.91</td>
</tr>
<tr class="odd">
<td style="text-align: left;">57 FAR HILLS DRIVE</td>
<td style="text-align: left;">Avon</td>
<td style="text-align: right;">1250000</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">151.71</td>
<td style="text-align: right;">33.54</td>
</tr>
<tr class="even">
<td style="text-align: left;">216 WATCH HILL RD</td>
<td style="text-align: left;">Berlin</td>
<td style="text-align: right;">677500</td>
<td style="text-align: left;">Residential</td>
<td style="text-align: right;">138.77</td>
<td style="text-align: right;">24.15</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="what-percentage-of-properties-in-fairfield-and-new-haven-counties-are-located-within-3-km-of-the-nearest-metro-north-station" class="level2">
<h2 class="anchored" data-anchor-id="what-percentage-of-properties-in-fairfield-and-new-haven-counties-are-located-within-3-km-of-the-nearest-metro-north-station">6. What percentage of properties in Fairfield and New Haven Counties are located within 3 km of the nearest Metro-North station?</h2>
<p>In Fairfield County, approximately 59% of all recorded property transactions (125,669 out of 211,845) are situated within this 3 km radius. This suggests that access to reliable commuter rail service may be a key driver of real estate activity in the region, particularly given Fairfield’s direct rail connectivity to New York City.</p>
<p>In contrast, New Haven County shows a different spatial pattern, with only 30% of its transactions (52,958 out of 175,862) occurring within the same proximity threshold.</p>
<p>Litchfield County has limited, indirect access to Metro-North service through a small number of peripheral stations, but the impact is far more subtle. Other counties in the state lack direct Metro-North connectivity altogether, which may contribute to differences in real estate volume and spatial distribution.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fairfield_new_haven <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nearest_rail_station_dist <span class="sc">&lt;</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(county <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Fairfield"</span>, <span class="st">"New Haven"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentage =</span> <span class="fu">round</span>(n<span class="sc">/</span>total, <span class="dv">2</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot long </span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>fairfield_new_haven <span class="ot">&lt;-</span> fairfield_new_haven <span class="sc">|&gt;</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">beyond =</span> total <span class="sc">-</span> n) <span class="sc">|&gt;</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, <span class="at">within =</span> n, beyond) <span class="sc">|&gt;</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(within, beyond), <span class="at">names_to =</span> <span class="st">"category"</span>, </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">ifelse</span>(category <span class="sc">==</span> <span class="st">"within"</span>, <span class="st">"Within 3 km"</span>, <span class="st">"Beyond 3 km"</span>))</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Fairfield</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>fairfield_pie <span class="ot">&lt;-</span> fairfield_new_haven <span class="sc">|&gt;</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(county <span class="sc">==</span> <span class="st">"Fairfield"</span>)</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Fairfield pie </span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>fairfield_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fairfield_pie, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> value, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">percent</span>(value <span class="sc">/</span> <span class="fu">sum</span>(value))),</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Fairfield County"</span>) <span class="sc">+</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Within 3 km"</span> <span class="ot">=</span> <span class="st">"#2a9d8f"</span>, <span class="st">"Beyond 3 km"</span> <span class="ot">=</span> <span class="st">"#e9c46a"</span>))</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="co"># New Haven</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>newhaven_pie <span class="ot">&lt;-</span> fairfield_new_haven <span class="sc">|&gt;</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(county <span class="sc">==</span> <span class="st">"New Haven"</span>)</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot New Haven Pie</span></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>new_haven_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(newhaven_pie, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> value, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">percent</span>(value <span class="sc">/</span> <span class="fu">sum</span>(value))),</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"New Haven County"</span>) <span class="sc">+</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Within 3 km"</span> <span class="ot">=</span> <span class="st">"#4682B4"</span>, <span class="st">"Beyond 3 km"</span> <span class="ot">=</span> <span class="st">"#e9c46a"</span>))</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>(fairfield_plot <span class="sc">+</span> new_haven_plot) <span class="sc">+</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Proximity to Metro-North Station (Within 3 km)"</span>) <span class="sc">&amp;</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="how-does-proximity-to-the-nearest-train-station-correlate-with-home-values-in-fairfield-county" class="level2">
<h2 class="anchored" data-anchor-id="how-does-proximity-to-the-nearest-train-station-correlate-with-home-values-in-fairfield-county">7. How does proximity to the nearest train station correlate with home values in Fairfield County?</h2>
<p>The correlation between distance to the nearest Metro-North station and property sale price in Fairfield County is approximately -0.14, indicating a weak negative relationship. This suggests that, on average, properties located closer to train stations tend to have slightly higher sale prices, though the effect is modest.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fairfield <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residentital"</span>, <span class="st">"Single Family"</span>), </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>         county <span class="sc">==</span> <span class="st">"Fairfield"</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sale_amount, nearest_rail_station_dist)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fairfield, <span class="fu">aes</span>(<span class="at">x =</span> nearest_rail_station_dist, <span class="at">y =</span> sale_amount)) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distance to Nearest Train Station and Home Price in Fairfield County"</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Distance to Nearest Train Station (km or miles)"</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Sale Amount (USD)"</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(fairfield<span class="sc">$</span>nearest_rail_station_dist, fairfield<span class="sc">$</span>sale_amount)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.1420982</code></pre>
</div>
</div>
</section>
<section id="how-do-average-property-values-differ-by-property-type-between-new-haven-and-hartford-towns" class="level2">
<h2 class="anchored" data-anchor-id="how-do-average-property-values-differ-by-property-type-between-new-haven-and-hartford-towns">8. How do average property values differ by property type between New Haven and Hartford towns?</h2>
<p>Across multiple residential types, New Haven town consistently commands higher prices than Hartford: on average, single-family homes are 41.63% more expensive, three-family homes are 32.81% higher, and two-family homes command a 17.63% premium. These patterns suggest that access to commuter rail significantly influences real estate demand and pricing power.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the average property value differences across property types between </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the towns: New Haven and Hartford</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>new_haven_hartford_wide <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hartford"</span>, <span class="st">"New Haven"</span>), </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>         property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>, <span class="st">"Two Family"</span>, </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Three Family"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town, property_type) <span class="sc">|&gt;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg =</span> <span class="fu">mean</span>(sale_amount)) <span class="sc">|&gt;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> town,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> avg</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">price_pct_diff =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">round</span>((<span class="st">`</span><span class="at">New Haven</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Hartford</span><span class="st">`</span>)<span class="sc">/</span>(<span class="st">`</span><span class="at">Hartford</span><span class="st">`</span>), <span class="dv">4</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot long </span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>new_haven_hartford_long <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hartford"</span>, <span class="st">"New Haven"</span>), </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>         property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>, <span class="st">"Two Family"</span>, </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Three Family"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town, property_type) <span class="sc">|&gt;</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg =</span> <span class="fu">mean</span>(sale_amount)) <span class="sc">|&gt;</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_haven_hartford_long, <span class="fu">aes</span>(<span class="at">x =</span> property_type, <span class="at">y =</span> avg, <span class="at">fill =</span> town)) <span class="sc">+</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>), <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">dollar</span>(avg)),</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>),</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.4</span>,</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">3.5</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Hartford"</span> <span class="ot">=</span> <span class="st">"#c81d25"</span>, <span class="st">"New Haven"</span> <span class="ot">=</span> <span class="st">"#4895ef"</span>)) <span class="sc">+</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Property Prices: New Haven vs. Hartford"</span>,</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Property Type"</span>,</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Price (USD)"</span>,</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Town"</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="which-ten-towns-in-connecticut-have-the-highest-number-of-bus-stops" class="level2">
<h2 class="anchored" data-anchor-id="which-ten-towns-in-connecticut-have-the-highest-number-of-bus-stops">9. Which ten towns in Connecticut have the highest number of bus stops?”</h2>
<p>Based on the distribution of bus stops across Connecticut towns, we observe that Hartford, New Haven, and Waterbury lead in public transit infrastructure, each with more than 750 bus stops.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CT bus stops data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">"~/Downloads/googlect_transit/stops.txt"</span>, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    stop_id, stop_code, stop_name, stop_lat, stop_lon   <span class="co"># Select relevant columns</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Connecticut towns' geometry </span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>ct_towns_geom <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span> <span class="fu">select</span>(STATEFP, NAME)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a sf object based on the bus stop coordinate </span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>bus_stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(bus_stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain the town name for each bus stop using `st_join` </span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">st_join</span>(bus_stops_sf, ct_ny_towns_geom, <span class="at">join =</span> st_within) <span class="sc">|&gt;</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME) <span class="sc">|&gt;</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"09"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"36"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>STATEFP)</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of bus stops in each town</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>top10_town <span class="ot">&lt;-</span> bus_stops <span class="sc">|&gt;</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"CT"</span>) <span class="sc">|&gt;</span>        </span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town) <span class="sc">|&gt;</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_stops =</span> <span class="fu">n_distinct</span>(stop_id)) <span class="sc">|&gt;</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_stops)) <span class="sc">|&gt;</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(n_stops, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top10_town, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(town, n_stops), <span class="at">y =</span> n_stops)) <span class="sc">+</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2a9d8f"</span>) <span class="sc">+</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_stops), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 10 Connecticut Towns by Number of Bus Stops"</span>,</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Town"</span>,</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Bus Stops"</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-are-the-top-five-towns-with-the-most-connectivity-to-other-towns" class="level2">
<h2 class="anchored" data-anchor-id="what-are-the-top-five-towns-with-the-most-connectivity-to-other-towns">10. What are the top five towns with the most connectivity to other towns?</h2>
<p>Hartford stands out as the most connected town in Connecticut’s bus network, with direct connections to 62 other towns. This high level of connectivity underscores Hartford’s role as a central transportation hub in the region.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of trips that go between town pairs</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>town_edges <span class="ot">&lt;-</span> bus_trip_stop_data <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(trip_id) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">origin_town =</span> town[<span class="fu">which.min</span>(stop_sequence)],</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dest_town =</span> town[<span class="fu">which.max</span>(stop_sequence)],</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(origin_town <span class="sc">!=</span> dest_town) <span class="sc">|&gt;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(origin_town, dest_town, <span class="at">name =</span> <span class="st">"weight"</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>town_graph <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(town_edges, <span class="at">directed =</span> <span class="cn">FALSE</span>) </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of towns a town connects to </span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>town_connectivity <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">town =</span> <span class="fu">V</span>(town_graph)<span class="sc">$</span>name,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">degree =</span> <span class="fu">degree</span>(town_graph)</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(degree)) <span class="sc">|&gt;</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(town, degree) <span class="sc">|&gt;</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">n_connected_towns =</span> degree)</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(town_connectivity) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the first top five towns with the highest connectivity to other towns </span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>top5_towns <span class="ot">&lt;-</span> town_connectivity <span class="sc">|&gt;</span> <span class="fu">slice_max</span>(n_connected_towns, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top5_towns, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(town, <span class="sc">-</span>n_connected_towns), </span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> n_connected_towns)) <span class="sc">+</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#bb9457"</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_connected_towns), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top Towns by Connectivity to Other Towns"</span>,</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Town"</span>,</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Connected Towns"</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-performance" class="level1">
<h1>Model Performance</h1>
<ul>
<li>The three predictors together explain 35% variation in real estate pricing in Connecticut.</li>
<li>Due to missing values in the property type variable, 208,649 observations were omitted in the model fitting process. This represents a limitation that should be addressed in future work.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Center the predictor `nearest_rail_station_dist` as it is highly correlated </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with `point_dist_to_nyc`</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">centered_nearest_rail_station_dist =</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(nearest_rail_station_dist <span class="sc">-</span> <span class="fu">mean</span>(nearest_rail_station_dist), <span class="dv">2</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply a log transformation to predicting variable: `sale_amount` and fit a </span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># linear regression model using three predictors</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(sale_amount) <span class="sc">~</span> point_dist_to_nyc <span class="sc">+</span> </span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>              centered_nearest_rail_station_dist <span class="sc">+</span> </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>              property_type,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> ct_sales_cleaned)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(sale_amount) ~ point_dist_to_nyc + centered_nearest_rail_station_dist + 
    property_type, data = ct_sales_cleaned)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.0539 -0.3371 -0.0100  0.3340  5.8768 

Coefficients:
                                     Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept)                         1.404e+01  6.723e-02  208.777  &lt; 2e-16 ***
point_dist_to_nyc                  -1.851e-02  4.431e-05 -417.849  &lt; 2e-16 ***
centered_nearest_rail_station_dist  1.847e-02  6.956e-05  265.528  &lt; 2e-16 ***
property_typeApartments             1.853e+00  6.903e-02   26.847  &lt; 2e-16 ***
property_typeCommercial             1.532e+00  6.763e-02   22.658  &lt; 2e-16 ***
property_typeCondo                  3.531e-01  6.705e-02    5.267 1.39e-07 ***
property_typeFour Family            7.915e-01  6.909e-02   11.455  &lt; 2e-16 ***
property_typeIndustrial             1.917e+00  7.098e-02   27.011  &lt; 2e-16 ***
property_typeOther                  3.683e-01  9.310e-02    3.956 7.64e-05 ***
property_typePublic Utility         4.536e-01  3.524e-01    1.287    0.198    
property_typeResidential            9.153e-01  6.703e-02   13.655  &lt; 2e-16 ***
property_typeSingle Family          9.135e-01  6.702e-02   13.630  &lt; 2e-16 ***
property_typeThree Family           6.576e-01  6.741e-02    9.755  &lt; 2e-16 ***
property_typeTwo Family             5.869e-01  6.719e-02    8.735  &lt; 2e-16 ***
property_typeVacant Land           -9.478e-02  6.768e-02   -1.400    0.161    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5993 on 574436 degrees of freedom
  (208649 observations deleted due to missingness)
Multiple R-squared:  0.3552,    Adjusted R-squared:  0.3552 
F-statistic: 2.26e+04 on 14 and 574436 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="future-work" class="level1">
<h1>Future Work</h1>
<ul>
<li><p>There are several challenges and limitations we aim to address in future work. First, we plan to obtain accurate property type classifications for properties with missing values. Our initial attempt to impute property type using the nearest neighbor method proved to be unreliable.</p></li>
<li><p>We also intend to explore alternative statistical learning models to train the dataset. Given the large volume of observations in the Connecticut real estate dataset, implementing models such as random forests may require significant computational resources.</p></li>
<li><p>Additionally, we are interested in applying network theory to model the connectivity among towns. This could help us better understand whether certain structural or regional factors contribute to the distribution of real estate pricing in Connecticut.</p></li>
</ul>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Based on our analysis and model performance, we found a moderate relationship between property values in Connecticut and two key factors: proximity to the economic center—New York City—and direct accessibility to rail stations. The impact on home values is more pronounced, with values tending to decrease moderately as the distance from these economic and transportation hubs increases.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/hongzhuang1\.github\.io\/STA9750-2025-SPRING\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb29" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Final Project: How does proximity to NYC impact the real estate pricing in Connecticut?"</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> Hong Zhuang</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true       </span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true        </span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true              </span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf: default</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(warning=FALSE, message=FALSE)</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction and Motivation</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>The spatial distribution of real estate activity across Connecticut reveals a </span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>notable geographic trend: counties located closer to major urban economic centers, </span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>particularly New York City, exhibit stronger market performance. Fairfield County, </span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>situated in the southwestern corner of the state, stands out as the most active </span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>real estate market. According to the dataset, it recorded 211,845 property </span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>transactions between 2001 and 2022—the highest among all counties—spanning </span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>residential, commercial, vacant land, and public utility properties(see Table 1). </span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>This market strength is accompanied by the highest total dollar volume of </span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>transactions, signaling both high demand and high property values.</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>A key differentiation for Fairfield is its geographical proximity to NYC and </span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>accessibility via the Metro-North Railroad, which positions it as a prime </span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>location for commuters seeking suburban living with urban job opportunities. </span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>This suggests that connectivity to economic hubs may play a significant role </span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>in driving property values and transaction volumes.</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>Motivated by this observation, this analysis aims to examine how distance from </span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>New York City correlates with real estate market activity across Connecticut </span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>counties. By quantifying this relationship, we can better understand the extent </span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>to which geographic accessibility influences housing demand and pricing—offering </span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>valuable insights for urban planners, real estate developers/analysts, and policy </span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>makers.</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Acquisitions</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Connecticut Real Estate Sales Dataset</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>The primary data source used in our analysis can be found at: <span class="co">[</span><span class="ot">CT Real Estate Sales</span><span class="co">](https://data.ct.gov/Housing-and-Development/Real-Estate-Sales-2001-2022-GL/5mzw-sjtu/about_data)</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Load relevant packages</span></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) </span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales) </span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)   </span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmaptools)</span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris) </span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the sales dataset into R</span></span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/STA9750/STA9750-2025-SPRING/data/fp01/ct_sales.csv"</span>)</span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Format `ct_sales` column names </span></span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ct_sales) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"_"</span>, <span class="fu">colnames</span>(ct_sales)))</span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a unique ID for each transaction to facilitate easier referencing </span></span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a><span class="co"># and joining with other data sources</span></span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">ref_id =</span> <span class="fu">row_number</span>()</span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a>    ref_id,</span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">everything</span>()</span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the town name for records with "unknown" value</span></span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-91"><a href="#cb29-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">town =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-92"><a href="#cb29-92" aria-hidden="true" tabindex="-1"></a>      town <span class="sc">==</span>   <span class="st">"***Unknown***"</span> <span class="sc">~</span> <span class="st">"East Hampton"</span>,</span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> town</span>
<span id="cb29-94"><a href="#cb29-94" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-95"><a href="#cb29-95" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-96"><a href="#cb29-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-97"><a href="#cb29-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Map each town to its corresponding county </span></span>
<span id="cb29-98"><a href="#cb29-98" aria-hidden="true" tabindex="-1"></a>ct_town_county_codes<span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/STA9750/STA9750-2025-SPRING/ct_town_county_codes.csv"</span>)</span>
<span id="cb29-99"><a href="#cb29-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-100"><a href="#cb29-100" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb29-101"><a href="#cb29-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb29-102"><a href="#cb29-102" aria-hidden="true" tabindex="-1"></a>    ct_town_county_codes <span class="sc">|&gt;</span> <span class="fu">select</span>(town_name, county),</span>
<span id="cb29-103"><a href="#cb29-103" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"town"</span> <span class="ot">=</span> <span class="st">"town_name"</span>)</span>
<span id="cb29-104"><a href="#cb29-104" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-105"><a href="#cb29-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-106"><a href="#cb29-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb29-107"><a href="#cb29-107" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(ct_sales, <span class="dv">10</span>), <span class="at">caption =</span> <span class="st">"First 10 Rows of CT Real Estate Sales"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-108"><a href="#cb29-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb29-109"><a href="#cb29-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-110"><a href="#cb29-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-111"><a href="#cb29-111" aria-hidden="true" tabindex="-1"></a><span class="fu">## Connecticut County and Town Shape files</span></span>
<span id="cb29-112"><a href="#cb29-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-115"><a href="#cb29-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-116"><a href="#cb29-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Read county shape file into R</span></span>
<span id="cb29-117"><a href="#cb29-117" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"~/downloads/tl_2020_us_county/tl_2020_us_county.shp"</span>, </span>
<span id="cb29-118"><a href="#cb29-118" aria-hidden="true" tabindex="-1"></a>                    <span class="at">quiet =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-119"><a href="#cb29-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(STATEFP <span class="sc">==</span> <span class="st">"09"</span>)</span>
<span id="cb29-120"><a href="#cb29-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-121"><a href="#cb29-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Town shape file</span></span>
<span id="cb29-122"><a href="#cb29-122" aria-hidden="true" tabindex="-1"></a>ct_towns <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"~/downloads/tl_2020_09_cousub/tl_2020_09_cousub.shp"</span>, </span>
<span id="cb29-123"><a href="#cb29-123" aria-hidden="true" tabindex="-1"></a>                    <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-124"><a href="#cb29-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-125"><a href="#cb29-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-126"><a href="#cb29-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-127"><a href="#cb29-127" aria-hidden="true" tabindex="-1"></a><span class="fu">## Metro North</span></span>
<span id="cb29-128"><a href="#cb29-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-129"><a href="#cb29-129" aria-hidden="true" tabindex="-1"></a>The Metro North stations can be obtained here: <span class="co">[</span><span class="ot">Metro-North Railroad</span><span class="co">](https://www.mta.info/developers)</span></span>
<span id="cb29-130"><a href="#cb29-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-133"><a href="#cb29-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-134"><a href="#cb29-134" aria-hidden="true" tabindex="-1"></a>stops <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">"~/STA9750/STA9750-2025-SPRING/data/fp01/gtfsmnr/stops.txt"</span>, </span>
<span id="cb29-135"><a href="#cb29-135" aria-hidden="true" tabindex="-1"></a>                    <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb29-136"><a href="#cb29-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-137"><a href="#cb29-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Connecticut towns' geometry </span></span>
<span id="cb29-138"><a href="#cb29-138" aria-hidden="true" tabindex="-1"></a>ct_towns_geom <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span> <span class="fu">select</span>(STATEFP, NAME)</span>
<span id="cb29-139"><a href="#cb29-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-140"><a href="#cb29-140" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb29-141"><a href="#cb29-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-142"><a href="#cb29-142" aria-hidden="true" tabindex="-1"></a><span class="co"># # ny_towns &lt;- county_subdivisions(state = "NY")</span></span>
<span id="cb29-143"><a href="#cb29-143" aria-hidden="true" tabindex="-1"></a><span class="co"># # ny_towns_geom &lt;- ny_towns |&gt; select(STATEFP, NAME)</span></span>
<span id="cb29-144"><a href="#cb29-144" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(ny_towns_geom, "ny_towns_geom.rds")</span></span>
<span id="cb29-145"><a href="#cb29-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-146"><a href="#cb29-146" aria-hidden="true" tabindex="-1"></a>ny_towns_geom <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"ny_towns_geom.rds"</span>)</span>
<span id="cb29-147"><a href="#cb29-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-148"><a href="#cb29-148" aria-hidden="true" tabindex="-1"></a>ct_ny_towns_geom <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ct_towns_geom, ny_towns_geom)</span>
<span id="cb29-149"><a href="#cb29-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-150"><a href="#cb29-150" aria-hidden="true" tabindex="-1"></a>stops <span class="ot">&lt;-</span> stops <span class="sc">|&gt;</span> <span class="fu">select</span>(stop_id, stop_name, stop_lon, stop_lat)</span>
<span id="cb29-151"><a href="#cb29-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-152"><a href="#cb29-152" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object of Metro North stops</span></span>
<span id="cb29-153"><a href="#cb29-153" aria-hidden="true" tabindex="-1"></a>stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb29-154"><a href="#cb29-154" aria-hidden="true" tabindex="-1"></a>                     <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb29-155"><a href="#cb29-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-156"><a href="#cb29-156" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the state and the town for each stop where it is located </span></span>
<span id="cb29-157"><a href="#cb29-157" aria-hidden="true" tabindex="-1"></a>stops <span class="ot">&lt;-</span> <span class="fu">st_join</span>(stops_sf, ct_ny_towns_geom, <span class="at">join =</span> st_within) <span class="sc">|&gt;</span> </span>
<span id="cb29-158"><a href="#cb29-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-159"><a href="#cb29-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb29-160"><a href="#cb29-160" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb29-161"><a href="#cb29-161" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-162"><a href="#cb29-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-163"><a href="#cb29-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME) <span class="sc">|&gt;</span></span>
<span id="cb29-164"><a href="#cb29-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-165"><a href="#cb29-165" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-166"><a href="#cb29-166" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"09"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb29-167"><a href="#cb29-167" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"36"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb29-168"><a href="#cb29-168" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb29-169"><a href="#cb29-169" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-170"><a href="#cb29-170" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-171"><a href="#cb29-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>STATEFP) <span class="sc">|&gt;</span></span>
<span id="cb29-172"><a href="#cb29-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(stops, <span class="at">by =</span> <span class="st">"stop_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-173"><a href="#cb29-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb29-174"><a href="#cb29-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">stop_name =</span> stop_name.x</span>
<span id="cb29-175"><a href="#cb29-175" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-176"><a href="#cb29-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>stop_name.y)</span>
<span id="cb29-177"><a href="#cb29-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-178"><a href="#cb29-178" aria-hidden="true" tabindex="-1"></a>stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb29-179"><a href="#cb29-179" aria-hidden="true" tabindex="-1"></a>                     <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb29-180"><a href="#cb29-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-181"><a href="#cb29-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb29-182"><a href="#cb29-182" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(stops, <span class="dv">10</span>), <span class="at">caption =</span> <span class="st">"First 10 Rows of Metro North Stations"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-183"><a href="#cb29-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb29-184"><a href="#cb29-184" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-185"><a href="#cb29-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-186"><a href="#cb29-186" aria-hidden="true" tabindex="-1"></a><span class="fu">## CT transit Data</span></span>
<span id="cb29-187"><a href="#cb29-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-188"><a href="#cb29-188" aria-hidden="true" tabindex="-1"></a>CT transit data can be found: <span class="co">[</span><span class="ot">CT Bus Data</span><span class="co">](https://www.cttransit.com/about/developers)</span></span>
<span id="cb29-189"><a href="#cb29-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-192"><a href="#cb29-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-193"><a href="#cb29-193" aria-hidden="true" tabindex="-1"></a><span class="co"># bus_stops &lt;- read.delim("~/Downloads/googlect_transit/stops.txt",</span></span>
<span id="cb29-194"><a href="#cb29-194" aria-hidden="true" tabindex="-1"></a><span class="co">#                         header = TRUE, sep = ",", stringsAsFactors = FALSE) |&gt;</span></span>
<span id="cb29-195"><a href="#cb29-195" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(</span></span>
<span id="cb29-196"><a href="#cb29-196" aria-hidden="true" tabindex="-1"></a><span class="co">#     stop_id, stop_code, stop_name, stop_lat, stop_lon  # Select relevant columns</span></span>
<span id="cb29-197"><a href="#cb29-197" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb29-198"><a href="#cb29-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-199"><a href="#cb29-199" aria-hidden="true" tabindex="-1"></a><span class="co"># stop_times &lt;- read.delim("~/Downloads/googlect_transit/stop_times.txt", </span></span>
<span id="cb29-200"><a href="#cb29-200" aria-hidden="true" tabindex="-1"></a><span class="co">#                          header = TRUE, sep = ",", stringsAsFactors = FALSE)</span></span>
<span id="cb29-201"><a href="#cb29-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-202"><a href="#cb29-202" aria-hidden="true" tabindex="-1"></a><span class="co"># trips &lt;- read.delim("~/Downloads/googlect_transit/trips.txt", </span></span>
<span id="cb29-203"><a href="#cb29-203" aria-hidden="true" tabindex="-1"></a><span class="co">#                     header = TRUE, sep = ",", stringsAsFactors = FALSE)</span></span>
<span id="cb29-204"><a href="#cb29-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-205"><a href="#cb29-205" aria-hidden="true" tabindex="-1"></a><span class="co"># # Combine these datasets to obtain trip-level bus data in Connecticut</span></span>
<span id="cb29-206"><a href="#cb29-206" aria-hidden="true" tabindex="-1"></a><span class="co"># bus_trip_stop_data &lt;- stop_times |&gt;</span></span>
<span id="cb29-207"><a href="#cb29-207" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(bus_stops, by = "stop_id") |&gt;</span></span>
<span id="cb29-208"><a href="#cb29-208" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(trips, by = "trip_id") |&gt;</span></span>
<span id="cb29-209"><a href="#cb29-209" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(</span></span>
<span id="cb29-210"><a href="#cb29-210" aria-hidden="true" tabindex="-1"></a><span class="co">#     trip_id,</span></span>
<span id="cb29-211"><a href="#cb29-211" aria-hidden="true" tabindex="-1"></a><span class="co">#     route_id,</span></span>
<span id="cb29-212"><a href="#cb29-212" aria-hidden="true" tabindex="-1"></a><span class="co">#     block_id,</span></span>
<span id="cb29-213"><a href="#cb29-213" aria-hidden="true" tabindex="-1"></a><span class="co">#     shape_id,</span></span>
<span id="cb29-214"><a href="#cb29-214" aria-hidden="true" tabindex="-1"></a><span class="co">#     stop_sequence,</span></span>
<span id="cb29-215"><a href="#cb29-215" aria-hidden="true" tabindex="-1"></a><span class="co">#     stop_id, </span></span>
<span id="cb29-216"><a href="#cb29-216" aria-hidden="true" tabindex="-1"></a><span class="co">#     arrival_time,</span></span>
<span id="cb29-217"><a href="#cb29-217" aria-hidden="true" tabindex="-1"></a><span class="co">#     departure_time,</span></span>
<span id="cb29-218"><a href="#cb29-218" aria-hidden="true" tabindex="-1"></a><span class="co">#     shape_dist_traveled,</span></span>
<span id="cb29-219"><a href="#cb29-219" aria-hidden="true" tabindex="-1"></a><span class="co">#     stop_name,</span></span>
<span id="cb29-220"><a href="#cb29-220" aria-hidden="true" tabindex="-1"></a><span class="co">#     town, </span></span>
<span id="cb29-221"><a href="#cb29-221" aria-hidden="true" tabindex="-1"></a><span class="co">#     lon,</span></span>
<span id="cb29-222"><a href="#cb29-222" aria-hidden="true" tabindex="-1"></a><span class="co">#     lat, </span></span>
<span id="cb29-223"><a href="#cb29-223" aria-hidden="true" tabindex="-1"></a><span class="co">#     state,</span></span>
<span id="cb29-224"><a href="#cb29-224" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb29-225"><a href="#cb29-225" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the combined datasets</span></span>
<span id="cb29-226"><a href="#cb29-226" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(bus_trip_stop_data, "bus_trip_stop_data.csv", row.names = FALSE)</span></span>
<span id="cb29-227"><a href="#cb29-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-228"><a href="#cb29-228" aria-hidden="true" tabindex="-1"></a><span class="co"># Read Trip-level CTtransit data into R using </span></span>
<span id="cb29-229"><a href="#cb29-229" aria-hidden="true" tabindex="-1"></a>bus_trip_stop_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"bus_trip_stop_data.csv"</span>)</span>
<span id="cb29-230"><a href="#cb29-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-231"><a href="#cb29-231" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb29-232"><a href="#cb29-232" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(bus_trip_stop_data, <span class="dv">10</span>), <span class="at">caption =</span> <span class="st">"First 10 Rows of CT Bus Trips"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-233"><a href="#cb29-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb29-234"><a href="#cb29-234" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-235"><a href="#cb29-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-236"><a href="#cb29-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-237"><a href="#cb29-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-238"><a href="#cb29-238" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Cleaning  </span></span>
<span id="cb29-239"><a href="#cb29-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-240"><a href="#cb29-240" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Identify wrong/incorrect/duplicate entries. Use anti_join to remove these records </span>
<span id="cb29-241"><a href="#cb29-241" aria-hidden="true" tabindex="-1"></a>  from our <span class="in">`ct_sales`</span> data.</span>
<span id="cb29-242"><a href="#cb29-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-243"><a href="#cb29-243" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Remove properties whose sale prices are not comparable to similar properties </span>
<span id="cb29-244"><a href="#cb29-244" aria-hidden="true" tabindex="-1"></a>  due to foreclosure, private sale, change in property or other reasons based </span>
<span id="cb29-245"><a href="#cb29-245" aria-hidden="true" tabindex="-1"></a>  on the information provided in <span class="in">`non_use_code`</span> column.</span>
<span id="cb29-246"><a href="#cb29-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-249"><a href="#cb29-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-250"><a href="#cb29-250" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplicates, incorrect property values, etc </span></span>
<span id="cb29-251"><a href="#cb29-251" aria-hidden="true" tabindex="-1"></a>to_remove <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb29-252"><a href="#cb29-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-253"><a href="#cb29-253" aria-hidden="true" tabindex="-1"></a>  <span class="at">concerning =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-254"><a href="#cb29-254" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(opm_remarks, <span class="fu">regex</span>(<span class="st">"duplicate|incorrect|wrong|error|missing"</span>, </span>
<span id="cb29-255"><a href="#cb29-255" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">~</span> <span class="st">"Yes"</span>,</span>
<span id="cb29-256"><a href="#cb29-256" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No"</span>)</span>
<span id="cb29-257"><a href="#cb29-257" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb29-258"><a href="#cb29-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(concerning <span class="sc">==</span> <span class="st">"Yes"</span>)</span>
<span id="cb29-259"><a href="#cb29-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-260"><a href="#cb29-260" aria-hidden="true" tabindex="-1"></a><span class="co"># Use anti_join to remove these incorrect/duplicate from `ct_sales` </span></span>
<span id="cb29-261"><a href="#cb29-261" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb29-262"><a href="#cb29-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(to_remove, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"serial_number"</span>, <span class="st">"address"</span>))</span>
<span id="cb29-263"><a href="#cb29-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-264"><a href="#cb29-264" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove properties with non_use_code </span></span>
<span id="cb29-265"><a href="#cb29-265" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">nchar</span>(non_use_code) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb29-266"><a href="#cb29-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-267"><a href="#cb29-267" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove transactions with `sale_amount` 0 </span></span>
<span id="cb29-268"><a href="#cb29-268" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">filter</span>(sale_amount <span class="sc">&gt;</span> <span class="dv">10000</span>)</span>
<span id="cb29-269"><a href="#cb29-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-270"><a href="#cb29-270" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb29-271"><a href="#cb29-271" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(ct_sales, <span class="dv">10</span>), <span class="at">caption =</span> <span class="st">"First 10 Rows of CT Sales"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-272"><a href="#cb29-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb29-273"><a href="#cb29-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-274"><a href="#cb29-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-275"><a href="#cb29-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-276"><a href="#cb29-276" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Preprocessing </span></span>
<span id="cb29-277"><a href="#cb29-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-278"><a href="#cb29-278" aria-hidden="true" tabindex="-1"></a><span class="fu">## Define the metric of proximity to NYC: using Grand Central as anchor point</span></span>
<span id="cb29-279"><a href="#cb29-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-280"><a href="#cb29-280" aria-hidden="true" tabindex="-1"></a>In this section, we first define the metric of proximity to NYC using </span>
<span id="cb29-281"><a href="#cb29-281" aria-hidden="true" tabindex="-1"></a>Grand Central Station as the anchor point. Then, we calculate the distance from </span>
<span id="cb29-282"><a href="#cb29-282" aria-hidden="true" tabindex="-1"></a>each property in <span class="in">`ct_sales`</span> to it.</span>
<span id="cb29-283"><a href="#cb29-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-284"><a href="#cb29-284" aria-hidden="true" tabindex="-1"></a>To calculate the distance, we address the following issues:</span>
<span id="cb29-285"><a href="#cb29-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-286"><a href="#cb29-286" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Properties with missing geographic coordinates:</span>
<span id="cb29-287"><a href="#cb29-287" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Use matching <span class="in">`street_name`</span> and <span class="in">`town`</span> to impute the missing values </span>
<span id="cb29-288"><a href="#cb29-288" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>For the remaining cases, impute coordinates using town-level geometry data</span>
<span id="cb29-289"><a href="#cb29-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-290"><a href="#cb29-290" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Properties with incorrect geographic coordinates: </span>
<span id="cb29-291"><a href="#cb29-291" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Identify them using functions from the <span class="in">`sf`</span> library</span>
<span id="cb29-292"><a href="#cb29-292" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Correct them with town-level geometry </span>
<span id="cb29-293"><a href="#cb29-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-294"><a href="#cb29-294" aria-hidden="true" tabindex="-1"></a><span class="fu">## Verify Mappings Between Property Addresses and Their Geographic Coordinates </span></span>
<span id="cb29-295"><a href="#cb29-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-296"><a href="#cb29-296" aria-hidden="true" tabindex="-1"></a>To perform the verification, we first decompose the town-level geometries into </span>
<span id="cb29-297"><a href="#cb29-297" aria-hidden="true" tabindex="-1"></a>points and compute the distance range from Grand Central Terminal. This serves </span>
<span id="cb29-298"><a href="#cb29-298" aria-hidden="true" tabindex="-1"></a>as a benchmark to assess whether the mapping of geographic coordinates and </span>
<span id="cb29-299"><a href="#cb29-299" aria-hidden="true" tabindex="-1"></a>addresses is accurate.</span>
<span id="cb29-300"><a href="#cb29-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-303"><a href="#cb29-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-304"><a href="#cb29-304" aria-hidden="true" tabindex="-1"></a><span class="co"># Mutate a column `street_name` column for `location` imputation</span></span>
<span id="cb29-305"><a href="#cb29-305" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb29-306"><a href="#cb29-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-307"><a href="#cb29-307" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(address, <span class="st">"^</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">s+"</span>),    </span>
<span id="cb29-308"><a href="#cb29-308" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(street_name, <span class="st">"#.*$"</span>),</span>
<span id="cb29-309"><a href="#cb29-309" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(street_name, <span class="st">"(?&lt;!ROUTE</span><span class="sc">\\</span><span class="st">s)[A-Z]</span><span class="sc">\\</span><span class="st">d+$"</span>),</span>
<span id="cb29-310"><a href="#cb29-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">str_remove</span>(street_name, <span class="st">" UNIT.*"</span>),</span>
<span id="cb29-311"><a href="#cb29-311" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-312"><a href="#cb29-312" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+$"</span>)) <span class="sc">&amp;</span></span>
<span id="cb29-313"><a href="#cb29-313" aria-hidden="true" tabindex="-1"></a>                   (<span class="sc">!</span><span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">bROUTE</span><span class="sc">\\</span><span class="st">b"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))) <span class="sc">~</span> <span class="fu">str_replace</span>(</span>
<span id="cb29-314"><a href="#cb29-314" aria-hidden="true" tabindex="-1"></a>        street_name, <span class="st">"(RD|ROAD|DRIVE|DR|AV|AVE|AVENUE|ST|STREET|LANE|LN|LA|CIR|CT|COURT|TE).*"</span>,</span>
<span id="cb29-315"><a href="#cb29-315" aria-hidden="true" tabindex="-1"></a>        <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span></span>
<span id="cb29-316"><a href="#cb29-316" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb29-317"><a href="#cb29-317" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> street_name</span>
<span id="cb29-318"><a href="#cb29-318" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-319"><a href="#cb29-319" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-320"><a href="#cb29-320" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+$"</span>)) <span class="sc">~</span> <span class="fu">str_remove</span>(street_name, <span class="st">"</span><span class="sc">\\</span><span class="st">s*U(N)?</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+$"</span>),</span>
<span id="cb29-321"><a href="#cb29-321" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> street_name</span>
<span id="cb29-322"><a href="#cb29-322" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-323"><a href="#cb29-323" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-324"><a href="#cb29-324" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(street_name, <span class="fu">regex</span>(<span class="st">"^[A-Za-z]"</span>)) <span class="sc">~</span> street_name,</span>
<span id="cb29-325"><a href="#cb29-325" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(<span class="fu">str_extract</span>(street_name, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s)[A-Za-z].*"</span>)) <span class="sc">~</span> street_name,</span>
<span id="cb29-326"><a href="#cb29-326" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">str_extract</span>(street_name, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s)[A-Za-z].*"</span>) </span>
<span id="cb29-327"><a href="#cb29-327" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-328"><a href="#cb29-328" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb29-329"><a href="#cb29-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-330"><a href="#cb29-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-333"><a href="#cb29-333" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-334"><a href="#cb29-334" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object </span></span>
<span id="cb29-335"><a href="#cb29-335" aria-hidden="true" tabindex="-1"></a>ct_sales_sf <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> </span>
<span id="cb29-336"><a href="#cb29-336" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(location) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span>         </span>
<span id="cb29-337"><a href="#cb29-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">location =</span> <span class="fu">st_as_sfc</span>(location, <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))) <span class="sc">|&gt;</span>     </span>
<span id="cb29-338"><a href="#cb29-338" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>()  </span>
<span id="cb29-339"><a href="#cb29-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-340"><a href="#cb29-340" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Grand Central Terminal sf object</span></span>
<span id="cb29-341"><a href="#cb29-341" aria-hidden="true" tabindex="-1"></a>grand_central <span class="ot">&lt;-</span> <span class="fu">st_sfc</span>(<span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">73.977229</span>, <span class="fl">40.752726</span>)), </span>
<span id="cb29-342"><a href="#cb29-342" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_sales_sf)) <span class="sc">|&gt;</span> <span class="fu">st_sf</span>()</span>
<span id="cb29-343"><a href="#cb29-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-344"><a href="#cb29-344" aria-hidden="true" tabindex="-1"></a>grand_central <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(grand_central, <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_sales_sf)) </span>
<span id="cb29-345"><a href="#cb29-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-346"><a href="#cb29-346" aria-hidden="true" tabindex="-1"></a><span class="co"># The mappings to be verified</span></span>
<span id="cb29-347"><a href="#cb29-347" aria-hidden="true" tabindex="-1"></a>to_verify <span class="ot">&lt;-</span> ct_sales_sf <span class="sc">|&gt;</span></span>
<span id="cb29-348"><a href="#cb29-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-349"><a href="#cb29-349" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_dist_to_nyc =</span> </span>
<span id="cb29-350"><a href="#cb29-350" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(location, grand_central)<span class="sc">/</span><span class="dv">1000</span>), <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb29-351"><a href="#cb29-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-352"><a href="#cb29-352" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(location)[, <span class="dv">1</span>],</span>
<span id="cb29-353"><a href="#cb29-353" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(location)[, <span class="dv">2</span>]</span>
<span id="cb29-354"><a href="#cb29-354" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-355"><a href="#cb29-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-356"><a href="#cb29-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ref_id, address, street_name, town, lon, lat, point_dist_to_nyc)</span>
<span id="cb29-357"><a href="#cb29-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-358"><a href="#cb29-358" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(to_verify) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb29-359"><a href="#cb29-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-360"><a href="#cb29-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-361"><a href="#cb29-361" aria-hidden="true" tabindex="-1"></a><span class="fu">### Define a function to compute the distance range for each town from Grand Central Terminal</span></span>
<span id="cb29-362"><a href="#cb29-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-365"><a href="#cb29-365" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-366"><a href="#cb29-366" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to compute the distances from each point in the town </span></span>
<span id="cb29-367"><a href="#cb29-367" aria-hidden="true" tabindex="-1"></a><span class="co"># geometry and determine the range</span></span>
<span id="cb29-368"><a href="#cb29-368" aria-hidden="true" tabindex="-1"></a>compute_town_dist_range <span class="ot">&lt;-</span> <span class="cf">function</span>(town_name){</span>
<span id="cb29-369"><a href="#cb29-369" aria-hidden="true" tabindex="-1"></a>  vertices <span class="ot">&lt;-</span> towns_sf <span class="sc">|&gt;</span></span>
<span id="cb29-370"><a href="#cb29-370" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(NAME <span class="sc">==</span> town_name) <span class="sc">|&gt;</span></span>
<span id="cb29-371"><a href="#cb29-371" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-372"><a href="#cb29-372" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"POLYGON"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-373"><a href="#cb29-373" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"LINESTRING"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-374"><a href="#cb29-374" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_cast</span>(<span class="st">"POINT"</span>)</span>
<span id="cb29-375"><a href="#cb29-375" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-376"><a href="#cb29-376" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute distances in kilometers</span></span>
<span id="cb29-377"><a href="#cb29-377" aria-hidden="true" tabindex="-1"></a>  distances <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(vertices, grand_central))<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb29-378"><a href="#cb29-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-379"><a href="#cb29-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb29-380"><a href="#cb29-380" aria-hidden="true" tabindex="-1"></a>    <span class="at">town =</span> town_name,</span>
<span id="cb29-381"><a href="#cb29-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_dist_km =</span> <span class="fu">round</span>(<span class="fu">min</span>(distances), <span class="dv">2</span>),</span>
<span id="cb29-382"><a href="#cb29-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_dist_km =</span> <span class="fu">round</span>(<span class="fu">max</span>(distances), <span class="dv">2</span>)</span>
<span id="cb29-383"><a href="#cb29-383" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-384"><a href="#cb29-384" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-385"><a href="#cb29-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-386"><a href="#cb29-386" aria-hidden="true" tabindex="-1"></a>towns_sf <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span></span>
<span id="cb29-387"><a href="#cb29-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">!=</span> <span class="st">"County subdivisions not defined"</span>)</span>
<span id="cb29-388"><a href="#cb29-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-389"><a href="#cb29-389" aria-hidden="true" tabindex="-1"></a>town_list <span class="ot">&lt;-</span> towns_sf <span class="sc">|&gt;</span></span>
<span id="cb29-390"><a href="#cb29-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-391"><a href="#cb29-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME) <span class="sc">|&gt;</span></span>
<span id="cb29-392"><a href="#cb29-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb29-393"><a href="#cb29-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-394"><a href="#cb29-394" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the distance range for each town from the anchor point: Grand Central Terminal </span></span>
<span id="cb29-395"><a href="#cb29-395" aria-hidden="true" tabindex="-1"></a>town_distance_range <span class="ot">&lt;-</span> town_list <span class="sc">|&gt;</span> <span class="fu">map</span>(compute_town_dist_range) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>()</span>
<span id="cb29-396"><a href="#cb29-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-397"><a href="#cb29-397" aria-hidden="true" tabindex="-1"></a>town_distance_range <span class="ot">&lt;-</span> town_distance_range <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="st">"TOWN"</span> <span class="ot">=</span> town)</span>
<span id="cb29-398"><a href="#cb29-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-399"><a href="#cb29-399" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify </span></span>
<span id="cb29-400"><a href="#cb29-400" aria-hidden="true" tabindex="-1"></a>mappings_verified <span class="ot">&lt;-</span> to_verify <span class="sc">|&gt;</span></span>
<span id="cb29-401"><a href="#cb29-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(town_distance_range, <span class="at">by =</span> <span class="st">"town"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-402"><a href="#cb29-402" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-403"><a href="#cb29-403" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">between</span>(point_dist_to_nyc, min_dist_km, max_dist_km)</span>
<span id="cb29-404"><a href="#cb29-404" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-405"><a href="#cb29-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-406"><a href="#cb29-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-407"><a href="#cb29-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-408"><a href="#cb29-408" aria-hidden="true" tabindex="-1"></a><span class="fu">## Imputation of Missing Values: `location`</span></span>
<span id="cb29-409"><a href="#cb29-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-410"><a href="#cb29-410" aria-hidden="true" tabindex="-1"></a>Impute missing values of <span class="in">`location`</span> based on verified correct mappings from the </span>
<span id="cb29-411"><a href="#cb29-411" aria-hidden="true" tabindex="-1"></a>same street and town. </span>
<span id="cb29-412"><a href="#cb29-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-415"><a href="#cb29-415" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-416"><a href="#cb29-416" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a unique street identifier by combining street_name and town</span></span>
<span id="cb29-417"><a href="#cb29-417" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">street_name1 =</span> <span class="fu">paste</span>(street_name, town))</span>
<span id="cb29-418"><a href="#cb29-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-419"><a href="#cb29-419" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a reference for `location` imputation using the verified mappings </span></span>
<span id="cb29-420"><a href="#cb29-420" aria-hidden="true" tabindex="-1"></a><span class="co"># between `address` and `location`</span></span>
<span id="cb29-421"><a href="#cb29-421" aria-hidden="true" tabindex="-1"></a>loc_imp_ref <span class="ot">&lt;-</span> mappings_verified <span class="sc">|&gt;</span></span>
<span id="cb29-422"><a href="#cb29-422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(is_valid_location <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-423"><a href="#cb29-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-424"><a href="#cb29-424" aria-hidden="true" tabindex="-1"></a>    <span class="at">street_name1 =</span> <span class="fu">paste</span>(street_name, town)</span>
<span id="cb29-425"><a href="#cb29-425" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-426"><a href="#cb29-426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ref_id, street_name1, lon, lat) <span class="sc">|&gt;</span>  </span>
<span id="cb29-427"><a href="#cb29-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(street_name1, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-428"><a href="#cb29-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-429"><a href="#cb29-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-430"><a href="#cb29-430" aria-hidden="true" tabindex="-1"></a><span class="co"># Begin by imputing `location` values using verified coordinates matched by </span></span>
<span id="cb29-431"><a href="#cb29-431" aria-hidden="true" tabindex="-1"></a><span class="co"># `street_name` and `town`</span></span>
<span id="cb29-432"><a href="#cb29-432" aria-hidden="true" tabindex="-1"></a>ct_sales_imputed <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> </span>
<span id="cb29-433"><a href="#cb29-433" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(location) <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-434"><a href="#cb29-434" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(loc_imp_ref, <span class="at">by =</span> <span class="st">"street_name1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-435"><a href="#cb29-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb29-436"><a href="#cb29-436" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref_id =</span> ref_id.x</span>
<span id="cb29-437"><a href="#cb29-437" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-438"><a href="#cb29-438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ref_id.y)</span>
<span id="cb29-439"><a href="#cb29-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-440"><a href="#cb29-440" aria-hidden="true" tabindex="-1"></a><span class="co"># Add additional notes regarding the `location` values </span></span>
<span id="cb29-441"><a href="#cb29-441" aria-hidden="true" tabindex="-1"></a>ct_sales_imputed <span class="ot">&lt;-</span> ct_sales_imputed <span class="sc">|&gt;</span></span>
<span id="cb29-442"><a href="#cb29-442" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-443"><a href="#cb29-443" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-444"><a href="#cb29-444" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span> <span class="fu">is.na</span>(lon) <span class="sc">&amp;</span> <span class="sc">!</span> <span class="fu">is.na</span>(lat)  <span class="sc">~</span> <span class="st">"value imputed based on matching street name and town"</span>,</span>
<span id="cb29-445"><a href="#cb29-445" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"to fill with town-level geometry"</span></span>
<span id="cb29-446"><a href="#cb29-446" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-447"><a href="#cb29-447" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-448"><a href="#cb29-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-449"><a href="#cb29-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-450"><a href="#cb29-450" aria-hidden="true" tabindex="-1"></a><span class="co"># This subset of the data contains records whose location values were </span></span>
<span id="cb29-451"><a href="#cb29-451" aria-hidden="true" tabindex="-1"></a><span class="co"># verified in the previous step</span></span>
<span id="cb29-452"><a href="#cb29-452" aria-hidden="true" tabindex="-1"></a>ct_sales_verified <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> </span>
<span id="cb29-453"><a href="#cb29-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(location) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-454"><a href="#cb29-454" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-455"><a href="#cb29-455" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(location, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">().*?(?=</span><span class="sc">\\</span><span class="st">s)"</span>)),</span>
<span id="cb29-456"><a href="#cb29-456" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(location, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">s)-?</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+(?=</span><span class="sc">\\</span><span class="st">))"</span>))</span>
<span id="cb29-457"><a href="#cb29-457" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-458"><a href="#cb29-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mappings_verified <span class="sc">|&gt;</span> </span>
<span id="cb29-459"><a href="#cb29-459" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(ref_id, is_valid_location),</span>
<span id="cb29-460"><a href="#cb29-460" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"ref_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-461"><a href="#cb29-461" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-462"><a href="#cb29-462" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">as.character</span>(is_valid_location)</span>
<span id="cb29-463"><a href="#cb29-463" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-464"><a href="#cb29-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-465"><a href="#cb29-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-466"><a href="#cb29-466" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine `ct_sales_imputed` and `ct_sales_verified`</span></span>
<span id="cb29-467"><a href="#cb29-467" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ct_sales_verified, ct_sales_imputed) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(ref_id)</span>
<span id="cb29-468"><a href="#cb29-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-469"><a href="#cb29-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-470"><a href="#cb29-470" aria-hidden="true" tabindex="-1"></a><span class="co"># Last, for properties with incorrect mapping and no matching street name and town, impute the `location` values using the town centroid</span></span>
<span id="cb29-471"><a href="#cb29-471" aria-hidden="true" tabindex="-1"></a>town_centroid <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span></span>
<span id="cb29-472"><a href="#cb29-472" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">!=</span> <span class="st">"County subdivisions not defined"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-473"><a href="#cb29-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-474"><a href="#cb29-474" aria-hidden="true" tabindex="-1"></a>    <span class="at">center =</span> <span class="fu">st_centroid</span>(geometry), </span>
<span id="cb29-475"><a href="#cb29-475" aria-hidden="true" tabindex="-1"></a>    <span class="at">centroid_lon =</span> <span class="fu">st_coordinates</span>(center)[, <span class="dv">1</span>],</span>
<span id="cb29-476"><a href="#cb29-476" aria-hidden="true" tabindex="-1"></a>    <span class="at">centroid_lat =</span> <span class="fu">st_coordinates</span>(center)[, <span class="dv">2</span>]</span>
<span id="cb29-477"><a href="#cb29-477" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-478"><a href="#cb29-478" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-479"><a href="#cb29-479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, centroid_lon, centroid_lat) <span class="sc">|&gt;</span></span>
<span id="cb29-480"><a href="#cb29-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME)</span>
<span id="cb29-481"><a href="#cb29-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-482"><a href="#cb29-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-483"><a href="#cb29-483" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb29-484"><a href="#cb29-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(town_centroid, <span class="at">by =</span> <span class="st">"town"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-485"><a href="#cb29-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-486"><a href="#cb29-486" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-487"><a href="#cb29-487" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FALSE"</span>, <span class="st">"to fill with town-level geometry"</span>) </span>
<span id="cb29-488"><a href="#cb29-488" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> centroid_lon,</span>
<span id="cb29-489"><a href="#cb29-489" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> lon</span>
<span id="cb29-490"><a href="#cb29-490" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-491"><a href="#cb29-491" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-492"><a href="#cb29-492" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FALSE"</span>, <span class="st">"to fill with town-level geometry"</span>) </span>
<span id="cb29-493"><a href="#cb29-493" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> centroid_lat,</span>
<span id="cb29-494"><a href="#cb29-494" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> lat</span>
<span id="cb29-495"><a href="#cb29-495" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-496"><a href="#cb29-496" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-497"><a href="#cb29-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-498"><a href="#cb29-498" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid_location =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-499"><a href="#cb29-499" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">==</span> <span class="st">"FALSE"</span> <span class="sc">~</span> <span class="st">"corrected using the town centroid geometry"</span>,</span>
<span id="cb29-500"><a href="#cb29-500" aria-hidden="true" tabindex="-1"></a>      is_valid_location <span class="sc">==</span> <span class="st">"to fill with town-level geometry"</span> </span>
<span id="cb29-501"><a href="#cb29-501" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="st">"value imputed using the town centroid geometry"</span>,</span>
<span id="cb29-502"><a href="#cb29-502" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> is_valid_location</span>
<span id="cb29-503"><a href="#cb29-503" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-504"><a href="#cb29-504" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-505"><a href="#cb29-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-506"><a href="#cb29-506" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>centroid_lon, <span class="sc">-</span>centroid_lat) </span>
<span id="cb29-507"><a href="#cb29-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-508"><a href="#cb29-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-509"><a href="#cb29-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-510"><a href="#cb29-510" aria-hidden="true" tabindex="-1"></a><span class="fu">## Handle Missing Values: `property_type`</span></span>
<span id="cb29-511"><a href="#cb29-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-514"><a href="#cb29-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-515"><a href="#cb29-515" aria-hidden="true" tabindex="-1"></a>ct_sales <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">address1 =</span> <span class="fu">paste</span>(address, town))</span>
<span id="cb29-516"><a href="#cb29-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-517"><a href="#cb29-517" aria-hidden="true" tabindex="-1"></a><span class="co"># Properties with missing property type </span></span>
<span id="cb29-518"><a href="#cb29-518" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb29-519"><a href="#cb29-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb29-520"><a href="#cb29-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-521"><a href="#cb29-521" aria-hidden="true" tabindex="-1"></a>property_w_type <span class="ot">&lt;-</span> ct_sales <span class="sc">|&gt;</span></span>
<span id="cb29-522"><a href="#cb29-522" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb29-523"><a href="#cb29-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-524"><a href="#cb29-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-525"><a href="#cb29-525" aria-hidden="true" tabindex="-1"></a><span class="co"># Find common properties in both categories </span></span>
<span id="cb29-526"><a href="#cb29-526" aria-hidden="true" tabindex="-1"></a>common_properties <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb29-527"><a href="#cb29-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(address1) <span class="sc">|&gt;</span></span>
<span id="cb29-528"><a href="#cb29-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(address1) <span class="sc">|&gt;</span></span>
<span id="cb29-529"><a href="#cb29-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(property_w_type <span class="sc">|&gt;</span> </span>
<span id="cb29-530"><a href="#cb29-530" aria-hidden="true" tabindex="-1"></a>               <span class="fu">select</span>(address1, property_type, residential_type), </span>
<span id="cb29-531"><a href="#cb29-531" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="st">"address1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-532"><a href="#cb29-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(address1, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-533"><a href="#cb29-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-534"><a href="#cb29-534" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in `property_type` by performing left joining  with `common_properties`</span></span>
<span id="cb29-535"><a href="#cb29-535" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb29-536"><a href="#cb29-536" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(common_properties, <span class="at">by =</span> <span class="st">"address1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-537"><a href="#cb29-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-538"><a href="#cb29-538" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type.x =</span> property_type.y,</span>
<span id="cb29-539"><a href="#cb29-539" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type.x =</span> residential_type.y</span>
<span id="cb29-540"><a href="#cb29-540" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-541"><a href="#cb29-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>property_type.y, <span class="sc">-</span> residential_type.y) <span class="sc">|&gt;</span></span>
<span id="cb29-542"><a href="#cb29-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb29-543"><a href="#cb29-543" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type =</span> property_type.x,</span>
<span id="cb29-544"><a href="#cb29-544" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type =</span> residential_type.x</span>
<span id="cb29-545"><a href="#cb29-545" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb29-546"><a href="#cb29-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-547"><a href="#cb29-547" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine updated properties with the existing `property_w_type` data frame</span></span>
<span id="cb29-548"><a href="#cb29-548" aria-hidden="true" tabindex="-1"></a>property_w_type <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb29-549"><a href="#cb29-549" aria-hidden="true" tabindex="-1"></a>  property_missing_type <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">&gt;</span> <span class="dv">0</span>),    </span>
<span id="cb29-550"><a href="#cb29-550" aria-hidden="true" tabindex="-1"></a>  property_w_type</span>
<span id="cb29-551"><a href="#cb29-551" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-552"><a href="#cb29-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-553"><a href="#cb29-553" aria-hidden="true" tabindex="-1"></a><span class="co"># New subset of properties without `property_type`</span></span>
<span id="cb29-554"><a href="#cb29-554" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb29-555"><a href="#cb29-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(property_type))</span>
<span id="cb29-556"><a href="#cb29-556" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-557"><a href="#cb29-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-558"><a href="#cb29-558" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fill Missing Values: Using [CT State Parcel Records](https://geodata.ct.gov/datasets/ctmaps::connecticut-cama-and-parcel-layer/explore)</span></span>
<span id="cb29-559"><a href="#cb29-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-560"><a href="#cb29-560" aria-hidden="true" tabindex="-1"></a>Obtain property type information from the Connecticut parcel data: <span class="in">`state_use`</span> </span>
<span id="cb29-561"><a href="#cb29-561" aria-hidden="true" tabindex="-1"></a>and <span class="in">`state_use_description`</span> provide the details about the property type and </span>
<span id="cb29-562"><a href="#cb29-562" aria-hidden="true" tabindex="-1"></a>residential type.</span>
<span id="cb29-563"><a href="#cb29-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-566"><a href="#cb29-566" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-567"><a href="#cb29-567" aria-hidden="true" tabindex="-1"></a><span class="co"># Parcel data of Connecticut</span></span>
<span id="cb29-568"><a href="#cb29-568" aria-hidden="true" tabindex="-1"></a>state_parcel_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/Downloads/Connecticut_CAMA_and_Parcel_Layer_3895368049124948111.csv"</span>)</span>
<span id="cb29-569"><a href="#cb29-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-570"><a href="#cb29-570" aria-hidden="true" tabindex="-1"></a><span class="co"># Format `state_parcel` column names</span></span>
<span id="cb29-571"><a href="#cb29-571" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(state_parcel_data) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">"_"</span>, </span>
<span id="cb29-572"><a href="#cb29-572" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">colnames</span>(state_parcel_data)))</span>
<span id="cb29-573"><a href="#cb29-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-574"><a href="#cb29-574" aria-hidden="true" tabindex="-1"></a><span class="co"># Connecticut land use code and description</span></span>
<span id="cb29-575"><a href="#cb29-575" aria-hidden="true" tabindex="-1"></a>land_use_codes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"~/Downloads/Connecticut Land Use Codes.csv"</span>)</span>
<span id="cb29-576"><a href="#cb29-576" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(land_use_codes) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(land_use_codes))</span>
<span id="cb29-577"><a href="#cb29-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-578"><a href="#cb29-578" aria-hidden="true" tabindex="-1"></a><span class="co"># Find code prefix for easy property type mapping</span></span>
<span id="cb29-579"><a href="#cb29-579" aria-hidden="true" tabindex="-1"></a>land_use_codes <span class="ot">&lt;-</span> land_use_codes <span class="sc">|&gt;</span></span>
<span id="cb29-580"><a href="#cb29-580" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-581"><a href="#cb29-581" aria-hidden="true" tabindex="-1"></a>    <span class="at">code_prefix =</span> <span class="fu">substr</span>(code, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb29-582"><a href="#cb29-582" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-583"><a href="#cb29-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-584"><a href="#cb29-584" aria-hidden="true" tabindex="-1"></a><span class="co"># Vacant land use code </span></span>
<span id="cb29-585"><a href="#cb29-585" aria-hidden="true" tabindex="-1"></a>vacant_land_codes <span class="ot">&lt;-</span> land_use_codes <span class="sc">|&gt;</span></span>
<span id="cb29-586"><a href="#cb29-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"vac"</span>, description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-587"><a href="#cb29-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(code) <span class="sc">|&gt;</span></span>
<span id="cb29-588"><a href="#cb29-588" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb29-589"><a href="#cb29-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-590"><a href="#cb29-590" aria-hidden="true" tabindex="-1"></a><span class="co"># Map land use codes to property types</span></span>
<span id="cb29-591"><a href="#cb29-591" aria-hidden="true" tabindex="-1"></a>land_use_codes <span class="ot">&lt;-</span> land_use_codes <span class="sc">|&gt;</span></span>
<span id="cb29-592"><a href="#cb29-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-593"><a href="#cb29-593" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-594"><a href="#cb29-594" aria-hidden="true" tabindex="-1"></a>      description <span class="sc">==</span> <span class="st">"null"</span> <span class="sc">~</span> <span class="st">"Unknown"</span>,</span>
<span id="cb29-595"><a href="#cb29-595" aria-hidden="true" tabindex="-1"></a>      description <span class="sc">==</span> <span class="st">"Apartment Land"</span> <span class="sc">~</span> <span class="st">"Apartment Land"</span>,</span>
<span id="cb29-596"><a href="#cb29-596" aria-hidden="true" tabindex="-1"></a>      code <span class="sc">%in%</span> vacant_land_codes <span class="sc">~</span> <span class="st">"Vacant Land"</span>,</span>
<span id="cb29-597"><a href="#cb29-597" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&gt;=</span> <span class="dv">100</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&lt;</span> <span class="dv">200</span> <span class="sc">~</span> <span class="st">"Residential"</span>,</span>
<span id="cb29-598"><a href="#cb29-598" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&gt;=</span> <span class="dv">200</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&lt;</span> <span class="dv">300</span> <span class="sc">~</span> <span class="st">"Commercial"</span>,</span>
<span id="cb29-599"><a href="#cb29-599" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&gt;=</span> <span class="dv">300</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&lt;</span> <span class="dv">400</span> <span class="sc">~</span> <span class="st">"Industrial"</span>,</span>
<span id="cb29-600"><a href="#cb29-600" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&gt;=</span> <span class="dv">400</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&lt;</span> <span class="dv">500</span> <span class="sc">~</span> <span class="st">"Public Utility"</span>,</span>
<span id="cb29-601"><a href="#cb29-601" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&gt;=</span> <span class="dv">600</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&lt;</span> <span class="dv">800</span> <span class="sc">~</span> <span class="st">"Agricultural"</span>,</span>
<span id="cb29-602"><a href="#cb29-602" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&gt;=</span> <span class="dv">800</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(code_prefix) <span class="sc">&lt;</span> <span class="dv">900</span> <span class="sc">~</span> <span class="st">"Apartments"</span>,</span>
<span id="cb29-603"><a href="#cb29-603" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb29-604"><a href="#cb29-604" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-605"><a href="#cb29-605" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-606"><a href="#cb29-606" aria-hidden="true" tabindex="-1"></a>      property_type <span class="sc">==</span> <span class="st">"Residential"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"res"</span>, description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Residential"</span>,</span>
<span id="cb29-607"><a href="#cb29-607" aria-hidden="true" tabindex="-1"></a>      property_type <span class="sc">==</span> <span class="st">"Residential"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"condo"</span>, description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Condominium"</span>,</span>
<span id="cb29-608"><a href="#cb29-608" aria-hidden="true" tabindex="-1"></a>      property_type <span class="sc">==</span> <span class="st">"Residential"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"sfr"</span>, description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Single Family"</span>,</span>
<span id="cb29-609"><a href="#cb29-609" aria-hidden="true" tabindex="-1"></a>      property_type <span class="sc">==</span> <span class="st">"Residential"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"2 fam"</span>, description, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">"Two Family"</span>,</span>
<span id="cb29-610"><a href="#cb29-610" aria-hidden="true" tabindex="-1"></a>      property_type <span class="sc">==</span> <span class="st">"Residential"</span> <span class="sc">~</span> description,</span>
<span id="cb29-611"><a href="#cb29-611" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb29-612"><a href="#cb29-612" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-613"><a href="#cb29-613" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-614"><a href="#cb29-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-615"><a href="#cb29-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-616"><a href="#cb29-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-619"><a href="#cb29-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-620"><a href="#cb29-620" aria-hidden="true" tabindex="-1"></a><span class="co"># Select distinct land use description for joining </span></span>
<span id="cb29-621"><a href="#cb29-621" aria-hidden="true" tabindex="-1"></a>land_use_codes <span class="ot">&lt;-</span> land_use_codes <span class="sc">|&gt;</span></span>
<span id="cb29-622"><a href="#cb29-622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(description, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-623"><a href="#cb29-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-624"><a href="#cb29-624" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the properties in `state_parcel` with land use description column </span></span>
<span id="cb29-625"><a href="#cb29-625" aria-hidden="true" tabindex="-1"></a>property_type_ref <span class="ot">&lt;-</span> state_parcel_data <span class="sc">|&gt;</span></span>
<span id="cb29-626"><a href="#cb29-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(location) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-627"><a href="#cb29-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-628"><a href="#cb29-628" aria-hidden="true" tabindex="-1"></a>    <span class="at">location_w_town =</span> <span class="fu">paste</span>(location, town_name)</span>
<span id="cb29-629"><a href="#cb29-629" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-630"><a href="#cb29-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb29-631"><a href="#cb29-631" aria-hidden="true" tabindex="-1"></a>    location_w_town,</span>
<span id="cb29-632"><a href="#cb29-632" aria-hidden="true" tabindex="-1"></a>    state_use_description</span>
<span id="cb29-633"><a href="#cb29-633" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-634"><a href="#cb29-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(location_w_town, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-635"><a href="#cb29-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-636"><a href="#cb29-636" aria-hidden="true" tabindex="-1"></a><span class="co"># Left join with `land_use_codes` to obtain property type and residential type info</span></span>
<span id="cb29-637"><a href="#cb29-637" aria-hidden="true" tabindex="-1"></a>property_type_ref <span class="ot">&lt;-</span> property_type_ref <span class="sc">|&gt;</span></span>
<span id="cb29-638"><a href="#cb29-638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb29-639"><a href="#cb29-639" aria-hidden="true" tabindex="-1"></a>    land_use_codes,</span>
<span id="cb29-640"><a href="#cb29-640" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"state_use_description"</span> <span class="ot">=</span> <span class="st">"description"</span>)</span>
<span id="cb29-641"><a href="#cb29-641" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-642"><a href="#cb29-642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb29-643"><a href="#cb29-643" aria-hidden="true" tabindex="-1"></a>    location_w_town,</span>
<span id="cb29-644"><a href="#cb29-644" aria-hidden="true" tabindex="-1"></a>    property_type,</span>
<span id="cb29-645"><a href="#cb29-645" aria-hidden="true" tabindex="-1"></a>    residential_type</span>
<span id="cb29-646"><a href="#cb29-646" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-647"><a href="#cb29-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(location_w_town, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-648"><a href="#cb29-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-649"><a href="#cb29-649" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in the `property_type` and `residential_type` </span></span>
<span id="cb29-650"><a href="#cb29-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-651"><a href="#cb29-651" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span></span>
<span id="cb29-652"><a href="#cb29-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(property_type_ref, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"address1"</span> <span class="ot">=</span> <span class="st">"location_w_town"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-653"><a href="#cb29-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-654"><a href="#cb29-654" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type.x =</span> property_type.y,</span>
<span id="cb29-655"><a href="#cb29-655" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type.x =</span> residential_type.y</span>
<span id="cb29-656"><a href="#cb29-656" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-657"><a href="#cb29-657" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb29-658"><a href="#cb29-658" aria-hidden="true" tabindex="-1"></a>    <span class="at">property_type =</span> property_type.x,</span>
<span id="cb29-659"><a href="#cb29-659" aria-hidden="true" tabindex="-1"></a>    <span class="at">residential_type =</span> residential_type.x</span>
<span id="cb29-660"><a href="#cb29-660" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-661"><a href="#cb29-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">".y"</span>))</span>
<span id="cb29-662"><a href="#cb29-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-663"><a href="#cb29-663" aria-hidden="true" tabindex="-1"></a>property_w_type <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(property_missing_type <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span> <span class="fu">is.na</span>(property_type)), </span>
<span id="cb29-664"><a href="#cb29-664" aria-hidden="true" tabindex="-1"></a>                             property_w_type)</span>
<span id="cb29-665"><a href="#cb29-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-666"><a href="#cb29-666" aria-hidden="true" tabindex="-1"></a>property_missing_type <span class="ot">&lt;-</span> property_missing_type <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(property_type))</span>
<span id="cb29-667"><a href="#cb29-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-668"><a href="#cb29-668" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(property_w_type, property_missing_type) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(ref_id)</span>
<span id="cb29-669"><a href="#cb29-669" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-670"><a href="#cb29-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-671"><a href="#cb29-671" aria-hidden="true" tabindex="-1"></a><span class="fu"># Exploratory Data Analysis</span></span>
<span id="cb29-672"><a href="#cb29-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-673"><a href="#cb29-673" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1. What is the total number of real estate transactions and the corresponding aggregate sale volume by county?</span></span>
<span id="cb29-674"><a href="#cb29-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-675"><a href="#cb29-675" aria-hidden="true" tabindex="-1"></a>Fairfield County leads Connecticut in real estate activity, recording over 211,845 </span>
<span id="cb29-676"><a href="#cb29-676" aria-hidden="true" tabindex="-1"></a>transactions and a total sales volume of $153 billion—nearly triple that of any </span>
<span id="cb29-677"><a href="#cb29-677" aria-hidden="true" tabindex="-1"></a>other county. Hartford and New Haven follow with significant volumes of $58 billion </span>
<span id="cb29-678"><a href="#cb29-678" aria-hidden="true" tabindex="-1"></a>and $53 billion, respectively, while the remaining counties contribute more </span>
<span id="cb29-679"><a href="#cb29-679" aria-hidden="true" tabindex="-1"></a>modestly to the state's overall market.</span>
<span id="cb29-680"><a href="#cb29-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-683"><a href="#cb29-683" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-684"><a href="#cb29-684" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the total number of recorded properties by county </span></span>
<span id="cb29-685"><a href="#cb29-685" aria-hidden="true" tabindex="-1"></a>n_by_county <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb29-686"><a href="#cb29-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb29-687"><a href="#cb29-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">total_billion =</span> <span class="fu">round</span>(<span class="fu">sum</span>(sale_amount)<span class="sc">/</span><span class="fl">1e9</span>, <span class="dv">0</span>)) </span>
<span id="cb29-688"><a href="#cb29-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-689"><a href="#cb29-689" aria-hidden="true" tabindex="-1"></a>n_by_county <span class="sc">|&gt;</span></span>
<span id="cb29-690"><a href="#cb29-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-691"><a href="#cb29-691" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">comma</span>(n),</span>
<span id="cb29-692"><a href="#cb29-692" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_billion =</span> <span class="fu">dollar</span>(total_billion, <span class="at">suffix =</span> <span class="st">"B"</span>)</span>
<span id="cb29-693"><a href="#cb29-693" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-694"><a href="#cb29-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(</span>
<span id="cb29-695"><a href="#cb29-695" aria-hidden="true" tabindex="-1"></a>    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"County"</span>, <span class="st">"Transactions"</span>, <span class="st">"Total Volume (Billion)"</span>),</span>
<span id="cb29-696"><a href="#cb29-696" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"&lt;b&gt;&lt;span style='color:black'&gt;Table 1: Real Estate Transactions and Volume by County (2001–2022)&lt;/span&gt;&lt;/b&gt;"</span>,</span>
<span id="cb29-697"><a href="#cb29-697" aria-hidden="true" tabindex="-1"></a>    <span class="at">escape =</span> <span class="cn">FALSE</span></span>
<span id="cb29-698"><a href="#cb29-698" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-699"><a href="#cb29-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb29-700"><a href="#cb29-700" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb29-701"><a href="#cb29-701" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span></span>
<span id="cb29-702"><a href="#cb29-702" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-703"><a href="#cb29-703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-704"><a href="#cb29-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-705"><a href="#cb29-705" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2. How many repeated sales are there in each county? </span></span>
<span id="cb29-706"><a href="#cb29-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-707"><a href="#cb29-707" aria-hidden="true" tabindex="-1"></a>Hartford County recorded the highest number of repeated sales with 30,721 transactions, </span>
<span id="cb29-708"><a href="#cb29-708" aria-hidden="true" tabindex="-1"></a>followed closely by Fairfield County with 27,548. New Haven County also demonstrated </span>
<span id="cb29-709"><a href="#cb29-709" aria-hidden="true" tabindex="-1"></a>strong market activity, with 27,213 repeated transactions during the period.</span>
<span id="cb29-710"><a href="#cb29-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-711"><a href="#cb29-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-714"><a href="#cb29-714" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-715"><a href="#cb29-715" aria-hidden="true" tabindex="-1"></a><span class="co"># Find repeated sales </span></span>
<span id="cb29-716"><a href="#cb29-716" aria-hidden="true" tabindex="-1"></a><span class="co"># repeated_sales &lt;- ct_sales_cleaned |&gt;</span></span>
<span id="cb29-717"><a href="#cb29-717" aria-hidden="true" tabindex="-1"></a><span class="co">#   arrange(address1, list_year) |&gt;</span></span>
<span id="cb29-718"><a href="#cb29-718" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(address1) |&gt;</span></span>
<span id="cb29-719"><a href="#cb29-719" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(n() &gt; 1) |&gt;</span></span>
<span id="cb29-720"><a href="#cb29-720" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb29-721"><a href="#cb29-721" aria-hidden="true" tabindex="-1"></a><span class="co">#     town = first(town),</span></span>
<span id="cb29-722"><a href="#cb29-722" aria-hidden="true" tabindex="-1"></a><span class="co">#     county = first(county),</span></span>
<span id="cb29-723"><a href="#cb29-723" aria-hidden="true" tabindex="-1"></a><span class="co">#     property_type = first(property_type),</span></span>
<span id="cb29-724"><a href="#cb29-724" aria-hidden="true" tabindex="-1"></a><span class="co">#     earliest_sale = first(sale_amount),</span></span>
<span id="cb29-725"><a href="#cb29-725" aria-hidden="true" tabindex="-1"></a><span class="co">#     latest_sale = last(sale_amount),</span></span>
<span id="cb29-726"><a href="#cb29-726" aria-hidden="true" tabindex="-1"></a><span class="co">#     chg_in_value = latest_sale - earliest_sale,</span></span>
<span id="cb29-727"><a href="#cb29-727" aria-hidden="true" tabindex="-1"></a><span class="co">#     .groups = "drop"</span></span>
<span id="cb29-728"><a href="#cb29-728" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb29-729"><a href="#cb29-729" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-730"><a href="#cb29-730" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(repeated_sales, "repeated_sales.csv", row.names = FALSE)</span></span>
<span id="cb29-731"><a href="#cb29-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-732"><a href="#cb29-732" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the saved data into R</span></span>
<span id="cb29-733"><a href="#cb29-733" aria-hidden="true" tabindex="-1"></a>repeated_sales <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"repeated_sales.csv"</span>)</span>
<span id="cb29-734"><a href="#cb29-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-735"><a href="#cb29-735" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of repeated sales for each county </span></span>
<span id="cb29-736"><a href="#cb29-736" aria-hidden="true" tabindex="-1"></a>n_repeated_sales_by_county <span class="ot">&lt;-</span> repeated_sales <span class="sc">|&gt;</span></span>
<span id="cb29-737"><a href="#cb29-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb29-738"><a href="#cb29-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb29-739"><a href="#cb29-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-740"><a href="#cb29-740" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb29-741"><a href="#cb29-741" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(n_repeated_sales_by_county, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(county, <span class="sc">-</span>total), <span class="at">y =</span> total)) <span class="sc">+</span></span>
<span id="cb29-742"><a href="#cb29-742" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb29-743"><a href="#cb29-743" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">comma</span>(total)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb29-744"><a href="#cb29-744" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma) <span class="sc">+</span></span>
<span id="cb29-745"><a href="#cb29-745" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-746"><a href="#cb29-746" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Number of Repeated Sales by County"</span>,</span>
<span id="cb29-747"><a href="#cb29-747" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"County"</span>,</span>
<span id="cb29-748"><a href="#cb29-748" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Repeated Sales"</span></span>
<span id="cb29-749"><a href="#cb29-749" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-750"><a href="#cb29-750" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb29-751"><a href="#cb29-751" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-752"><a href="#cb29-752" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),        <span class="co"># Bold title</span></span>
<span id="cb29-753"><a href="#cb29-753" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb29-754"><a href="#cb29-754" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb29-755"><a href="#cb29-755" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()   </span>
<span id="cb29-756"><a href="#cb29-756" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-757"><a href="#cb29-757" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-758"><a href="#cb29-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-759"><a href="#cb29-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-760"><a href="#cb29-760" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3. How much have average single-family home values changed in each county? </span></span>
<span id="cb29-761"><a href="#cb29-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-762"><a href="#cb29-762" aria-hidden="true" tabindex="-1"></a>Rapid home price appreciation typically indicates a strong and robust market. </span>
<span id="cb29-763"><a href="#cb29-763" aria-hidden="true" tabindex="-1"></a>Fairfield County stands out with the highest average increase in single-family </span>
<span id="cb29-764"><a href="#cb29-764" aria-hidden="true" tabindex="-1"></a>home values, rising by approximately $169,000 between 2001 and 2022. This growth </span>
<span id="cb29-765"><a href="#cb29-765" aria-hidden="true" tabindex="-1"></a>is more than double the appreciation seen in Middlesex and Litchfield counties, </span>
<span id="cb29-766"><a href="#cb29-766" aria-hidden="true" tabindex="-1"></a>and over three times greater than in Hartford County. The substantial increase </span>
<span id="cb29-767"><a href="#cb29-767" aria-hidden="true" tabindex="-1"></a>underscores Fairfield’s market strength. It also reinforces the pattern of </span>
<span id="cb29-768"><a href="#cb29-768" aria-hidden="true" tabindex="-1"></a>declining price growth and increasing distance from New York City.</span>
<span id="cb29-769"><a href="#cb29-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-772"><a href="#cb29-772" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-773"><a href="#cb29-773" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the mean change in value for each county </span></span>
<span id="cb29-774"><a href="#cb29-774" aria-hidden="true" tabindex="-1"></a>avg_value_by_county <span class="ot">&lt;-</span> repeated_sales <span class="sc">|&gt;</span></span>
<span id="cb29-775"><a href="#cb29-775" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Single Family"</span>, <span class="st">"Residential"</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb29-776"><a href="#cb29-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb29-777"><a href="#cb29-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg =</span> <span class="fu">mean</span>(chg_in_value)) <span class="sc">|&gt;</span></span>
<span id="cb29-778"><a href="#cb29-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg)) </span>
<span id="cb29-779"><a href="#cb29-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-780"><a href="#cb29-780" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(avg_value_by_county, <span class="fu">aes</span>(<span class="at">x =</span> avg, <span class="at">y =</span> <span class="fu">reorder</span>(county, avg))) <span class="sc">+</span></span>
<span id="cb29-781"><a href="#cb29-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2a9d8f"</span>) <span class="sc">+</span></span>
<span id="cb29-782"><a href="#cb29-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">dollar</span>(avg)), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.05</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb29-783"><a href="#cb29-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>(), </span>
<span id="cb29-784"><a href="#cb29-784" aria-hidden="true" tabindex="-1"></a>                     <span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.15</span>))) <span class="sc">+</span></span>
<span id="cb29-785"><a href="#cb29-785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-786"><a href="#cb29-786" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Property Value Appreciation"</span>,</span>
<span id="cb29-787"><a href="#cb29-787" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Single-Family Homes with Repeated Sales (by County)"</span>,</span>
<span id="cb29-788"><a href="#cb29-788" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Average Appreciation ($)"</span>,</span>
<span id="cb29-789"><a href="#cb29-789" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"County"</span></span>
<span id="cb29-790"><a href="#cb29-790" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-791"><a href="#cb29-791" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb29-792"><a href="#cb29-792" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-793"><a href="#cb29-793" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb29-794"><a href="#cb29-794" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb29-795"><a href="#cb29-795" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()   </span>
<span id="cb29-796"><a href="#cb29-796" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-797"><a href="#cb29-797" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-798"><a href="#cb29-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-799"><a href="#cb29-799" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4. Which months or quarters see the most activity?</span></span>
<span id="cb29-800"><a href="#cb29-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-801"><a href="#cb29-801" aria-hidden="true" tabindex="-1"></a>An analysis of monthly real estate transactions in Connecticut reveals clear </span>
<span id="cb29-802"><a href="#cb29-802" aria-hidden="true" tabindex="-1"></a>seasonal trends in sales volume. Transaction activity is lowest during the winter </span>
<span id="cb29-803"><a href="#cb29-803" aria-hidden="true" tabindex="-1"></a>months, with January (47,181) and February (40,234) recording the fewest sales. </span>
<span id="cb29-804"><a href="#cb29-804" aria-hidden="true" tabindex="-1"></a>As the market enters the spring and summer months, sales volume increases </span>
<span id="cb29-805"><a href="#cb29-805" aria-hidden="true" tabindex="-1"></a>significantly, peaking in June with 84,100 transactions. July (82,882) and </span>
<span id="cb29-806"><a href="#cb29-806" aria-hidden="true" tabindex="-1"></a>August (82,399) follow closely behind, highlighting a strong summer market.</span>
<span id="cb29-807"><a href="#cb29-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-810"><a href="#cb29-810" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-811"><a href="#cb29-811" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the number of transactions by month </span></span>
<span id="cb29-812"><a href="#cb29-812" aria-hidden="true" tabindex="-1"></a>monthly_sales <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb29-813"><a href="#cb29-813" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-814"><a href="#cb29-814" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">as.integer</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(date_recorded, <span class="at">format =</span> <span class="st">"%m/%d/%Y"</span>), <span class="st">"%m"</span>))</span>
<span id="cb29-815"><a href="#cb29-815" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-816"><a href="#cb29-816" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb29-817"><a href="#cb29-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(month) <span class="sc">|&gt;</span></span>
<span id="cb29-818"><a href="#cb29-818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb29-819"><a href="#cb29-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-820"><a href="#cb29-820" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert month to factor with labels </span></span>
<span id="cb29-821"><a href="#cb29-821" aria-hidden="true" tabindex="-1"></a>monthly_sales <span class="ot">&lt;-</span> monthly_sales <span class="sc">|&gt;</span></span>
<span id="cb29-822"><a href="#cb29-822" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-823"><a href="#cb29-823" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">factor</span>(month, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">labels =</span> month.name)</span>
<span id="cb29-824"><a href="#cb29-824" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-825"><a href="#cb29-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-826"><a href="#cb29-826" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb29-827"><a href="#cb29-827" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_sales, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> total)) <span class="sc">+</span></span>
<span id="cb29-828"><a href="#cb29-828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb29-829"><a href="#cb29-829" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">comma</span>(total)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb29-830"><a href="#cb29-830" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-831"><a href="#cb29-831" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Real Estate Transactions in Connecticut"</span>,</span>
<span id="cb29-832"><a href="#cb29-832" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb29-833"><a href="#cb29-833" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Transactions"</span></span>
<span id="cb29-834"><a href="#cb29-834" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-835"><a href="#cb29-835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb29-836"><a href="#cb29-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-837"><a href="#cb29-837" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb29-838"><a href="#cb29-838" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb29-839"><a href="#cb29-839" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb29-840"><a href="#cb29-840" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb29-841"><a href="#cb29-841" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-842"><a href="#cb29-842" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> comma)</span>
<span id="cb29-843"><a href="#cb29-843" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-844"><a href="#cb29-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-845"><a href="#cb29-845" aria-hidden="true" tabindex="-1"></a><span class="fu">## 5. What are the hotspots for high-value transactions?</span></span>
<span id="cb29-846"><a href="#cb29-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-847"><a href="#cb29-847" aria-hidden="true" tabindex="-1"></a>The vast majority of high-value residential property sales (over $5 million) in </span>
<span id="cb29-848"><a href="#cb29-848" aria-hidden="true" tabindex="-1"></a>Connecticut are concentrated in Fairfield County, which accounts for approximately </span>
<span id="cb29-849"><a href="#cb29-849" aria-hidden="true" tabindex="-1"></a>96.9% of such transactions. All other counties combined represent just 3.1%, </span>
<span id="cb29-850"><a href="#cb29-850" aria-hidden="true" tabindex="-1"></a>highlighting Fairfield’s dominant position as the primary market for luxury real </span>
<span id="cb29-851"><a href="#cb29-851" aria-hidden="true" tabindex="-1"></a>estate in the state.</span>
<span id="cb29-852"><a href="#cb29-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-855"><a href="#cb29-855" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-856"><a href="#cb29-856" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of single family home sales with over 5 million for each county</span></span>
<span id="cb29-857"><a href="#cb29-857" aria-hidden="true" tabindex="-1"></a>hotspots <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb29-858"><a href="#cb29-858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>), </span>
<span id="cb29-859"><a href="#cb29-859" aria-hidden="true" tabindex="-1"></a>         sale_amount <span class="sc">&gt;</span> <span class="dv">5000000</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-860"><a href="#cb29-860" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(county, <span class="at">name =</span> <span class="st">"count"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-861"><a href="#cb29-861" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-862"><a href="#cb29-862" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">county =</span> <span class="fu">ifelse</span>(percentage <span class="sc">&lt;</span> <span class="dv">10</span>, <span class="st">"Others"</span>, county)) <span class="sc">|&gt;</span></span>
<span id="cb29-863"><a href="#cb29-863" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb29-864"><a href="#cb29-864" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">sum</span>(count), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-865"><a href="#cb29-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-866"><a href="#cb29-866" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentage =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb29-867"><a href="#cb29-867" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(county, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">round</span>(percentage, <span class="dv">1</span>), <span class="st">"%"</span>)</span>
<span id="cb29-868"><a href="#cb29-868" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-869"><a href="#cb29-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-870"><a href="#cb29-870" aria-hidden="true" tabindex="-1"></a><span class="co"># plot </span></span>
<span id="cb29-871"><a href="#cb29-871" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(hotspots, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> count, <span class="at">fill =</span> county)) <span class="sc">+</span></span>
<span id="cb29-872"><a href="#cb29-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb29-873"><a href="#cb29-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb29-874"><a href="#cb29-874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb29-875"><a href="#cb29-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"High-Value Residential Sales by County"</span>) <span class="sc">+</span></span>
<span id="cb29-876"><a href="#cb29-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb29-877"><a href="#cb29-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-878"><a href="#cb29-878" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb29-879"><a href="#cb29-879" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb29-880"><a href="#cb29-880" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-881"><a href="#cb29-881" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Fairfield"</span> <span class="ot">=</span> <span class="st">"#2a9d8f"</span>, <span class="st">"Others"</span> <span class="ot">=</span> <span class="st">"#e9c46a"</span>))</span>
<span id="cb29-882"><a href="#cb29-882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-883"><a href="#cb29-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-884"><a href="#cb29-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-885"><a href="#cb29-885" aria-hidden="true" tabindex="-1"></a><span class="fu"># Feature Engineering </span></span>
<span id="cb29-886"><a href="#cb29-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-887"><a href="#cb29-887" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calculate Distance (km) from Grand Central Terminal for Each Property </span></span>
<span id="cb29-888"><a href="#cb29-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-891"><a href="#cb29-891" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-892"><a href="#cb29-892" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sf object to compute the distance to Grand Central </span></span>
<span id="cb29-893"><a href="#cb29-893" aria-hidden="true" tabindex="-1"></a>ct_sales_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(ct_sales_cleaned, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), </span>
<span id="cb29-894"><a href="#cb29-894" aria-hidden="true" tabindex="-1"></a>                        <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb29-895"><a href="#cb29-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-896"><a href="#cb29-896" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the distance from each property to Grand Central Terminal</span></span>
<span id="cb29-897"><a href="#cb29-897" aria-hidden="true" tabindex="-1"></a>ct_sales_sf <span class="ot">&lt;-</span> ct_sales_sf <span class="sc">|&gt;</span></span>
<span id="cb29-898"><a href="#cb29-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-899"><a href="#cb29-899" aria-hidden="true" tabindex="-1"></a>    <span class="at">point_dist_to_nyc =</span> </span>
<span id="cb29-900"><a href="#cb29-900" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(<span class="fu">as.numeric</span>(<span class="fu">st_distance</span>(geometry, grand_central)<span class="sc">/</span><span class="dv">1000</span>), <span class="dv">2</span>)</span>
<span id="cb29-901"><a href="#cb29-901" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-902"><a href="#cb29-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-903"><a href="#cb29-903" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb29-904"><a href="#cb29-904" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ct_sales_sf <span class="sc">|&gt;</span> <span class="fu">select</span>(ref_id, point_dist_to_nyc),</span>
<span id="cb29-905"><a href="#cb29-905" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">"ref_id"</span>)</span>
<span id="cb29-906"><a href="#cb29-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-907"><a href="#cb29-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-908"><a href="#cb29-908" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb29-909"><a href="#cb29-909" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(town_distance_range, <span class="at">by =</span> <span class="st">"town"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-910"><a href="#cb29-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>TOWN)</span>
<span id="cb29-911"><a href="#cb29-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-912"><a href="#cb29-912" aria-hidden="true" tabindex="-1"></a><span class="co"># After performing feature engineering, select the desired columns for display</span></span>
<span id="cb29-913"><a href="#cb29-913" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb29-914"><a href="#cb29-914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb29-915"><a href="#cb29-915" aria-hidden="true" tabindex="-1"></a>    address, town, sale_amount, property_type, point_dist_to_nyc</span>
<span id="cb29-916"><a href="#cb29-916" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-917"><a href="#cb29-917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb29-918"><a href="#cb29-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-919"><a href="#cb29-919" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb29-920"><a href="#cb29-920" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sample, <span class="at">caption =</span> <span class="st">"First 10 Rows of Sample Data"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-921"><a href="#cb29-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb29-922"><a href="#cb29-922" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-923"><a href="#cb29-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-924"><a href="#cb29-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-925"><a href="#cb29-925" aria-hidden="true" tabindex="-1"></a><span class="fu">## Compute Distance from Each Property to the Nearest Train Station</span></span>
<span id="cb29-926"><a href="#cb29-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-929"><a href="#cb29-929" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-930"><a href="#cb29-930" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a function to compute the distances from each train station for each property </span></span>
<span id="cb29-931"><a href="#cb29-931" aria-hidden="true" tabindex="-1"></a><span class="co"># compute_distance &lt;- function(stop_id_value){</span></span>
<span id="cb29-932"><a href="#cb29-932" aria-hidden="true" tabindex="-1"></a><span class="co">#   stop &lt;- stops_sf |&gt;</span></span>
<span id="cb29-933"><a href="#cb29-933" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(stop_id == stop_id_value)</span></span>
<span id="cb29-934"><a href="#cb29-934" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb29-935"><a href="#cb29-935" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Compute distances in kilometers</span></span>
<span id="cb29-936"><a href="#cb29-936" aria-hidden="true" tabindex="-1"></a><span class="co">#   distances &lt;- as.numeric(st_distance(properties, stop))/1000</span></span>
<span id="cb29-937"><a href="#cb29-937" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-938"><a href="#cb29-938" aria-hidden="true" tabindex="-1"></a><span class="co">#   data.frame(</span></span>
<span id="cb29-939"><a href="#cb29-939" aria-hidden="true" tabindex="-1"></a><span class="co">#     dist = distances </span></span>
<span id="cb29-940"><a href="#cb29-940" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb29-941"><a href="#cb29-941" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb29-942"><a href="#cb29-942" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-943"><a href="#cb29-943" aria-hidden="true" tabindex="-1"></a><span class="co"># properties &lt;- ct_sales_sf |&gt; select(ref_id, geometry)</span></span>
<span id="cb29-944"><a href="#cb29-944" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb29-945"><a href="#cb29-945" aria-hidden="true" tabindex="-1"></a><span class="co"># stop_list &lt;- stops |&gt;</span></span>
<span id="cb29-946"><a href="#cb29-946" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(state == "CT") |&gt;</span></span>
<span id="cb29-947"><a href="#cb29-947" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(stop_id) |&gt;</span></span>
<span id="cb29-948"><a href="#cb29-948" aria-hidden="true" tabindex="-1"></a><span class="co">#   pull()</span></span>
<span id="cb29-949"><a href="#cb29-949" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-950"><a href="#cb29-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-951"><a href="#cb29-951" aria-hidden="true" tabindex="-1"></a><span class="co"># dist_from_train_stops &lt;- stop_list |&gt; map(compute_distance) |&gt; bind_cols()</span></span>
<span id="cb29-952"><a href="#cb29-952" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(dist_from_train_stops, "dist_from_train_stops.csv", row.names = FALSE)</span></span>
<span id="cb29-953"><a href="#cb29-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-954"><a href="#cb29-954" aria-hidden="true" tabindex="-1"></a>dist_to_train_stops <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"dist_to_train_stops.csv"</span>)</span>
<span id="cb29-955"><a href="#cb29-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-956"><a href="#cb29-956" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the distance to the nearest Metro-North station for each property</span></span>
<span id="cb29-957"><a href="#cb29-957" aria-hidden="true" tabindex="-1"></a>min_distance <span class="ot">&lt;-</span> <span class="fu">apply</span>(dist_to_train_stops[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(dist_to_train_stops)], <span class="dv">1</span>, min, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-958"><a href="#cb29-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-959"><a href="#cb29-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-960"><a href="#cb29-960" aria-hidden="true" tabindex="-1"></a>to_join <span class="ot">&lt;-</span> dist_to_train_stops <span class="sc">|&gt;</span></span>
<span id="cb29-961"><a href="#cb29-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-962"><a href="#cb29-962" aria-hidden="true" tabindex="-1"></a>    <span class="at">dist =</span> <span class="fu">round</span>(min_distance, <span class="dv">2</span>)</span>
<span id="cb29-963"><a href="#cb29-963" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-964"><a href="#cb29-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb29-965"><a href="#cb29-965" aria-hidden="true" tabindex="-1"></a>    ref_id, dist</span>
<span id="cb29-966"><a href="#cb29-966" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb29-967"><a href="#cb29-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-968"><a href="#cb29-968" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span> <span class="fu">left_join</span>(to_join, <span class="at">by =</span> <span class="st">"ref_id"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb29-969"><a href="#cb29-969" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">nearest_rail_station_dist =</span> dist)</span>
<span id="cb29-970"><a href="#cb29-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-971"><a href="#cb29-971" aria-hidden="true" tabindex="-1"></a><span class="co"># After performing feature engineering, select the desired columns for display</span></span>
<span id="cb29-972"><a href="#cb29-972" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb29-973"><a href="#cb29-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb29-974"><a href="#cb29-974" aria-hidden="true" tabindex="-1"></a>    address, town, sale_amount, property_type, point_dist_to_nyc, </span>
<span id="cb29-975"><a href="#cb29-975" aria-hidden="true" tabindex="-1"></a>    nearest_rail_station_dist</span>
<span id="cb29-976"><a href="#cb29-976" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-977"><a href="#cb29-977" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb29-978"><a href="#cb29-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-979"><a href="#cb29-979" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first ten rows of the data set</span></span>
<span id="cb29-980"><a href="#cb29-980" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(sample_data, <span class="at">caption =</span> <span class="st">"First 10 Rows of Sample Data"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-981"><a href="#cb29-981" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), <span class="at">full_width =</span> F)</span>
<span id="cb29-982"><a href="#cb29-982" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-983"><a href="#cb29-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-984"><a href="#cb29-984" aria-hidden="true" tabindex="-1"></a><span class="fu">## 6. What percentage of properties in Fairfield and New Haven Counties are located within 3 km of the nearest Metro-North station?</span></span>
<span id="cb29-985"><a href="#cb29-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-986"><a href="#cb29-986" aria-hidden="true" tabindex="-1"></a>In Fairfield County, approximately 59% of all recorded property transactions </span>
<span id="cb29-987"><a href="#cb29-987" aria-hidden="true" tabindex="-1"></a>(125,669 out of 211,845) are situated within this 3 km radius. This suggests </span>
<span id="cb29-988"><a href="#cb29-988" aria-hidden="true" tabindex="-1"></a>that access to reliable commuter rail service may be a key driver of real estate </span>
<span id="cb29-989"><a href="#cb29-989" aria-hidden="true" tabindex="-1"></a>activity in the region, particularly given Fairfield’s direct rail connectivity </span>
<span id="cb29-990"><a href="#cb29-990" aria-hidden="true" tabindex="-1"></a>to New York City.</span>
<span id="cb29-991"><a href="#cb29-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-992"><a href="#cb29-992" aria-hidden="true" tabindex="-1"></a>In contrast, New Haven County shows a different spatial pattern, with only 30% </span>
<span id="cb29-993"><a href="#cb29-993" aria-hidden="true" tabindex="-1"></a>of its transactions (52,958 out of 175,862) occurring within the same proximity </span>
<span id="cb29-994"><a href="#cb29-994" aria-hidden="true" tabindex="-1"></a>threshold.</span>
<span id="cb29-995"><a href="#cb29-995" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-996"><a href="#cb29-996" aria-hidden="true" tabindex="-1"></a>Litchfield County has limited, indirect access to Metro-North service through </span>
<span id="cb29-997"><a href="#cb29-997" aria-hidden="true" tabindex="-1"></a>a small number of peripheral stations, but the impact is far more subtle. Other </span>
<span id="cb29-998"><a href="#cb29-998" aria-hidden="true" tabindex="-1"></a>counties in the state lack direct Metro-North connectivity altogether, which may </span>
<span id="cb29-999"><a href="#cb29-999" aria-hidden="true" tabindex="-1"></a>contribute to differences in real estate volume and spatial distribution.</span>
<span id="cb29-1000"><a href="#cb29-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1003"><a href="#cb29-1003" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-1004"><a href="#cb29-1004" aria-hidden="true" tabindex="-1"></a>fairfield_new_haven <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb29-1005"><a href="#cb29-1005" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nearest_rail_station_dist <span class="sc">&lt;</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-1006"><a href="#cb29-1006" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb29-1007"><a href="#cb29-1007" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb29-1008"><a href="#cb29-1008" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb29-1009"><a href="#cb29-1009" aria-hidden="true" tabindex="-1"></a>    ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb29-1010"><a href="#cb29-1010" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(county <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Fairfield"</span>, <span class="st">"New Haven"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-1011"><a href="#cb29-1011" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(county) <span class="sc">|&gt;</span></span>
<span id="cb29-1012"><a href="#cb29-1012" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">total =</span> <span class="fu">n</span>())</span>
<span id="cb29-1013"><a href="#cb29-1013" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-1014"><a href="#cb29-1014" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-1015"><a href="#cb29-1015" aria-hidden="true" tabindex="-1"></a>    <span class="at">percentage =</span> <span class="fu">round</span>(n<span class="sc">/</span>total, <span class="dv">2</span>)</span>
<span id="cb29-1016"><a href="#cb29-1016" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-1017"><a href="#cb29-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1018"><a href="#cb29-1018" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot long </span></span>
<span id="cb29-1019"><a href="#cb29-1019" aria-hidden="true" tabindex="-1"></a>fairfield_new_haven <span class="ot">&lt;-</span> fairfield_new_haven <span class="sc">|&gt;</span></span>
<span id="cb29-1020"><a href="#cb29-1020" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">beyond =</span> total <span class="sc">-</span> n) <span class="sc">|&gt;</span></span>
<span id="cb29-1021"><a href="#cb29-1021" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, <span class="at">within =</span> n, beyond) <span class="sc">|&gt;</span></span>
<span id="cb29-1022"><a href="#cb29-1022" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(within, beyond), <span class="at">names_to =</span> <span class="st">"category"</span>, </span>
<span id="cb29-1023"><a href="#cb29-1023" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-1024"><a href="#cb29-1024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">category =</span> <span class="fu">ifelse</span>(category <span class="sc">==</span> <span class="st">"within"</span>, <span class="st">"Within 3 km"</span>, <span class="st">"Beyond 3 km"</span>))</span>
<span id="cb29-1025"><a href="#cb29-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1026"><a href="#cb29-1026" aria-hidden="true" tabindex="-1"></a><span class="co"># Fairfield</span></span>
<span id="cb29-1027"><a href="#cb29-1027" aria-hidden="true" tabindex="-1"></a>fairfield_pie <span class="ot">&lt;-</span> fairfield_new_haven <span class="sc">|&gt;</span></span>
<span id="cb29-1028"><a href="#cb29-1028" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(county <span class="sc">==</span> <span class="st">"Fairfield"</span>)</span>
<span id="cb29-1029"><a href="#cb29-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1030"><a href="#cb29-1030" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Fairfield pie </span></span>
<span id="cb29-1031"><a href="#cb29-1031" aria-hidden="true" tabindex="-1"></a>fairfield_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(fairfield_pie, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> value, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb29-1032"><a href="#cb29-1032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb29-1033"><a href="#cb29-1033" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb29-1034"><a href="#cb29-1034" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">percent</span>(value <span class="sc">/</span> <span class="fu">sum</span>(value))),</span>
<span id="cb29-1035"><a href="#cb29-1035" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb29-1036"><a href="#cb29-1036" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Fairfield County"</span>) <span class="sc">+</span></span>
<span id="cb29-1037"><a href="#cb29-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb29-1038"><a href="#cb29-1038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Within 3 km"</span> <span class="ot">=</span> <span class="st">"#2a9d8f"</span>, <span class="st">"Beyond 3 km"</span> <span class="ot">=</span> <span class="st">"#e9c46a"</span>))</span>
<span id="cb29-1039"><a href="#cb29-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1040"><a href="#cb29-1040" aria-hidden="true" tabindex="-1"></a><span class="co"># New Haven</span></span>
<span id="cb29-1041"><a href="#cb29-1041" aria-hidden="true" tabindex="-1"></a>newhaven_pie <span class="ot">&lt;-</span> fairfield_new_haven <span class="sc">|&gt;</span></span>
<span id="cb29-1042"><a href="#cb29-1042" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(county <span class="sc">==</span> <span class="st">"New Haven"</span>)</span>
<span id="cb29-1043"><a href="#cb29-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1044"><a href="#cb29-1044" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot New Haven Pie</span></span>
<span id="cb29-1045"><a href="#cb29-1045" aria-hidden="true" tabindex="-1"></a>new_haven_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(newhaven_pie, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> value, <span class="at">fill =</span> category)) <span class="sc">+</span></span>
<span id="cb29-1046"><a href="#cb29-1046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb29-1047"><a href="#cb29-1047" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb29-1048"><a href="#cb29-1048" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">percent</span>(value <span class="sc">/</span> <span class="fu">sum</span>(value))),</span>
<span id="cb29-1049"><a href="#cb29-1049" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb29-1050"><a href="#cb29-1050" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"New Haven County"</span>) <span class="sc">+</span></span>
<span id="cb29-1051"><a href="#cb29-1051" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb29-1052"><a href="#cb29-1052" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Within 3 km"</span> <span class="ot">=</span> <span class="st">"#4682B4"</span>, <span class="st">"Beyond 3 km"</span> <span class="ot">=</span> <span class="st">"#e9c46a"</span>))</span>
<span id="cb29-1053"><a href="#cb29-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1054"><a href="#cb29-1054" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb29-1055"><a href="#cb29-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1056"><a href="#cb29-1056" aria-hidden="true" tabindex="-1"></a>(fairfield_plot <span class="sc">+</span> new_haven_plot) <span class="sc">+</span></span>
<span id="cb29-1057"><a href="#cb29-1057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">+</span></span>
<span id="cb29-1058"><a href="#cb29-1058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Proximity to Metro-North Station (Within 3 km)"</span>) <span class="sc">&amp;</span></span>
<span id="cb29-1059"><a href="#cb29-1059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb29-1060"><a href="#cb29-1060" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb29-1061"><a href="#cb29-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1062"><a href="#cb29-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1063"><a href="#cb29-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1064"><a href="#cb29-1064" aria-hidden="true" tabindex="-1"></a><span class="fu">## 7. How does proximity to the nearest train station correlate with home values in Fairfield County?</span></span>
<span id="cb29-1065"><a href="#cb29-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1066"><a href="#cb29-1066" aria-hidden="true" tabindex="-1"></a>The correlation between distance to the nearest Metro-North station and property </span>
<span id="cb29-1067"><a href="#cb29-1067" aria-hidden="true" tabindex="-1"></a>sale price in Fairfield County is approximately -0.14, indicating a weak negative </span>
<span id="cb29-1068"><a href="#cb29-1068" aria-hidden="true" tabindex="-1"></a>relationship. This suggests that, on average, properties located closer to train </span>
<span id="cb29-1069"><a href="#cb29-1069" aria-hidden="true" tabindex="-1"></a>stations tend to have slightly higher sale prices, though the effect is modest.</span>
<span id="cb29-1070"><a href="#cb29-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1073"><a href="#cb29-1073" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-1074"><a href="#cb29-1074" aria-hidden="true" tabindex="-1"></a>fairfield <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb29-1075"><a href="#cb29-1075" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residentital"</span>, <span class="st">"Single Family"</span>), </span>
<span id="cb29-1076"><a href="#cb29-1076" aria-hidden="true" tabindex="-1"></a>         county <span class="sc">==</span> <span class="st">"Fairfield"</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-1077"><a href="#cb29-1077" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sale_amount, nearest_rail_station_dist)</span>
<span id="cb29-1078"><a href="#cb29-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1079"><a href="#cb29-1079" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb29-1080"><a href="#cb29-1080" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb29-1081"><a href="#cb29-1081" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb29-1082"><a href="#cb29-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1083"><a href="#cb29-1083" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fairfield, <span class="fu">aes</span>(<span class="at">x =</span> nearest_rail_station_dist, <span class="at">y =</span> sale_amount)) <span class="sc">+</span></span>
<span id="cb29-1084"><a href="#cb29-1084" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"#4682B4"</span>) <span class="sc">+</span></span>
<span id="cb29-1085"><a href="#cb29-1085" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb29-1086"><a href="#cb29-1086" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb29-1087"><a href="#cb29-1087" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-1088"><a href="#cb29-1088" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distance to Nearest Train Station and Home Price in Fairfield County"</span>,</span>
<span id="cb29-1089"><a href="#cb29-1089" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Distance to Nearest Train Station (km or miles)"</span>,</span>
<span id="cb29-1090"><a href="#cb29-1090" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Sale Amount (USD)"</span></span>
<span id="cb29-1091"><a href="#cb29-1091" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-1092"><a href="#cb29-1092" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span>
<span id="cb29-1093"><a href="#cb29-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1094"><a href="#cb29-1094" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(fairfield<span class="sc">$</span>nearest_rail_station_dist, fairfield<span class="sc">$</span>sale_amount)</span>
<span id="cb29-1095"><a href="#cb29-1095" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1096"><a href="#cb29-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1097"><a href="#cb29-1097" aria-hidden="true" tabindex="-1"></a><span class="fu">## 8. How do average property values differ by property type between New Haven and Hartford towns?</span></span>
<span id="cb29-1098"><a href="#cb29-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1099"><a href="#cb29-1099" aria-hidden="true" tabindex="-1"></a>Across multiple residential types, New Haven town consistently commands higher </span>
<span id="cb29-1100"><a href="#cb29-1100" aria-hidden="true" tabindex="-1"></a>prices than Hartford: on average, single-family homes are 41.63% more expensive, </span>
<span id="cb29-1101"><a href="#cb29-1101" aria-hidden="true" tabindex="-1"></a>three-family homes are 32.81% higher, and two-family homes command a 17.63% premium.</span>
<span id="cb29-1102"><a href="#cb29-1102" aria-hidden="true" tabindex="-1"></a>These patterns suggest that access to commuter rail significantly influences</span>
<span id="cb29-1103"><a href="#cb29-1103" aria-hidden="true" tabindex="-1"></a>real estate demand and pricing power. </span>
<span id="cb29-1104"><a href="#cb29-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1107"><a href="#cb29-1107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-1108"><a href="#cb29-1108" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the average property value differences across property types between </span></span>
<span id="cb29-1109"><a href="#cb29-1109" aria-hidden="true" tabindex="-1"></a><span class="co"># the towns: New Haven and Hartford</span></span>
<span id="cb29-1110"><a href="#cb29-1110" aria-hidden="true" tabindex="-1"></a>new_haven_hartford_wide <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb29-1111"><a href="#cb29-1111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hartford"</span>, <span class="st">"New Haven"</span>), </span>
<span id="cb29-1112"><a href="#cb29-1112" aria-hidden="true" tabindex="-1"></a>         property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>, <span class="st">"Two Family"</span>, </span>
<span id="cb29-1113"><a href="#cb29-1113" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Three Family"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-1114"><a href="#cb29-1114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town, property_type) <span class="sc">|&gt;</span></span>
<span id="cb29-1115"><a href="#cb29-1115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg =</span> <span class="fu">mean</span>(sale_amount)) <span class="sc">|&gt;</span></span>
<span id="cb29-1116"><a href="#cb29-1116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-1117"><a href="#cb29-1117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb29-1118"><a href="#cb29-1118" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> town,</span>
<span id="cb29-1119"><a href="#cb29-1119" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> avg</span>
<span id="cb29-1120"><a href="#cb29-1120" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-1121"><a href="#cb29-1121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-1122"><a href="#cb29-1122" aria-hidden="true" tabindex="-1"></a>    <span class="at">price_pct_diff =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">round</span>((<span class="st">`</span><span class="at">New Haven</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">Hartford</span><span class="st">`</span>)<span class="sc">/</span>(<span class="st">`</span><span class="at">Hartford</span><span class="st">`</span>), <span class="dv">4</span>)</span>
<span id="cb29-1123"><a href="#cb29-1123" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-1124"><a href="#cb29-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1125"><a href="#cb29-1125" aria-hidden="true" tabindex="-1"></a><span class="co"># Pivot long </span></span>
<span id="cb29-1126"><a href="#cb29-1126" aria-hidden="true" tabindex="-1"></a>new_haven_hartford_long <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span></span>
<span id="cb29-1127"><a href="#cb29-1127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(town <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Hartford"</span>, <span class="st">"New Haven"</span>), </span>
<span id="cb29-1128"><a href="#cb29-1128" aria-hidden="true" tabindex="-1"></a>         property_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Residential"</span>, <span class="st">"Single Family"</span>, <span class="st">"Two Family"</span>, </span>
<span id="cb29-1129"><a href="#cb29-1129" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"Three Family"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-1130"><a href="#cb29-1130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town, property_type) <span class="sc">|&gt;</span></span>
<span id="cb29-1131"><a href="#cb29-1131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg =</span> <span class="fu">mean</span>(sale_amount)) <span class="sc">|&gt;</span></span>
<span id="cb29-1132"><a href="#cb29-1132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(property_type) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb29-1133"><a href="#cb29-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1134"><a href="#cb29-1134" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb29-1135"><a href="#cb29-1135" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_haven_hartford_long, <span class="fu">aes</span>(<span class="at">x =</span> property_type, <span class="at">y =</span> avg, <span class="at">fill =</span> town)) <span class="sc">+</span></span>
<span id="cb29-1136"><a href="#cb29-1136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>), <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb29-1137"><a href="#cb29-1137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb29-1138"><a href="#cb29-1138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">dollar</span>(avg)),</span>
<span id="cb29-1139"><a href="#cb29-1139" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.7</span>),</span>
<span id="cb29-1140"><a href="#cb29-1140" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.4</span>,</span>
<span id="cb29-1141"><a href="#cb29-1141" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">3.5</span></span>
<span id="cb29-1142"><a href="#cb29-1142" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-1143"><a href="#cb29-1143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">dollar_format</span>()) <span class="sc">+</span></span>
<span id="cb29-1144"><a href="#cb29-1144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Hartford"</span> <span class="ot">=</span> <span class="st">"#c81d25"</span>, <span class="st">"New Haven"</span> <span class="ot">=</span> <span class="st">"#4895ef"</span>)) <span class="sc">+</span></span>
<span id="cb29-1145"><a href="#cb29-1145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-1146"><a href="#cb29-1146" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average Property Prices: New Haven vs. Hartford"</span>,</span>
<span id="cb29-1147"><a href="#cb29-1147" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Property Type"</span>,</span>
<span id="cb29-1148"><a href="#cb29-1148" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Price (USD)"</span>,</span>
<span id="cb29-1149"><a href="#cb29-1149" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Town"</span></span>
<span id="cb29-1150"><a href="#cb29-1150" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-1151"><a href="#cb29-1151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb29-1152"><a href="#cb29-1152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-1153"><a href="#cb29-1153" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb29-1154"><a href="#cb29-1154" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb29-1155"><a href="#cb29-1155" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb29-1156"><a href="#cb29-1156" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb29-1157"><a href="#cb29-1157" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb29-1158"><a href="#cb29-1158" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-1159"><a href="#cb29-1159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1160"><a href="#cb29-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1161"><a href="#cb29-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1162"><a href="#cb29-1162" aria-hidden="true" tabindex="-1"></a><span class="fu">## 9. Which ten towns in Connecticut have the highest number of bus stops?"</span></span>
<span id="cb29-1163"><a href="#cb29-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1164"><a href="#cb29-1164" aria-hidden="true" tabindex="-1"></a>Based on the distribution of bus stops across Connecticut towns, we observe </span>
<span id="cb29-1165"><a href="#cb29-1165" aria-hidden="true" tabindex="-1"></a>that Hartford, New Haven, and Waterbury lead in public transit infrastructure, </span>
<span id="cb29-1166"><a href="#cb29-1166" aria-hidden="true" tabindex="-1"></a>each with more than 750 bus stops. </span>
<span id="cb29-1167"><a href="#cb29-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1170"><a href="#cb29-1170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-1171"><a href="#cb29-1171" aria-hidden="true" tabindex="-1"></a><span class="co"># CT bus stops data</span></span>
<span id="cb29-1172"><a href="#cb29-1172" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">"~/Downloads/googlect_transit/stops.txt"</span>, </span>
<span id="cb29-1173"><a href="#cb29-1173" aria-hidden="true" tabindex="-1"></a>                        <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-1174"><a href="#cb29-1174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb29-1175"><a href="#cb29-1175" aria-hidden="true" tabindex="-1"></a>    stop_id, stop_code, stop_name, stop_lat, stop_lon   <span class="co"># Select relevant columns</span></span>
<span id="cb29-1176"><a href="#cb29-1176" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-1177"><a href="#cb29-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1178"><a href="#cb29-1178" aria-hidden="true" tabindex="-1"></a><span class="co"># Connecticut towns' geometry </span></span>
<span id="cb29-1179"><a href="#cb29-1179" aria-hidden="true" tabindex="-1"></a>ct_towns_geom <span class="ot">&lt;-</span> ct_towns <span class="sc">|&gt;</span> <span class="fu">select</span>(STATEFP, NAME)</span>
<span id="cb29-1180"><a href="#cb29-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1181"><a href="#cb29-1181" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a sf object based on the bus stop coordinate </span></span>
<span id="cb29-1182"><a href="#cb29-1182" aria-hidden="true" tabindex="-1"></a>bus_stops_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(bus_stops, <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"stop_lon"</span>, <span class="st">"stop_lat"</span>), </span>
<span id="cb29-1183"><a href="#cb29-1183" aria-hidden="true" tabindex="-1"></a>                         <span class="at">crs =</span> <span class="fu">st_crs</span>(ct_towns))</span>
<span id="cb29-1184"><a href="#cb29-1184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1185"><a href="#cb29-1185" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain the town name for each bus stop using `st_join` </span></span>
<span id="cb29-1186"><a href="#cb29-1186" aria-hidden="true" tabindex="-1"></a>bus_stops <span class="ot">&lt;-</span> <span class="fu">st_join</span>(bus_stops_sf, ct_ny_towns_geom, <span class="at">join =</span> st_within) <span class="sc">|&gt;</span></span>
<span id="cb29-1187"><a href="#cb29-1187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-1188"><a href="#cb29-1188" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">1</span>],</span>
<span id="cb29-1189"><a href="#cb29-1189" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">st_coordinates</span>(geometry)[, <span class="dv">2</span>]</span>
<span id="cb29-1190"><a href="#cb29-1190" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-1191"><a href="#cb29-1191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-1192"><a href="#cb29-1192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">town =</span> NAME) <span class="sc">|&gt;</span></span>
<span id="cb29-1193"><a href="#cb29-1193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-1194"><a href="#cb29-1194" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> <span class="fu">case_when</span>(</span>
<span id="cb29-1195"><a href="#cb29-1195" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"09"</span> <span class="sc">~</span> <span class="st">"CT"</span>,</span>
<span id="cb29-1196"><a href="#cb29-1196" aria-hidden="true" tabindex="-1"></a>      STATEFP <span class="sc">==</span> <span class="st">"36"</span> <span class="sc">~</span> <span class="st">"NY"</span>,</span>
<span id="cb29-1197"><a href="#cb29-1197" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb29-1198"><a href="#cb29-1198" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-1199"><a href="#cb29-1199" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-1200"><a href="#cb29-1200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>STATEFP)</span>
<span id="cb29-1201"><a href="#cb29-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1202"><a href="#cb29-1202" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of bus stops in each town</span></span>
<span id="cb29-1203"><a href="#cb29-1203" aria-hidden="true" tabindex="-1"></a>top10_town <span class="ot">&lt;-</span> bus_stops <span class="sc">|&gt;</span></span>
<span id="cb29-1204"><a href="#cb29-1204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"CT"</span>) <span class="sc">|&gt;</span>        </span>
<span id="cb29-1205"><a href="#cb29-1205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(town) <span class="sc">|&gt;</span></span>
<span id="cb29-1206"><a href="#cb29-1206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_stops =</span> <span class="fu">n_distinct</span>(stop_id)) <span class="sc">|&gt;</span></span>
<span id="cb29-1207"><a href="#cb29-1207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_stops)) <span class="sc">|&gt;</span></span>
<span id="cb29-1208"><a href="#cb29-1208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(n_stops, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb29-1209"><a href="#cb29-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1210"><a href="#cb29-1210" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb29-1211"><a href="#cb29-1211" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top10_town, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(town, n_stops), <span class="at">y =</span> n_stops)) <span class="sc">+</span></span>
<span id="cb29-1212"><a href="#cb29-1212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2a9d8f"</span>) <span class="sc">+</span></span>
<span id="cb29-1213"><a href="#cb29-1213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_stops), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb29-1214"><a href="#cb29-1214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-1215"><a href="#cb29-1215" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 10 Connecticut Towns by Number of Bus Stops"</span>,</span>
<span id="cb29-1216"><a href="#cb29-1216" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Town"</span>,</span>
<span id="cb29-1217"><a href="#cb29-1217" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Bus Stops"</span></span>
<span id="cb29-1218"><a href="#cb29-1218" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-1219"><a href="#cb29-1219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb29-1220"><a href="#cb29-1220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-1221"><a href="#cb29-1221" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb29-1222"><a href="#cb29-1222" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb29-1223"><a href="#cb29-1223" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb29-1224"><a href="#cb29-1224" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb29-1225"><a href="#cb29-1225" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-1226"><a href="#cb29-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1227"><a href="#cb29-1227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1228"><a href="#cb29-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1229"><a href="#cb29-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1230"><a href="#cb29-1230" aria-hidden="true" tabindex="-1"></a><span class="fu">## 10. What are the top five towns with the most connectivity to other towns? </span></span>
<span id="cb29-1231"><a href="#cb29-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1232"><a href="#cb29-1232" aria-hidden="true" tabindex="-1"></a>Hartford stands out as the most connected town in Connecticut's bus network, </span>
<span id="cb29-1233"><a href="#cb29-1233" aria-hidden="true" tabindex="-1"></a>with direct connections to 62 other towns. This high level of connectivity </span>
<span id="cb29-1234"><a href="#cb29-1234" aria-hidden="true" tabindex="-1"></a>underscores Hartford’s role as a central transportation hub in the region.</span>
<span id="cb29-1235"><a href="#cb29-1235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1238"><a href="#cb29-1238" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-1239"><a href="#cb29-1239" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of trips that go between town pairs</span></span>
<span id="cb29-1240"><a href="#cb29-1240" aria-hidden="true" tabindex="-1"></a>town_edges <span class="ot">&lt;-</span> bus_trip_stop_data <span class="sc">|&gt;</span></span>
<span id="cb29-1241"><a href="#cb29-1241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(trip_id) <span class="sc">|&gt;</span></span>
<span id="cb29-1242"><a href="#cb29-1242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb29-1243"><a href="#cb29-1243" aria-hidden="true" tabindex="-1"></a>    <span class="at">origin_town =</span> town[<span class="fu">which.min</span>(stop_sequence)],</span>
<span id="cb29-1244"><a href="#cb29-1244" aria-hidden="true" tabindex="-1"></a>    <span class="at">dest_town =</span> town[<span class="fu">which.max</span>(stop_sequence)],</span>
<span id="cb29-1245"><a href="#cb29-1245" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb29-1246"><a href="#cb29-1246" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb29-1247"><a href="#cb29-1247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(origin_town <span class="sc">!=</span> dest_town) <span class="sc">|&gt;</span></span>
<span id="cb29-1248"><a href="#cb29-1248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(origin_town, dest_town, <span class="at">name =</span> <span class="st">"weight"</span>)</span>
<span id="cb29-1249"><a href="#cb29-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1250"><a href="#cb29-1250" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb29-1251"><a href="#cb29-1251" aria-hidden="true" tabindex="-1"></a>town_graph <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(town_edges, <span class="at">directed =</span> <span class="cn">FALSE</span>) </span>
<span id="cb29-1252"><a href="#cb29-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1253"><a href="#cb29-1253" aria-hidden="true" tabindex="-1"></a><span class="co"># Count the number of towns a town connects to </span></span>
<span id="cb29-1254"><a href="#cb29-1254" aria-hidden="true" tabindex="-1"></a>town_connectivity <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb29-1255"><a href="#cb29-1255" aria-hidden="true" tabindex="-1"></a>  <span class="at">town =</span> <span class="fu">V</span>(town_graph)<span class="sc">$</span>name,</span>
<span id="cb29-1256"><a href="#cb29-1256" aria-hidden="true" tabindex="-1"></a>  <span class="at">degree =</span> <span class="fu">degree</span>(town_graph)</span>
<span id="cb29-1257"><a href="#cb29-1257" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb29-1258"><a href="#cb29-1258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(degree)) <span class="sc">|&gt;</span></span>
<span id="cb29-1259"><a href="#cb29-1259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(town, degree) <span class="sc">|&gt;</span></span>
<span id="cb29-1260"><a href="#cb29-1260" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">n_connected_towns =</span> degree)</span>
<span id="cb29-1261"><a href="#cb29-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1262"><a href="#cb29-1262" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(town_connectivity) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb29-1263"><a href="#cb29-1263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1264"><a href="#cb29-1264" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the first top five towns with the highest connectivity to other towns </span></span>
<span id="cb29-1265"><a href="#cb29-1265" aria-hidden="true" tabindex="-1"></a>top5_towns <span class="ot">&lt;-</span> town_connectivity <span class="sc">|&gt;</span> <span class="fu">slice_max</span>(n_connected_towns, <span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb29-1266"><a href="#cb29-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1267"><a href="#cb29-1267" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb29-1268"><a href="#cb29-1268" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(top5_towns, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(town, <span class="sc">-</span>n_connected_towns), </span>
<span id="cb29-1269"><a href="#cb29-1269" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> n_connected_towns)) <span class="sc">+</span></span>
<span id="cb29-1270"><a href="#cb29-1270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#bb9457"</span>, <span class="at">alpha =</span> <span class="fl">0.85</span>) <span class="sc">+</span></span>
<span id="cb29-1271"><a href="#cb29-1271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_connected_towns), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb29-1272"><a href="#cb29-1272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-1273"><a href="#cb29-1273" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top Towns by Connectivity to Other Towns"</span>,</span>
<span id="cb29-1274"><a href="#cb29-1274" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Town"</span>,</span>
<span id="cb29-1275"><a href="#cb29-1275" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Connected Towns"</span></span>
<span id="cb29-1276"><a href="#cb29-1276" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-1277"><a href="#cb29-1277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb29-1278"><a href="#cb29-1278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-1279"><a href="#cb29-1279" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb29-1280"><a href="#cb29-1280" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),  </span>
<span id="cb29-1281"><a href="#cb29-1281" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb29-1282"><a href="#cb29-1282" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb29-1283"><a href="#cb29-1283" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-1284"><a href="#cb29-1284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1285"><a href="#cb29-1285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1286"><a href="#cb29-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1287"><a href="#cb29-1287" aria-hidden="true" tabindex="-1"></a><span class="fu"># Model Performance</span></span>
<span id="cb29-1288"><a href="#cb29-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1289"><a href="#cb29-1289" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The three predictors together explain 35% variation in real estate pricing in</span>
<span id="cb29-1290"><a href="#cb29-1290" aria-hidden="true" tabindex="-1"></a>  Connecticut.</span>
<span id="cb29-1291"><a href="#cb29-1291" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Due to missing values in the property type variable, 208,649 observations were </span>
<span id="cb29-1292"><a href="#cb29-1292" aria-hidden="true" tabindex="-1"></a>  omitted in the model fitting process. This represents a limitation that should</span>
<span id="cb29-1293"><a href="#cb29-1293" aria-hidden="true" tabindex="-1"></a>  be addressed in future work.</span>
<span id="cb29-1294"><a href="#cb29-1294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1297"><a href="#cb29-1297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb29-1298"><a href="#cb29-1298" aria-hidden="true" tabindex="-1"></a><span class="co"># Center the predictor `nearest_rail_station_dist` as it is highly correlated </span></span>
<span id="cb29-1299"><a href="#cb29-1299" aria-hidden="true" tabindex="-1"></a><span class="co"># with `point_dist_to_nyc`</span></span>
<span id="cb29-1300"><a href="#cb29-1300" aria-hidden="true" tabindex="-1"></a>ct_sales_cleaned <span class="ot">&lt;-</span> ct_sales_cleaned <span class="sc">|&gt;</span> </span>
<span id="cb29-1301"><a href="#cb29-1301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-1302"><a href="#cb29-1302" aria-hidden="true" tabindex="-1"></a>    <span class="at">centered_nearest_rail_station_dist =</span> </span>
<span id="cb29-1303"><a href="#cb29-1303" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(nearest_rail_station_dist <span class="sc">-</span> <span class="fu">mean</span>(nearest_rail_station_dist), <span class="dv">2</span>)</span>
<span id="cb29-1304"><a href="#cb29-1304" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-1305"><a href="#cb29-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1306"><a href="#cb29-1306" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply a log transformation to predicting variable: `sale_amount` and fit a </span></span>
<span id="cb29-1307"><a href="#cb29-1307" aria-hidden="true" tabindex="-1"></a><span class="co"># linear regression model using three predictors</span></span>
<span id="cb29-1308"><a href="#cb29-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1309"><a href="#cb29-1309" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(sale_amount) <span class="sc">~</span> point_dist_to_nyc <span class="sc">+</span> </span>
<span id="cb29-1310"><a href="#cb29-1310" aria-hidden="true" tabindex="-1"></a>              centered_nearest_rail_station_dist <span class="sc">+</span> </span>
<span id="cb29-1311"><a href="#cb29-1311" aria-hidden="true" tabindex="-1"></a>              property_type,</span>
<span id="cb29-1312"><a href="#cb29-1312" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> ct_sales_cleaned)</span>
<span id="cb29-1313"><a href="#cb29-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1314"><a href="#cb29-1314" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span>
<span id="cb29-1315"><a href="#cb29-1315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb29-1316"><a href="#cb29-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1317"><a href="#cb29-1317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1318"><a href="#cb29-1318" aria-hidden="true" tabindex="-1"></a><span class="fu"># Future Work</span></span>
<span id="cb29-1319"><a href="#cb29-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1320"><a href="#cb29-1320" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There are several challenges and limitations we aim to address in future work. </span>
<span id="cb29-1321"><a href="#cb29-1321" aria-hidden="true" tabindex="-1"></a>  First, we plan to obtain accurate property type classifications for properties </span>
<span id="cb29-1322"><a href="#cb29-1322" aria-hidden="true" tabindex="-1"></a>  with missing values. Our initial attempt to impute property type using the </span>
<span id="cb29-1323"><a href="#cb29-1323" aria-hidden="true" tabindex="-1"></a>  nearest neighbor method proved to be unreliable.</span>
<span id="cb29-1324"><a href="#cb29-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1325"><a href="#cb29-1325" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We also intend to explore alternative statistical learning models to train the </span>
<span id="cb29-1326"><a href="#cb29-1326" aria-hidden="true" tabindex="-1"></a>  dataset. Given the large volume of observations in the Connecticut real estate </span>
<span id="cb29-1327"><a href="#cb29-1327" aria-hidden="true" tabindex="-1"></a>  dataset, implementing models such as random forests may require significant </span>
<span id="cb29-1328"><a href="#cb29-1328" aria-hidden="true" tabindex="-1"></a>  computational resources. </span>
<span id="cb29-1329"><a href="#cb29-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1330"><a href="#cb29-1330" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Additionally, we are interested in applying network theory to model the </span>
<span id="cb29-1331"><a href="#cb29-1331" aria-hidden="true" tabindex="-1"></a>  connectivity among towns. This could help us better understand whether certain </span>
<span id="cb29-1332"><a href="#cb29-1332" aria-hidden="true" tabindex="-1"></a>  structural or regional factors contribute to the distribution of real estate </span>
<span id="cb29-1333"><a href="#cb29-1333" aria-hidden="true" tabindex="-1"></a>  pricing in Connecticut.</span>
<span id="cb29-1334"><a href="#cb29-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1335"><a href="#cb29-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1336"><a href="#cb29-1336" aria-hidden="true" tabindex="-1"></a><span class="fu"># Conclusion</span></span>
<span id="cb29-1337"><a href="#cb29-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1338"><a href="#cb29-1338" aria-hidden="true" tabindex="-1"></a>Based on our analysis and model performance, we found a moderate relationship </span>
<span id="cb29-1339"><a href="#cb29-1339" aria-hidden="true" tabindex="-1"></a>between property values in Connecticut and two key factors: proximity to the </span>
<span id="cb29-1340"><a href="#cb29-1340" aria-hidden="true" tabindex="-1"></a>economic center—New York City—and direct accessibility to rail stations. The </span>
<span id="cb29-1341"><a href="#cb29-1341" aria-hidden="true" tabindex="-1"></a>impact on home values is more pronounced, with values tending to decrease </span>
<span id="cb29-1342"><a href="#cb29-1342" aria-hidden="true" tabindex="-1"></a>moderately as the distance from these economic and transportation hubs increases.</span>
<span id="cb29-1343"><a href="#cb29-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1344"><a href="#cb29-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1345"><a href="#cb29-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1346"><a href="#cb29-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1347"><a href="#cb29-1347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1348"><a href="#cb29-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1349"><a href="#cb29-1349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1350"><a href="#cb29-1350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1351"><a href="#cb29-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1352"><a href="#cb29-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1353"><a href="#cb29-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1354"><a href="#cb29-1354" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>